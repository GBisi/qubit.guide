# Quantum channels (or CP maps) {#chapter10}

> About linear transformations --- often called **quantum channels**, **quantum operations**, or **superoperators** --- that map density operators to density operators. Mathematically, such objects are known as **completely positive trace-preserving maps**. Be prepared for some name dropping; you will hear about Karl Kraus, Woody Stinespring, Andrzej Jamiołkowski, and Man-Duen Choi. To be sure, knowing names will not give you more insights, but at least you will not be intimidated when you hear about the **Stinespring** and the **Kraus representations**, the **Jamiołkowski isomorphism**, or the **Choi matrix**.

In quantum information science (and in life) we often divide the world into two parts: things we can control and everything else.
Things we can control (at least with some precision), such as a bunch of ions in an ion trap, will now acquire a generic name -- the **system** -- and the "everything else" part will be called the **environment**.
The joint evolution of the system and the environment is unitary, but the system _alone_ may deviate from the unitary evolution due to the entangling interactions with the environment.
What does this non-unitary quantum evolution look like?

Mathematically speaking^[Recall that, given a pair of Hilbert spaces $\mathcal{H}_A$ and $\mathcal{H}_B$, we denote the set of (bounded) linear operators from $\mathcal{H}_A$ to $\mathcal{H}_B$ by $\mathcal{B}(\mathcal{H}_A,\mathcal{H}_B)$. The shorthand $\mathcal{B}(\mathcal{H})$ is used to denote $\mathcal{B(H,H)}$. For example, an element of $\mathcal{B}(\mathcal{H})$ is exactly a density operator on $\mathcal{H}$.], we want to characterise **physically admissible** maps
$$
  \mathcal{B}\colon \mathcal{B}(\mathcal{H}) \to \mathcal{B}(\mathcal{H}')
$$
that map density operators to density operators.
We will call them **quantum channels**.
Here, $\mathcal{H}$ and $\mathcal{H}'$ are the Hilbert spaces associated with the input and the output, respectively (these two spaces may be of different dimensions: $\dim\mathcal{H}=d$ and $\dim\mathcal{H}'=d'$, with $d$ not necessarily equal to $d'$).
It is not a trivial task, since some operations (such as the matrix transpose) turn density matrices into seemingly legal density matrices, and yet they are _not_ physically admissible.
We want to understand why.

There are essentially two approaches to characterising quantum channels. Let us call them **constructive** and **axiomatic**.

- In the constructive approach (much favoured by physicists) we assume that, in the quantum world, there are only unitary evolutions, and that _non_-unitary evolutions of subsystems are induced by unitary evolutions of _larger_ systems.
We can view them as the result of adding or removing physical systems that participate in unitary evolutions.
In particular, _any_ quantum channel can be constructed by taking a physical system in state $\rho$, combining it with an auxiliary system (e.g. the environment) in some fixed quantum state, applying a unitary transformation to the combined system, and then discarding everything that is of no interest to us.

- In the axiomatic approach we proceed as mathematicians usually do.
We refer to quantum theory for inspiration, scratch our heads, and list all the desired properties that a map should have in order to be called an admissible quantum operation.
This way we define **completely positive trace-preserving** (CPTP) maps.

In the end, you will be relieved to learn, the two approaches are equivalent, leading to the same mathematical formalism.
This equivalence is often goes by the name of the **Stinespring dilation theorem**^[[William Forrest "Woody" Stinespring](https://en.wikipedia.org/wiki/W._Forrest_Stinespring) (1929--2012) was an American mathematician specialising in operator theory.], which says that the CPTP maps are exactly the maps which can be constructed from unitary evolutions by adding and removing subsystems.






## The constructive approach

### Unitary evolution is all there is...

Here we consider the constructive approach described above.
So we know that any evolution of any _isolated_ system is always unitary, since, at the fundamental level, this is the only evolution that is offered by quantum theory.
Anything else that is not unitary has to be, somehow, derived from a unitary evolution of the whole, and it is easy to see that a unitary evolution of the whole does not imply unitary evolutions of its constituent parts.
The question is: _what kind of sub-evolutions can be induced on subsystems by a global unitary evolution?_

Consider a physical system, prepared in some input state $\ket{\psi}\in\mathcal{H}$, which is then combined with another system (here, the environment) that is initially in state $\ket{e}\in\mathcal{H}_E$.
The two systems interact, and their joint unitary evolution $U$ produces, in general, an entangled state.
The system itself, after discarding the environment, ends in an output state $\rho'$, which is given by taking a partial trace, as shown in Figure \@ref(fig:joint-system-discard-output).

(ref:joint-system-discard-output-caption) The output (discarding what happens to the environment) is given by $\rho'=\tr_E \big(U\proj{\psi}\otimes\proj{e} U^\dagger\big)$.

```{r joint-system-discard-output,engine='tikz',engine.opts=list(template="tikz2pdf.tex"),fig.width=6,fig.cap='(ref:joint-system-discard-output-caption)'}
\begin{equation*}
  \begin{quantikz}
    \lstick{input $\ket{\psi}$} & \gate[wires=2]{U} &\rstick{output $\rho'$} \qw
  \\\lstick{fixed $\ket{e}$} &\hphantom{really wide} &\rstick{discard} \qw
  \end{quantikz}
\end{equation*}
```

The requirement that the environment start in a pure state is not very restrictive: if it were initially in a mixed state, then we could always regard the environment as a sub-environment of some larger environment in an entangled pure state.
It _is_ important, however, that the system and its environment _initially have no correlation with each other_: they are in a product state $\ket{\psi}\otimes \ket{e}$.
Then, if we fix the initial state of the environment $\ket{e}$ and the unitary $U$, the final state of the system depends _only_ on its initial state $\ket{\psi}$.
In fact, the initial state of the system can be a mixed state, described by some density operator $\rho$.
This is because any mixed state can be interpreted as a statistical mixture of pure states, and any linear process respects such a mixture.
Thus, by fixing $U$ and $\ket{e}$, we have constructed a well defined linear map $\mathcal{E}\colon\mathcal{B}(\mathcal{H})\to\mathcal{B}(\mathcal{H})$ that transforms the input state $\rho$ into the output state $\rho'=\mathcal{E}(\rho)$.

::: {.idea data-latex=""}
$$
  \begin{aligned}
    \mathcal{E}\colon \mathcal{B}(\mathcal{H}) &\longrightarrow \mathcal{B}(\mathcal{H})
  \\\rho &\longmapsto \rho'=\tr_E \big(U\proj{\psi}\otimes\proj{e} U^\dagger\big)
  \end{aligned}
$$
:::

This way of describing the action of a quantum channel is often called the **unitary representation** of a channel.
As mentioned above, the channel is completely defined by the unitary $U$ and the initial state of the environment $\ket{e}$, but note that, once the system and the environment cease to interact, any operation _on the environment alone_ has no effect on the state of the system.
That is, the two diagrams in Figure \@ref(fig:environment-same-channel) define the same channel, or, in other words, the unitaries $U$ and $(\id\otimes R)U$, where $R$ acts only on $\mathcal{H}_E$, define the same channel.^[Consider $U$ and $U(\id\otimes R)$, where $R$ acts only on $\mathcal{H}_E$. Do these two unitaries also define the same quantum channel?]

(ref:environment-same-channel-caption) The $\bullet$ here represents discarding the final state of the environment.

```{r environment-same-channel,engine='tikz',engine.opts=list(template="tikz2pdf.tex"),fig.width=6,fig.cap='(ref:environment-same-channel-caption)'}
\begin{equation*}
  \begin{quantikz}
    \lstick{$\ket{\psi}$} & \gate[wires=2]{U} &\qw &\qw &\rstick{$\rho'$} \qw
  \\\lstick{$\ket{e}$} &\hphantom{really wide} &\qw &\qw &\rstick{$\bullet$} \qw
  \end{quantikz}
\end{equation*}
\begin{equation*}
  \begin{quantikz}
    \lstick{$\ket{\psi}$} & \gate[wires=2]{U} &\qw &\rstick{$\rho'$} \qw
  \\\lstick{$\ket{e}$} &\hphantom{really wide} &\gate{R} &\rstick{$\bullet$} \qw
  \end{quantikz}
\end{equation*}
```

Note that, for any operator $\tilde{\rho}$ on $\mathcal{H}\otimes\mathcal{H}_E$, and for any operator $R$ on $\mathcal{H}_E$, we have that
$$
  \tr_E\left[
    (\id\otimes R) \tilde{\rho} (\id\otimes R^\dagger)
  \right] = \tr_E \tilde{\rho}.
$$
The reduced density operator $\rho=\tr_E\tilde{\rho}$ is not affected by $R$.
We can easily prove this for operators $\tilde{\rho}$ that are tensor products $\tilde{\rho}=X\otimes Y$ (a good exercise to try yourself), and then, by linearity, extend the result to any operator $\tilde{\rho}$.

We must point out that our construction of quantum channels does not capture all possible quantum evolutions.
The assumption that the system and the environment are not initially correlated is crucial, and it does impose some restrictions on the applicability of our formalism.
Compare, for example, the following two versions of a process in which the system, initially in state $\rho$, undergoes two stages of evolution.

Firstly:

```{r,engine='tikz',engine.opts=list(template="tikz2pdf.tex"),fig.width=7}
\begin{equation*}
  \begin{quantikz}
    \lstick{$\rho$} &\gate[2]{U_A} &\rstick{$\rho'$} \qw & &\gate[2]{U_B} &\rstick{$\rho''$} \qw
  \\\lstick{$\ket{e}$} &\qw &\qw &\qw &\qw & \ar[d,dash,thickness]\qw
  \\& & & & &\bullet
  \end{quantikz}
\end{equation*}
```

Here, the environment is not discarded after the first unitary evolution $U_A$ --- it carries on and participates in the second unitary evolution $U_B$.
In this case, the evolutions $\rho\mapsto\rho'$ and $\rho\mapsto\rho''$ _are_ well-defined quantum channels, but the evolution $\rho'\mapsto\rho''$ is _not_; it falls outside the remit of our formalism for the input state of the system and the state of the environment are not independent.

Secondly:

```{r,engine='tikz',engine.opts=list(template="tikz2pdf.tex"),fig.width=7}
\begin{equation*}
  \begin{quantikz}
    \lstick{$\rho$} &\gate[2]{U_A} &\qw &\rstick{$\rho'$} \qw & &\qw &\gate[2]{U_B} &\rstick{$\rho''$} \qw
  \\\lstick{$\ket{a}$} & &\qw \ar[d,dash,thickness]\qw & & & \lstick{$\ket{b}$} &\qw &\ar[d,dash,thickness]\qw
  \\& &\bullet & & & & &\bullet
  \end{quantikz}
\end{equation*}
```

In contrast to the previous process, here we discard the environment after the first unitary, and start the second unitary evolution in a fresh tensor product state with a _new_ environment --- the two stages involve independent environments.
In this case, all three evolutions ($\rho\mapsto\rho'$, $\rho'\mapsto\rho''$, and $\rho\mapsto\rho''$) are well-defined quantum channels, and can be composed.^[Unitary evolutions form a group; quantum channels form a _[semigroup](https://en.wikipedia.org/wiki/Semigroup)_. Quantum channels are invertible only if they are unitary operations or simple isometric embeddings, such as including the environment in some fixed state and then discarding it right away, without any intermediate interaction.]
If $\mathcal{E}_A$ describes the evolution from $\rho$ to $\rho'$, and $\mathcal{E}_B$ the evolution from $\rho'$ to $\rho''$, then the composition $\mathcal{E}_B\mathcal{E}_A$ describes the evolution from $\rho$ to $\rho''$.

In practice, we often deal with complex environments that have internal dynamics that "hide" any entanglement with the system as quickly as it arises.
For example, let our system be an atom, surrounded by electromagnetic field (which serves as the environment), and let the field start in the vacuum state.
If the atom emits a photon into the environment, then the photon quickly propagates away, and the immediate vicinity of the atom appears to be empty, i.e. it resets to the vacuum state.
In this approximation, we assume that the environment quickly forgets about its state resulting from any previous evolution.
This is known as the **Markov approximation**, and, in the quantum Markov process^[[Andrey Markov](https://en.wikipedia.org/wiki/Andrey_Markov) (1929--2012) was a Russian mathematician best known for his work on stochastic processes.], the environment has essentially no memory.






### Operator sum representation

The unitary representation of a quantum channel is usually too general to be of any practical use, at least for our purposes.
We will find it convenient, as you will see when we start discussing quantum error correction, to choose an orthonormal basis $\{\ket{e_k}\}$ of $\mathcal{H}_E$, and express the joint (i.e. "system plus environment") unitary evolution $U$ as
$$
  U(\ket{\psi}\otimes\ket{e})
  = \sum_k E_k\ket{\psi}\otimes\ket{e_k}
$$
where $E_k$ is an operator on $\mathcal{H}$ defined by
$$
  E_k\ket{\psi}
  = \bra{e_k}U(\ket{\psi}\otimes\ket{e})
$$
for any vector $\ket{\psi}\in\mathcal{H}$
Think about $\bra{e_k}U(\ket{\psi}\otimes\ket{e}$ as a partial inner product^[Recall that, given $\mathcal{H}_A\otimes\mathcal{H}_B$, the **partial inner product** of $\ket{x}\in \mathcal{H}_A$ and $\ket{a}\otimes\ket{b}\in\mathcal{H}_A\otimes\mathcal{H}_B$ is first defined by the formula $$\bra{x}(\ket{a}\otimes\ket{b}) = \braket{x}{a}\ket{b}$$ and then extended to other (non-direct tensor product) vectors in  $\mathcal{H}_A\otimes \mathcal{H}_B$ by linearity.] of $\ket{e_k}\in\mathcal{H}_E$ and  $U\ket{\psi}\ket{e}\in \mathcal{H}\otimes\mathcal{H}_E$.
In analogy with classical communication channels we sometimes refer to the operators $E_k$ as **quantum errors**.

The intuition behind the expression
$$
  \ket{\psi}\otimes \ket{e}
  \longmapsto \sum_k E_k\ket{\psi}\otimes\ket{e_k}
$$
is that the operation $E_k$ (which changes the state of the system as $\ket{\psi}\mapsto E_k\ket{\psi}$) occurs with the probability $p_k=\bra{\psi}E^\dagger_k E_k\ket{\psi}$.
The probabilities sum up to one, i.e. $\sum_k p_k=\bra{\psi}E^\dagger_k E_k\ket{\psi} =1$ for any state $\ket{\psi}$, and so the operators $E_k$ must satisfy the completeness relation
$$
  \sum_k E^\dagger_k E_k=\id.
$$

Note that the matrix $U$ acts on the tensor product space, which gives it a natural partition into blocks of sub-matrices, such as $E_k=\bra{e_k}U\ket{e}$.
In order to visualise $E_k=\bra{e_k}U\ket{e}$, write $U$ as a matrix on $\mathcal{H}_E\otimes\mathcal{H}$ rather than $\mathcal{H}\otimes\mathcal{H}_E$ (i.e. place the environment first and the system second).
Then, in a tensor product basis in which $\ket{e}\equiv\ket{e_1}$, the $(d\times d)$ matrices $E_k$ form the first block column:
$$
U=
  \left[
  \,
    \begin{array}{c|c|c}
        E_1
      & \cdots
      & \cdot
    \\\hline
      E_2
      & \cdots
      & \cdot
    \\\hline
       \vdots
      & \ddots
      & \vdots
    \\\hline
      E_n
      & \cdots
      & \cdot
    \end{array}
  \,
  \right].
$$
The remaining entries of $U$ are irrelevant for the purpose of describing our sub-dynamics, since we have fixed the initial state of the environment.
If we had chosen $\ket{e}\equiv\ket{e_2}$ instead, then we would have been looking at the matrices in the _second_ block column, and all other entries would be irrelevant.
You see the pattern, right?
Here, the $k$ in $E_k$ ranges from $1$ to some $n\leq D$, if we discount zero matrices.
Finally, to be clear, reversing the order of the system and the environment does not affect the physical description _as long as we remember which part is which_.
We changed the order just for pedagogical purposes; you can stick to the original order if you wish, but then the entries of $E_k$ will be dispersed all over the matrix $U$.

Now, if we express the system-plus-environment evolution in terms of density operators
$$
  \proj{\psi}\otimes\proj{e}
  \longmapsto \sum_{k,l} E_k\proj{\psi} E^\dagger_l\otimes \ket{e_k}\bra{e_l}
$$
and trace over the environment, then we can write the evolution of the system alone as
$$
  \proj{\psi}
  \longmapsto \sum_k E_k\proj{\psi} E^\dagger_k.
$$
Recall that any density operator can be represented as a statistical mixture of pure states, and so:

::: {.idea data-latex=""}
The above equation can be generalised and written as
$$\rho\longrightarrow \sum_k E_k\rho E^\dagger_k$$
where $\rho$ is any state of the system, pure or mixed.

It turns out that _all_ quantum channels can be represented in this way, which is known as the **operator sum representation**, or the **Kraus representation**.
The operators $E_k$ are often referred to as the **Kraus** operators.^[[Karl Kraus](https://en.wikipedia.org/wiki/Karl_Kraus_(physicist)) (1938--1988) was a German physicist.]
:::

The operator sum (Kraus) representation follows from the unitary representation once we choose an orthonormal basis in $\mathcal{H}_E$.
Conversely, given an operator sum representation $E_k\in\mathcal{B}(\mathcal{H})$ of the channel $\mathcal{E}$, we can always view it as an operation resulting from a unitary map acting on some extended system: we just introduce an auxiliary system, the environment, which has dimension equal to the number of Kraus operators, and then choose an orthonormal basis $\ket{e_k}$.
We then define $U$ via $U\ket{\psi}\ket{e}\mapsto\sum_k E_k\ket{\psi}\ket{e_k}$.
It is convenient to choose $\ket{e}\equiv\ket{e_1}$; in this case the operators $E_k$ form the first block column of $U$.
All other entries can be chosen as you please (as long as $U$ remains unitary).

By now it should be clear that an operator sum representation of a given quantum channel is _not_ unique: once we fix $U$ and $\ket{e}$, and hence define a quantum channel, we may still choose the basis vectors $\ket{e_k}$ in $\mathcal{H}_E$ as we please.
This means that the Kraus operators $E_k=\bra{e_k}U\ket{e}$ and $F_k=\bra{f_k}U\ket{e}$, where $\{\ket{e_k}\}$ and $\{\ket{f_k}\}$ are two orthonormal bases, describe the same quantum channel.
They are unitarily related:
$$
  \begin{aligned}
    F_k
    &=\bra{f_k} U\ket{e}
  \\&=\sum_l\braket{f_k}{e_l}\bra{e_l}U\ket{e}
  \\&=\sum_l \braket{f_k}{e_l} E_l
  \\&=\sum_l R_{kl} E_l
  \end{aligned}
$$
where $R_{kl}=\braket{f_k }{e_l}$ is a unitary matrix, and we have used the decomposition of the identity $\sum_l\proj{e_l}=\id_E$.
In fact, the converse holds true as well:

::: {.idea data-latex=""}
Suppose that $E_1,\ldots,E_n$ and $F_1,\ldots,F_m$ are Kraus operators associated to the quantum channels $\mathcal{E}$ and $\mathcal{F}$, respectively.
Let us append zero operators to the shorter list to ensure that $n=m$.

_Then $\mathcal{E}$ and $\mathcal{F}$ describe the same channel if and only if $F_k=\sum_l R_{kl} E_l$ for some unitary $R$._
:::

It is easy to see the reverse implication:
$$
  \begin{aligned}
    \mathcal{F}(\rho)
    &=\sum_k F_k\rho F^\dagger_k
  \\&= \sum_{ijk} R_{ki}E_i \rho E^\dagger_j R^\star_{jk}
  \\&=\sum_{ij} \underbrace{\left(\sum_k R_{jk}^\star R_{ki}\right)}_{\delta_{ij}} E_i\rho E^\dagger_j
  \\&= \sum_j E_j\rho E^\dagger_j
  \\&= \mathcal{E} (\rho).
  \end{aligned}
$$

Without any restrictions on the operators $E_k$, any map of the form $U\mapsto\sum_k E_k U E_k^\dagger$ preserves Hermiticity and positivity.^[Prove this!]
If we additionally require the completeness relation $\sum_k E_k^\dagger E_k=\id$, then the map becomes trace-preserving:
$$
  \begin{aligned}
    \tr\mathcal{E}(\rho)
    &= \tr\sum_k E_k\rho E_k^\dagger
  \\&= \tr\left[\underbrace{\left(\sum_k E^\dagger_k E_k\right)}_{\id} \rho\right]
  \\&= \tr\rho
  \\&= 1.
  \end{aligned}
$$

Any unitary evolution of a density operator
$$
  \rho \longmapsto U\rho U^\dagger
$$
is a trivial example of the operator sum representation, with just one Kraus operator $U$.
Next we may consider a probability distribution on a finite set of unitary operations $U_1,\ldots, U_m$.
In this scenario, $U_k$ will be chosen at random according to the probability distribution $p_1\ldots p_k \ldots p_m$, and applied to $\rho$.
If this is all that is known about the procedure, then the resulting transformation of $\rho$ can be written as
$$
  \begin{aligned}
    \rho\longmapsto
    &\sum_k p_k U_k\rho U_k^\dagger
  \\=&\sum_k  \underbrace{\sqrt{p_k} U_k}_{E_k}  \rho \underbrace{U_k^\dagger\sqrt{p_k}}_{E_k^\dagger}
  \\=&\sum_k E_k\rho E^\dagger_k.
  \end{aligned}
$$
In this case,
$$
  \rho\longmapsto \sum_k E_k\rho E_k^\dagger
$$
where $\sum_k E_k^\dagger E_k = \sum_k E_k E^\dagger_k =\id$.
This is an example of a **unital channel**, i.e. one for which $\sum_k E_k E^\dagger_k =\id$; such a channel sends maximally mixed inputs to maximally mixed outputs (if $\rho \propto \id$, then so too is $\rho'$).

In particular, if we restrict our attention to qubits, and choose the unitaries to be the identity and the three Pauli operators, then we construct what is known as a **Pauli channel**:
$$
  \rho
  \longmapsto p_0 \id\rho\id + p_x X\rho X + p_y Y\rho Y + p_z Z\rho Z.
$$

The most popular Pauli channel is the **depolarising channel**
$$
  \rho
  \longmapsto (1-p) \id\rho\id + \frac{p}{3} (X\rho X + Y\rho Y + Z\rho Z).
$$
In the depolarising channel, a qubit in state $\rho$ remains intact with probability $1-p$, or is otherwise transformed under one of the Pauli operators $X$, $Y$, or $Z$, each chosen randomly with probability $p/3$.

**Useful exercise.**
Show that the action of the depolarising channel is equivalent to the following operation: _with probability $p$, the input state is thrown away and replaced with the maximally mixed state, and with probability $(1-p)$ the input state survives without any disturbance_.
Use the Bloch sphere picture and show that the depolarising channel uniformly contracts the sphere by the factor $1-\frac{4}{3}p$.






### Expand, evolve, and discard

We shall now discuss two important operations: _adding_ and _discarding_ subsystems.
You need to pay attention to the dimensions of the Hilbert spaces involved, for they are different.
Given a system $\mathcal{A}$, we can bring in another system $\mathcal{B}$ to form the combined system $\mathcal{AB}$.
This will be described by a map (**expansion**)
$$
  \mathcal{B}(\mathcal{H}_A)
  \longrightarrow \mathcal{B}(\mathcal{H}_A\otimes\mathcal{H}_B).
$$
Conversely, given a composite system $\mathcal{AB}$, we can discard subsystem $\mathcal{B}$, which is described by a map (**reduction**)
$$
  \mathcal{B}(\mathcal{H}_A\otimes\mathcal{H}_B)
  \longrightarrow \mathcal{B}(\mathcal{H}_A).
$$
We will show now that the two operations can be written in the operator sum representation.
For consistency with the rest of the exposition, we will choose $\mathcal{A}$ to be the system and $\mathcal{B}$ the environment.

- **Expansion.**
    Any quantum system can be expanded by bringing in an auxiliary system (here, the environment) in a fixed state.
    This is described by the **isometric embedding**
    $$
      \ket{\psi}
      \longmapsto \ket{\psi}\otimes\ket{e}
      = (\id\otimes\ket{e}) \ket{\psi}.
    $$
    It takes vectors in the Hilbert space associated with the original system, $\mathcal{H}$ (where $\dim\mathcal{H}=d$) and tensors them with a fixed vector $\ket{e}$ in the Hilbert space associated with the environment, $\mathcal{H}_E$ (where $\dim\mathcal{H}_E=d_E$).
    So it _embeds_ the structure of $\mathcal{H}$ into a larger Hilbert space $\mathcal{H}\otimes\mathcal{H}_E$ (where $\dim\mathcal{H}\otimes\mathcal{H}_A=d\cdot d_E$).
    In terms of density operators, we write the expansion as
    $$
      \begin{aligned}
        \rho
        \longmapsto &\rho\otimes\proj{e}
      \\=& (\id\otimes\ket{e})\rho (\id\otimes\bra{e})
      \\=& E\rho E^\dagger
      \end{aligned}
    $$
    where $E=\id\otimes\ket{e}$ can be represented by a $(d\times(d\cdot d_E))$ matrix.
    We note that $E^\dagger E=\id\otimes\braket{e}{e}=\id$ is the identity in $\mathcal{H}$.

- **Reduction.**
    We can also discard a part of a composed system.
    If $\rho\in\mathcal{B}(\mathcal{H}\otimes\mathcal{H}_E)$ is a joint state of the system and the environment (the two may be entangled), then we can neglect or discard the environment by tracing over it:
    $$
      \begin{aligned}
        \rho
        &\longmapsto \tr_E\rho
      \\=&\sum_k (\id\otimes \bra{e_k}) \rho (\id\otimes \ket{e_k})
      \\=& \sum_k E_k \rho E^\dagger_k
      \end{aligned}
    $$
    where $E_k=\id\otimes\bra{e_k}$ and can be represented by a $(d\cdot d_E)\times d$ matrices.
    Again, we note that $\sum_k E_k^\dagger E_k=\id\otimes\sum_k\proj{e_k}=\id\otimes\id_E$ is the identity in $\mathcal{H}\otimes\mathcal{H}_E$.

So both expansion and reduction can be expressed in the operator sum representation as $\rho\mapsto\sum_k E_k\rho E_k^\dagger$, where $\sum_k E_k^\dagger E_k=\id$.
Here, the identity operator acts on the Hilbert space associated with the original density operator $\rho$, that is, $\mathcal{H}$ for the expansion and $\mathcal{H}\otimes\mathcal{H}_E$ for the reduction.
Note that we do _not_ require that $\sum_k E_k E^\dagger_k =\id$.

The next thing to notice is that we can compose quantum channels.
This is straightforward in the operator sum representation: if
$$
  \begin{gathered}
    \mathcal{E}_A\colon \rho
    \longmapsto\sum_i A_i\rho A^\dagger_i
  \\\text{where $\sum_i A^\dagger_i A_i=\id$}
  \end{gathered}
$$
and
$$
  \begin{gathered}
    \mathcal{E}_B\colon \rho
    \longmapsto\sum_j B_j\rho B^\dagger_j
  \\\text{where $\sum_j B^\dagger_j B_j=\id$}
  \end{gathered}
$$
then
$$
  \mathcal{E}_B\mathcal{E}_A\colon \rho
  \longmapsto \sum_{ij} (B_jA_i) \rho (B_jA_i)^\dagger
$$
where the $B_jA_i$ are the Kraus operators associated with the new channel $\mathcal{E}_B\mathcal{E}_A$.
We can verify that
$$
  \begin{aligned}
    \sum_{ij} (B_jA_i)^\dagger (B_jA_i)
    &= \sum_i A_i^\dagger\left(\sum_j B_j^\dagger B_j\right)A_i
  \\&= \sum_i A_i^\dagger A_i
  \\&= \id.
  \end{aligned}
$$

::: {.idea data-latex=""}
We now postulate that _any quantum channel is a composition of the three elementary operations_:

1. **expansion**, i.e. bringing in another physical system in a fixed state (via an isometric embedding);
2. **unitary evolution** of the _whole_ system; and
3. **reduction**, i.e. discarding everything we do not care about (via the partial trace).
:::

Given that any unitary evolution $\rho\mapsto U\rho U^\dagger$ can be explicitly expressed in the operator sum form, the typical sequence "expand -- unitary -- reduce", which is the composition of three quantum channels, also admits an operator sum representation.

From a _mathematical_ perspective, we have extended the class of quantum evolutions from
$$
  \rho
  \longmapsto U\rho U^\dagger
  \quad\text{with $U^\dagger U=\id$}
$$
to
$$
  \rho
  \longmapsto \sum_k E_k\rho E^\dagger_k
  \quad\text{with $\sum_k E^\dagger_k E_k=\id$.}
$$

To be clear, we are not claiming here that the operator sum representation has any fundamental significance: it simply follows from a unitary evolution of a larger quantum system, and it is a convenient mathematical shortcut when we deal with subsystems of that larger system.






## The axiomatic approach

### Completely positive maps

Let us now turn to the axiomatic approach.
What are the most general transformations that map density operators to density operators?

The first thing to notice is that any such a transformation $\mathcal{E}$ must respect the mixing of states.
Consider an ensemble of systems, with a fraction $p_1$ of them in the state $\rho_1$, and the remaining $p_2$ of them in the state $\rho_2$.
The overall ensemble is described by $\rho=p_1\rho_1+p_2\rho_2$.
If we apply $\mathcal{E}$ to each member of the ensemble, then the overall ensemble will be described by the density operator $\rho'=\mathcal{E}(\rho)$, which is $\rho'=p_1 \mathcal{E}(\rho_1)+p_2 \mathcal{E}(\rho_2)$.
We conclude that $\mathcal{E}$ must be a _linear_ map^[More precisely, we require that $\mathcal{E}$ be an _affine_ map.] on density operators: $\mathcal{E}\colon\mathcal{B}(\mathcal{H})\mapsto \mathcal{B}(\mathcal{H}')$.
Moreover, since $\mathcal{E}$ maps density operators to density operators, it must be **positive** ($\mathcal{E}(\rho)\geq0$ whenever $\rho\geq0$) and **trace preserving** ($\tr \mathcal{E}(\rho)=\tr\rho$ for all $\rho\in\mathcal{B}(\mathcal{H})$).
Can we stop here and conclude that quantum channels are described by linear, positive, trace-preserving maps?

It turns out that there is one more property which must added to the list: we must require that the map remains positive even when it acts on a part of a larger system.
That is, for any bipartite state $\rho_{AB}$ of a composed system $\mathcal{A}\mathcal{B}$, the extended map $\mathcal{I}\otimes\mathcal{E}$ (meaning "apply $\mathcal{E}$ to either one of the subsystems (it does not matter which one; here we have chosen subsystem $\mathcal{B}$), and do nothing (i.e. apply the identity map $\mathcal{I}$) to the remaining subsystem")^[Note the difference between $\id$ and $\mathcal{I}$. They are both identity maps, but $\id$ is the identity operator on $\mathcal{H}$, i.e. the (unitary) identity matrix; $\mathcal{I}$ is the identity _superoperator_ (or quantum channel), i.e. the identity superoperator that acts on operators on $\mathcal{H}$.] gives a proper density operator $\rho'_{AB}$:
$$
  \rho'_{AB} = (\mathcal{I}\otimes\mathcal{E})(\rho_{AB}) \geq 0.
$$

We can represent this construction of $\rho'_{AB}$ diagrammatically^[In fact, a _lot_ of quantum information theory can be converted into similar looking diagrams, using the formalism of **string diagrams** from **category theory**. A related concept is that of [ZX-calculus](https://zxcalculus.com/intro.html).] as follows:

```{r,engine='tikz',engine.opts=list(template="tikz2pdf.tex"),fig.width=7}
\begin{equation*}
  \begin{quantikz}
    &&\qw &\gate{\mathcal{I}} &\qw &\qw
  \\\lstick{$\rho_{AB}$} \ar[dr,dash,thickness] \ar[ur,dash,thickness]&&&&& \rstick{$\rho'_{AB}$}&
  \\&&\qw &\gate{\mathcal{E}} &\qw &\qw
  \end{quantikz}
\end{equation*}
```

This is a stronger property than mere positivity; now we are asking for something called **complete positivity**.
You may naively think that such trivial extensions of positive maps must be also positive, but this is not the case: the positivity of $\mathcal{E}$ does _not_ imply the positivity of its extension $\mathcal{I}\otimes\mathcal{E}$.
_Positivity does not imply complete positivity!_
Why?
_Because physical systems do not exist in isolation_; applying $\mathcal{E}$ to a part of the whole and doing nothing (i.e. applying the identity) to the rest may mess up the state of the whole in an unacceptable way.
This is a very quantum phenomenon, and is another consequence of quantum entanglement between parts of the composite system.

A simple example of a positive map that is not completely positive is the transpose.
Consider the transpose operation on a single qubit: $T\ket{i}\bra{j}\mapsto\ket{j}\bra{i}$ (for $i,j=0,1$).
It preserves both trace and positivity, and, if $\rho$ is a density matrix, then so is $\rho'=\rho^T$.
However, if the input qubit is part of a _two-qubit_ system, initially in the entangled state $\ket{\Omega}=\frac{1}{\sqrt{2}}(\ket{0}\ket{0}+\ket{1}\ket{1})$, and the transpose is applied to _only one_ of the two qubits, (say, the second one) then, under the action of the partial transpose $\mathcal{I}\otimes T$, the density matrix of the two qubits becomes
$$
  \begin{aligned}
    \proj{\Omega}
    =& \frac{1}{2}\sum_{ij} \ket{i}\bra{j} \otimes \ket{i}\bra{j}
  \\\xmapsto{\mathcal{I}\otimes T}& \frac{1}{2}\sum_{ij} \ket{i}\bra{j} \otimes T(\ket{i}\bra{j})
  \\=& \frac{1}{2}\sum_{ij} \ket{i}\bra{j} \otimes \ket{j}\bra{i}.
  \end{aligned}
$$
The output is the $\texttt{SWAP}$ matrix, since it describes the $\texttt{SWAP}$ operation: $\ket{j}\ket{i}\mapsto\ket{i}\ket{j}$.
Since the square of $\texttt{SWAP}$ is the identity, its eigenvalues are $\pm1$; states which are symmetric under interchange of the two qubits have eigenvalue $1$, while antisymmetric states have eigenvalue $-1$.
Thus the $\texttt{SWAP}$ matrix has negative eigenvalues, which means that $\mathcal{I}\otimes T$ does _not_ preserve positivity, and therefore $T$ is _not_ a completely positive map.
If you prefer to see this more explicitly, then you can use the matrix representation of $\proj{\Omega}$, apply the partial transpose $\mathcal{I}\otimes T$, and inspect the resulting matrix:
$$
  \half\left[
  \begin{array}{cc|cc}
    1 & 0 & 0 & 1
  \\0 & 0 & 0 & 0\\
  \hline
  0 & 0 & 0 & 0
  \\1 & 0 & 0 & 1
  \end{array}\right]
  \xmapsto{\mathcal{I}\otimes T}
  \half\left[
  \begin{array}{cc|cc}
    1 & 0 & 0 & 0
  \\0 & 0 & 1 & 0\\
  \hline
 0 & 1 & 0 & 0
  \\0 & 0 & 0 & 1
  \end{array}\right].
$$
The partial transpose maps the density matrix of a maximally entangled state $\proj{\Omega}$ to the $\texttt{SWAP}$ matrix, which has one negative eigenvalue (namely $-1$), and so is not a density matrix.

So how can we tell if a given map $\mathcal{E}$ is completely positive or not?
The answer is "in pretty much the same way we discovered that the transpose is not a completely positive map".
It suffices to apply $\mathcal{I}\otimes\mathcal{E}$ (or $\mathcal{E}\otimes \mathcal{I}$) to the maximally entangled state of two subsystems and check if the result is a legal density matrix.
In fact, it works both ways:

::: {.idea data-latex=""}
A linear map $\mathcal{E}\colon B(\mathcal{H}) \rightarrow B(\mathcal{H}')$ is completely positive iff $(\mathcal{I}\otimes\mathcal{E})(\proj{\Omega})\geq0$, where $\ket{\Omega}$ is a maximally entangled state of dimension $d=\dim{\mathcal{H}}$.
:::

(ref:cp-test-caption) Test for complete positivity: apply the map $\mathcal{E}$ to half of a maximally entangled state and check if the resulting bipartite operator is a density operator.

```{r cp-test,engine='tikz',engine.opts=list(template="tikz2pdf.tex"),fig.width=7,fig.cap='(ref:cp-test-caption)'}
\newcommand{\id}{\mathbf{1}}
\begin{equation*}
  \begin{quantikz}
    &&\qw &\gate{\mathcal{I}} &\qw &\qw
  \\\lstick{$\ket{\Omega}$} \ar[dr,dash,thickness] \ar[ur,dash,thickness] &&&&&\rstick{$\geq0$?}
  \\&&\qw &\gate{\mathcal{E}} &\qw &\qw
  \end{quantikz}
\end{equation*}
```

Clearly, if $\mathcal{E}$ is completely positive, then, from the definition, $(\mathcal{I}\otimes\mathcal{E})(\proj{\Omega})\geq0$.
Conversely, in order to check if $(\mathcal{I}\otimes\mathcal{E})(\rho_{AB})\geq0$ holds for any bipartite state $\rho_{AB}$, it is sufficient to consider only pure states, e.g. the states that appear in the spectral decomposition of $\rho_{AB}$.
Any such pure bipartite state $\ket{\Psi}$ can be written as $(A\otimes\id)\ket{\Omega}$ or $(\id\otimes B)\ket{\Omega}$, for some linear operators $A$ and $B$, on subsystems $\mathcal{A}$ or $\mathcal{B}$, respectively:^[The state $\ket{\Psi}$ has the Schmidt decomposition $\sum_k\lambda_k\ket{k}\ket{k}$, where $\lambda^2_k$ are the eigenvalues of the reduced density operators $\sigma_A$ and $\sigma_B$. Thus $\ket{\Psi}$ can be written as $(\sqrt{d\sigma_A}\otimes\id)\ket{\Omega}$ or $(\id\otimes \sqrt{d\sigma_B})\ket{\Omega}$, where $d$ is the Schmidt rank.]

```{r,engine='tikz',engine.opts=list(template="tikz2pdf.tex"),fig.width=14,fig.cap='All three of these operations are equal.'}
\newcommand{\id}{\mathbf{1}}
\begin{equation*}
  \begin{quantikz}
    &&\qw &\gate{\id} &\qw &\qw
  \\\lstick{$\ket{\Psi}$} \ar[dr,dash,thickness] \ar[ur,dash,thickness]
  \\&&\qw &\gate{\id} &\qw &\qw
  \end{quantikz}
\end{equation*}
\begin{equation*}
  \begin{quantikz}
    &&\qw &\gate{A} &\qw &\qw
  \\\lstick{$\ket{\Omega}$} \ar[dr,dash,thickness] \ar[ur,dash,thickness]
  \\&&\qw &\gate{\id} &\qw &\qw
  \end{quantikz}
  \quad
  \begin{quantikz}
    &&\qw &\gate{\id} &\qw &\qw
  \\\lstick{$\ket{\Omega}$} \ar[dr,dash,thickness] \ar[ur,dash,thickness]
  \\&&\qw &\gate{B} &\qw &\qw
  \end{quantikz}
\end{equation*}
```

Given that the map $\mathcal{E}$ acts only on the subsystem $\mathcal{B}$, we have that
$$
  \begin{gathered}
    (\mathcal{I}\otimes\mathcal{E})[(A\otimes\id)\proj{\Omega}(A^\dagger\otimes\id)]
  \\= (A\otimes\id)[(\mathcal{I}\otimes\mathcal{E})(\proj{\Omega})](A^\dagger\otimes\id),
  \end{gathered}
$$
and if $(\mathcal{I}\otimes\mathcal{E})(\proj{\Omega})$ is positive semidefinite, then so too is $(A\otimes\id)[(\mathcal{I}\otimes\mathcal{E})(\proj{\Omega})](A^\dagger\otimes\id)$.

```{r,engine='tikz',engine.opts=list(template="tikz2pdf.tex"),fig.width=14,fig.cap='All three of these operations are also equal.'}
\newcommand{\id}{\mathbf{1}}
\definecolor{primary}{RGB}{177,98,78}
\begin{equation*}
  \begin{quantikz}
    &&\qw &\gate{\mathcal{I}} &\qw &\qw
  \\\lstick{$\ket{\Psi}$} \ar[dr,dash,thickness] \ar[ur,dash,thickness]
  \\&&\qw &\gate{\mathcal{E}} &\qw &\qw
  \end{quantikz}
\end{equation*}
\begin{equation*}
  \begin{quantikz}
    &&\gate{A}\slice\qw &\gate{\mathcal{I}} &\qw
  \\\lstick{$\ket{\Omega}$} \ar[dr,dash,thickness] \ar[ur,dash,thickness]
  \\&&\gate{\id} &\gate{\mathcal{E}} &\qw
  \end{quantikz}
  \quad
  \begin{quantikz}
    &&\gate{\mathcal{I}}\slice\qw &\gate{A} &\qw
  \\\lstick{$\ket{\Omega}$} \ar[dr,dash,thickness] \ar[ur,dash,thickness]
  \\&&\gate{\mathcal{E}} &\gate{\id} &\qw
  \end{quantikz}
\end{equation*}
```






### The Choi matrix

If we choose bases of $\mathcal{H}$ and $\mathcal{H}'$ (where $\dim\mathcal{H}=d$ and $\dim\mathcal{H}'=d'$), then any linear map $\mathcal{E}\colon\mathcal{B}(\mathcal{H})\rightarrow\mathcal{B}(\mathcal{H'})$ can be completely characterised by its action on the $d^2$ basis matrices $\ket{i}\bra{j}$, where $i,j=1,2\ldots,d$.

::: {.idea data-latex=""}
The **Choi matrix $\widetilde{\mathcal{E}}$** of $\mathcal{E}$ is defined by
$$
  \widetilde{\mathcal{E}}
  = (\mathcal{I}\otimes\mathcal{E})\proj{\Omega}
  =\frac{1}{d}\sum_{i,j}\ket{i}\bra{j}\otimes\mathcal{E}(\ket{i}\bra{j})
$$
where $\ket{\Omega}$ is a maximally entangled state.

```{r,engine='tikz',engine.opts=list(template="tikz2pdf.tex"),fig.width=8}
\begin{equation*}
  \begin{quantikz}
    \lstick{$\dim\mathcal{H}=d$}&&\qw &\gate{\mathcal{I}} &\qw &\qw\rstick{$\dim\mathcal{H}=d$}
  \\\lstick{$\Omega$} \ar[dr,dash,thickness] \ar[ur,dash,thickness]
  \\\lstick{$\dim\mathcal{H}=d$}&&\qw &\gate{\mathcal{E}} &\qw &\qw\rstick{$\dim\mathcal{H}'=d'$}
  \end{quantikz}
\end{equation*}
```
:::

The Choi matrix is a neat way of tabulating all possible values of $\mathcal{E}(\ket{i}\bra{j})$, since the $(i,j)$-th block entry of $\widetilde{\mathcal{E}}$ is the $(d'\times d')$-matrix $\mathcal{E}(\ket{i}\bra{j})$:

```{r,engine='tikz',engine.opts=list(template="tikz2pdf.tex"),fig.width=7}
\definecolor{primary}{RGB}{177,98,78}
\definecolor{secondary}{RGB}{91,132,177}
\begin{equation*}
  \widetilde{\mathcal{E}} =
  \left[\,
  \setlength\arraycolsep{0.4em}
  \def\arraystretch{1.5}
    \begin{array}{cccc}
      \cellcolor{secondary!20}\mathcal{E}(\ket{0}\bra{0})
      & \mathcal{E}(\ket{0}\bra{1})
      & \cellcolor{secondary!20}\mathcal{E}(\ket{0}\bra{2})
      & \cdots
    \\\mathcal{E}(\ket{1}\bra{0})
      & \cellcolor{secondary!20}\mathcal{E}(\ket{1}\bra{1})
      & \mathcal{E}(\ket{1}\bra{0})
      & \cdots
    \\\cellcolor{secondary!20} \mathcal{E}(\ket{2}\bra{0})
      & \mathcal{E}(\ket{2}\bra{1})
      & \cellcolor{secondary!20}\mathcal{E}(\ket{2}\bra{2})
      & \cdots
    \\\vdots
      & \vdots
      & \vdots
      & \ddots
    \end{array}
  \,\right].
\end{equation*}
```

Of course, once we know how $\mathcal{E}$ acts on the $d^2$ basis matrices $\ket{i}\bra{j}$, we know how it acts on any $(d\times d)$ matrix $X=\sum_{ij}X_{ij}\ket{i}\bra{j}$, since $\mathcal{E}(X) = \sum_{ij}X_{ij}\mathcal{E}(\ket{i}\bra{j})$, where $i,j=1,\ldots, d$.
This can be written as follows:

::: {.idea data-latex=""}
$$
  \mathcal{E}(X) =  d \tr_A [(X^T\otimes\id)\widetilde{\mathcal{E}}]
$$
:::

where the partial trace is taken over the "first half" of the entangled state, the part to which we did not apply $\mathcal{E}$ in our construction of $\widetilde{\mathcal{E}}$.

In practice it is more convenient to use the following formula (which holds for any $(d\times d)$ matrix $X$ and any $(d'\times d')$ matrix $Y$):

::: {.idea data-latex=""}
$$
 \tr\mathcal{E}(X)Y
 = \tr\widetilde{\mathcal{E}} (X^T\otimes Y)
$$
:::

For example, if we are interested in the component $\mathcal{E}(X)_{ij}= \bra{i}\mathcal{E}(X)\ket{j}$, then we take $Y=\ket{j}\bra{i}$.

The Choi matrix $\widetilde{\mathcal{E}}$ in $\mathcal{B}(\mathcal{H}\otimes\mathcal{H'})$ is essentially another way of representing the linear map $\mathcal{E}\colon\mathcal{B}(\mathcal{H})\rightarrow\mathcal{B}(\mathcal{H'})$.
One can express all properties of $\mathcal{E}$ in terms of properties of $\widetilde{\mathcal{E}}$, e.g. "$\mathcal{E}$ is completely positive if and only if $\widetilde{\mathcal{E}}\geq0$", or "$\mathcal{E}$ is trace preserving if $\tr_B\widetilde{\mathcal{E}}=d\id$".

As an example, any linear map $\mathcal{E}$ acting on a qubit can be completely characterised by its action on the four basis matrices $\ket{i}\bra{j}$ (for $i,j=0,1$) and thus represented as the $(4\times 4)$ Choi matrix
$$
  \widetilde{\mathcal{E}}
  = \frac12
  \left[
    \begin{array}{c|c}
      \mathcal{E}(\ket{0}\bra{0}) & \mathcal{E}(\ket{0}\bra{1})
    \\\hline
      \mathcal{E}(\ket{1}\bra{0}))  & \mathcal{E}(\ket{1}\bra{1})
    \end{array}
  \right].
$$

Consider the following map:
$$
  \mathcal{E}_p\colon \ket{i}\bra{j}
  \longmapsto p \ket{j}\bra{i}+ (1-p)\delta_{ij} \frac{1}{2}\ket{i}\bra{j},
$$
where $0\leq p\leq 1$ is a parameter.
Its action on the four basis matrices is
$$
  \begin{gathered}
    \ket{0}\bra{0} = \begin{bmatrix}1&0\\0&0\end{bmatrix}
    \longmapsto \begin{bmatrix}\frac{1+p}{2}&0\\0&\frac{1-p}{2}\end{bmatrix}
  \\\ket{0}\bra{1} = \begin{bmatrix}0&1\\0&0\end{bmatrix}
    \longmapsto \begin{bmatrix}0&0\\p&0\end{bmatrix},
  \\\ket{1}\bra{0} = \begin{bmatrix}0&0\\1&0\end{bmatrix}
    \longmapsto \begin{bmatrix}0&p\\0&0\end{bmatrix}
  \\\ket{1}\bra{1} = \begin{bmatrix}0&0\\0&1\end{bmatrix}
    \longmapsto \begin{bmatrix}\frac{1-p}{2}&0\\0&\frac{1+p}{2}\end{bmatrix}
  \end{gathered}
$$
which we can neatly collect and tabulate in the corresponding Choi matrix:
$$
  \widetilde{\mathcal{E}_p}
  = \frac{1}{2}
  \left[
    \begin{array}{cc|cc}
      \frac{1+p}{2} & 0 & 0 & 0
    \\0 & \frac{1-p}{2} & p & 0
    \\\hline
      0 & p & \frac{1-p}{2} & 0
    \\0 & 0 & 0 & \frac{1+p}{2}
    \end{array}
  \right].
$$
This matrix contains all information about the map $\mathcal{E}_p$.
For example, $\mathcal{E}_p$ is completely positive if and only if $\widetilde{\mathcal{E}_p}\geq0$, which happens for $p\leq\frac{1}{3}$ (the eigenvalues of $\widetilde{\mathcal{E}_p}$ are $\frac{1}{4}(1+p)$ and $\frac{1}{4}(1-3p)$).

Stepping out of this example for minute, we now claim that _all quantum channels are described by completely positive trace preserving (CPTP) maps_. This is because we cannot think of any further restrictions we should be imposing on the linear maps $\mathcal{B}(\mathcal{H})\to\mathcal{B}(\mathcal{H'})$ to make them physically admissible.
Needless to say, mathematics alone cannot tell us what is physically admissible, but we can certainly compare this axiomatic approach with the constructive one.
As it happens, our claims makes sense, since we can show that a map is completely positive if and only if it can be written in the operator sum form.
In other words, _quantum channels are exactly completely positive trace-preserving (CPTP) maps_.
We will prove this in the next section

Returning to the example, the map $\mathcal{E}_p$ sends a density operator $\rho$ to
$$
  \rho \longmapsto p\rho^T +(1-p) \frac{1}{2}\id,
$$
where $\rho^T$ is the transpose of $\rho$.
Is this map a quantum channel?
That is, does it represent a physical process that can be implemented in a lab?
In the expression above, the convex sum on the right hand side can be interpreted as follows: take the input state $\rho$ and either apply the transpose or replace it with the maximally mixed state, with probabilities $p$ and $1-p$ respectively.
This is fine, except that the transpose operation is _not_ completely positive, and as such it is not physically admissible; it cannot be implemented.
Does it mean that this map cannot be implemented?
No, it does not: it just depends on the value of $p$.
The case $p=0$ corresponds to just replacing the input with the maximally mixed state, which is something that can be easily implemented.
However, as $p$ increases from $0$ to $1$, at some critical point the map switches from completely positive to positive. We know from the previous example that this critical point corresponds to $p=\frac{1}{3}$.

As a closing remark before moving on, note that the equivalence of linear maps $\mathcal{B}(\mathcal{H})\rightarrow \mathcal{B}(\mathcal{H'})$ and matrices in $\mathcal{B}(\mathcal{H}\otimes\mathcal{H'})$ is well known.
In the context of quantum channels it is often referred to as the **Choi-Jamiołkowski isomorphism**.
For CPTP maps, the Choi matrix is a density matrix, also known as the **Jamiolkowski state**, and the correspondence is referred to as the **channel-state duality**.
Mathematically, it is hardly surprising that the matrix elements of an operator on a tensor product can be reorganised and reinterpreted as the matrix elements of an operator between operator spaces.
What _is_ interesting, and perhaps not so obvious, is that the positivity conditions for maps and their Choi matrices match up exactly under this correspondence.






## Operator sum representation, revisited

The one remaining thing (well, almost) left to do is to bring the operator sum representation approach and the completely positive trace-preserving maps approach together, and show that they are essentially the same thing.

::: {.idea data-latex=""}
A linear map $\mathcal{E}\colon\mathcal{B}(\mathcal{H})\rightarrow\mathcal{B}(\mathcal{H}')$ is completely positive iff it admits an operator sum (Kraus) decomposition of the form
$$
  \mathcal{E}(\rho) = \sum_k E_k\rho E^\dagger_k.
$$

When this is the case, the above decomposition has the following properties:

- $\mathcal{E}$ is trace preserving iff $\sum_k E^\dagger_kE_k=\id$.
- Two sets of Kraus operators $\{E_k\}$ and $\{F_l\}$ represent the same map $\mathcal{E}$ iff there is a unitary $R$ such that $E_k =\sum_l R_{kl}F_l$, where the smaller set of the Kraus operators is padded with zeros.
- For _any_ $\mathcal{E}\colon\mathcal{B}(\mathcal{H})\rightarrow\mathcal{B}(\mathcal{H}')$, there is _always_ a representation with at most $dd'$ mutually orthogonal Kraus operators: $\tr E_i^\dagger E_j\propto\delta_{ij}$.
:::

Any map $\mathcal{E}$ written in the operator sum form is completely positive, since its Choi matrix $\widetilde{\mathcal{E}}$ is positive semidefinite:
^[Here, the Choi matrix is of the form $\sum_k\proj{v_k}$, where $\ket{v_k}=\id\otimes E_k \ket{\Omega}$. This is a positive semidefinite matrix since, for any vector $\ket{\Psi}$, the expression $\sum_k \braket{\Psi }{v_k}\braket{v_k}{\Psi}$ is non-negative.]
$$
  \begin{aligned}
    \widetilde{\mathcal{E}}
    &= \id \otimes \mathcal{E} \proj{\Omega}
  \\&= \sum_k (\id\otimes E_k) \proj{\Omega} (\id\otimes E^\dagger_k)
  \\&\geq 0.
  \end{aligned}
$$
Conversely, if $\mathcal{E}$ is completely positive, then its Choi matrix is positive semidefinite, which means that it can be written as a mixture of pure states $\proj{\psi_k}$ with probabilities $p_k$:
$$
  \widetilde{\mathcal{E}}
  = \sum_k\proj{\widetilde{\psi_k}}
$$
where $\ket{\widetilde{\psi_k}}=\sqrt{p_k}\ket{\psi_k}$ are (non-normalised) vectors, and any such vector can be written as
$$
  \ket{\widetilde{\psi_k}} = (\id\otimes E_k)\ket{\Omega}
  \tag{10.3.1}
$$
for some operator $E_k$.
Hence
$$
  \begin{aligned}
    \widetilde{\mathcal{E}}
    &= \sum_k\proj{\widetilde{\psi_k}}
  \\&= \sum_k (\id\otimes E_k)\proj{\Omega} (\id\otimes E^\dagger_k)
  \\&= \frac{1}{d} \sum_{ij} \ket{i}\bra{j} \otimes \underbrace{\sum_k E_k(\ket{i}\bra{j}) E^\dagger_k}_{\mathcal{E}(\ket{i}\bra{j})}.
  \end{aligned}
$$
Comparing the last expression on the right with the definition of $\widetilde{\mathcal{E}}$, we conclude that
$$
  \mathcal{E}(\rho)
  = \sum_k E_k \rho E^\dagger_k.
$$

The unitary freedom of choosing the Kraus operators is directly related to the unitary freedom of choosing the statistical ensemble for $\widetilde{\mathcal{E}}$.
We know that two mixtures $\{p_k,\ket{\psi_k}\}$ and $\{q_l,\ket{\phi_l}\}$ described by the same density operator
$$
  \widetilde{\mathcal{E}}
  = \sum_k\proj{\widetilde{\psi_k}}
  = \sum_l\proj{\widetilde{\phi_l}},
$$
where $\ket{\widetilde{\psi_k}}=\sqrt{p_k}\ket{\psi_k}$ and $\ket{\widetilde{\phi_l}}=\sqrt{q_l}\ket{\phi_l}$ are related via
$$
  \ket{\widetilde{\psi_k}} = \sum_{l} R_{kl} \ket{\widetilde{\phi_l}},
$$
for some unitary $R$. Given the correspondence in Equation (10.3.1), this implies the same unitary freedom in choosing the Kraus operators.
The number of vectors contributing to each mixture, and hence the number of corresponding Kraus operators, may be different, so we simply extend the smaller set to the required size by adding zero operators.

We can also see that the minimal number of Kraus operators needed to express $\mathcal{E}$ in the operator sum form is given by the rank of its Choi matrix $\widetilde{\mathcal{E}}$, and so we need no more than $dd'$ such operators.
This minimal set of Kraus operators corresponds to the spectral decomposition of $\widetilde{\mathcal{E}}$.
Indeed, if $\widetilde{\mathcal{E}}=\sum_k \proj{\widetilde{v_k}}$ and $\ket{\widetilde{v_k}} = (\id\otimes E_k)\ket{\Omega}$, then the orthogonality of $\ket{\widetilde{v_k}}$ and $\ket{\widetilde{v_l}}$ implies the orthogonality, in the Hilbert-Schmidt sense, of the corresponding Kraus operators $E_k$ and $E_l$.
In order to see this, we express $\braket{\widetilde{v_k}}{\widetilde{v_l}}$ as
$$
  \begin{aligned}
    \braket{\widetilde{v_k} }{\widetilde{v_l}}
    &= \bra{\Omega} ( \id\otimes E_k^\dagger)(\id\otimes E_l)\ket{\Omega}
  \\&= \tr\big[(\id\otimes E_k^\dagger E_l)\proj{\Omega}\big]
  \\&= \frac{1}{d} \tr \sum_{ij} \ket{i}\bra{j}\otimes E_k^\dagger E_l \ket{i}\bra{j}
  \end{aligned}
$$
where we have substituted $\frac{1}{d}\sum_{ij}\ket{i}\bra{j}\otimes\ket{i}\bra{j}$ for $\proj{\Omega}$.
The trace of the tensor product of two matrices is the product of their traces, whence
$$
  \begin{aligned}
    \braket{\widetilde{v_k} }{\widetilde{v_l}}
    &= \frac{1}{d}\sum_{ij} \braket{i }{j} \tr E_k^\dagger E_l \ket{i}\bra{j}
  \\&= \frac{1}{d} \tr E_k^\dagger E_l
  \end{aligned}
$$
for $\braket{i}{j}=\delta_{ij}$ and $\sum_i\proj{i}=\id$.
That is, $\braket{\widetilde{v_k}}{\widetilde{v_l}}=0$ implies that $\tr E_k^\dagger E_l=0$.





## What are positive maps good for?

Positive maps that are not completely positive are not completely useless.
True, they cannot describe any quantum dynamics, but still they have useful applications --- for example, they can help us to determine if a given state is entangled or not.

A quantum state of a bipartite system $\mathcal{AB}$ described by the density matrix $\varrho^{AB}$ is said to be **separable** if $\varrho^{AB}$ is of the form
$$
  \varrho^{AB}
  = \sum_k p_k \rho^A_k \otimes \rho^B_k
$$
where $p_k \geq 0$ and $\sum_{k=1} p_k=1$; otherwise $\varrho^{AB}$ is said to be **entangled**.
If we apply the partial transpose $\id\otimes T$ to this state, then it remains separable, since, as we have seen, the transpose $\rho^B$ is a legal density matrix.

::: {.idea data-latex=""}
Positive maps, such as the transpose, can be quite deceptive: you have to include other systems in order to detect their unphysical character.
:::

In separable states, one subsystem does not really know about the existence of the other, and so applying a positive map to one part produces a proper density operator, and thus does _not_ reveal the unphysical character of the map.
So, for _any separable state_ $\rho$, we have $(\id\otimes T)\rho\geq 0$.

As an example, consider a quantum state of two qubits which is a mixture of the maximally entangled state $\ket{\psi} = \frac{1}{\sqrt 2}(\ket{00} + \ket{11})$ and the maximally mixed state described by the density matrix
$$
  \rho_p
  = p\proj{\psi} + (1-p)\frac{1}{4}\id\otimes\id,
$$
where $p\in [0,1]$.
Apply the partial transpose $\id\otimes T$ to this state and check for which values of $p$ the resulting matrix is a density matrix.
You should get $p\leq\frac{1}{3}$, which implies that, for all $p$ from $\frac{1}{3}$ to $1$, the density operator $\rho$ describes an entangled state.
Note that the implication "if separable then the partial transpose is positive" does not imply the converse: there exist entangled states for which the partial transpose is positive, and they are known as the **entangled PPT states**^["PPT" stands for _positive partial transpose_.]
However, for _two_ qubits, the PPT states are exactly the separable states.

```{r,engine='tikz',fig.width=2}
\begin{tikzpicture}
  \node at (0,0) {{\small\textsf{SEP}}};
  \node at (0,0.7) {{\small\textsf{PPT}}};
  \node at (0,1.3) {{\small\textsf{all other states}}};
  \draw (0,0) circle (0.5cm);
  \draw (0,0) circle (1cm);
  \draw (0,0) circle (1.8cm);
\end{tikzpicture}
```






## Remarks and exercises

### The Choi-Jamiołkowski isomorphism

**!!!TODO!!!**

### Any bipartite state from a maximally entangled state

**!!!TODO!!!**

### Tricks with a maximally entangled state

**!!!TODO!!!**

### {}

**!!!TODO!!!**

### Block matrices and the partial trace

**!!!TODO!!!**

### Partial inner product

**!!!TODO!!!**

### {}

**!!!TODO!!!**

### {}

**!!!TODO!!!**

### Operator sum freedom

**!!!TODO!!!**

### {}

**!!!TODO!!!**

### C-NOT, again

**!!!TODO!!!**
