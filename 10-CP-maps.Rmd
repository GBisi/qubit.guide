# Quantum channels (or CP maps) {#chapter10}

> About linear transformations --- often called **quantum channels**, **quantum operations**, or **superoperators** --- that map density operators to density operators. Mathematically, such objects are known as **completely positive trace-preserving maps**. Be prepared for some name dropping; you will hear about Karl Kraus, Woody Stinespring, Andrzej Jamiołkowski, and Man-Duen Choi. To be sure, knowing names will not give you more insights, but at least you will not be intimidated when you hear about the **Stinespring** and the **Kraus representations**, the **Jamiołkowski isomorphism**, or the **Choi matrix**.

In quantum information science (and in life) we often divide the world into two parts: things we can control and everything else.
Things we can control (at least with some precision), such as a bunch of ions in an ion trap, will now acquire a generic name -- the **system** -- and the "everything else" part will be called the **environment**.
The joint evolution of the system and the environment is unitary, but the system _alone_ may deviate from the unitary evolution due to the entangling interactions with the environment.
What does this non-unitary quantum evolution look like?

Mathematically speaking^[Recall that, given a pair of Hilbert spaces $\mathcal{H}_A$ and $\mathcal{H}_B$, we denote the set of (bounded) linear operators from $\mathcal{H}_A$ to $\mathcal{H}_B$ by $\mathcal{B}(\mathcal{H}_A,\mathcal{H}_B)$. The shorthand $\mathcal{B}(\mathcal{H})$ is used to denote $\mathcal{B(H,H)}$. For example, an element of $\mathcal{B}(\mathcal{H})$ is exactly a density operator on $\mathcal{H}$.], we want to characterise **physically admissible** maps
$$
  \mathcal{B}\colon \mathcal{B}(\mathcal{H}) \to \mathcal{B}(\mathcal{H}')
$$
that map density operators to density operators.
We will call them **quantum channels**.
Here, $\mathcal{H}$ and $\mathcal{H}'$ are the Hilbert spaces associated with the input and the output, respectively (these two spaces may be of different dimensions: $\dim\mathcal{H}=d$ and $\dim\mathcal{H}'=d'$, with $d$ not necessarily equal to $d'$).
It is not a trivial task, since some operations (such as the matrix transpose) turn density matrices into seemingly legal density matrices, and yet they are _not_ physically admissible.
We want to understand why.

There are essentially two approaches to characterising quantum channels. Let us call them **constructive** and **axiomatic**.

- In the constructive approach (much favoured by physicists) we assume that, in the quantum world, there are only unitary evolutions, and that _non_-unitary evolutions of subsystems are induced by unitary evolutions of _larger_ systems.
We can view them as the result of adding or removing physical systems that participate in unitary evolutions.
In particular, _any_ quantum channel can be constructed by taking a physical system in state $\rho$, combining it with an auxiliary system (e.g. the environment) in some fixed quantum state, applying a unitary transformation to the combined system, and then discarding everything that is of no interest to us.

- In the axiomatic approach we proceed as mathematicians usually do.
We refer to quantum theory for inspiration, scratch our heads, and list all the desired properties that a map should have in order to be called an admissible quantum operation.
This way we define **completely positive trace-preserving** (CPTP) maps.

In the end, you will be relieved to learn, the two approaches are equivalent, leading to the same mathematical formalism.
This equivalence is often goes by the name of the **Stinespring dilation theorem**^[[William Forrest "Woody" Stinespring](https://en.wikipedia.org/wiki/W._Forrest_Stinespring) (1929--2012) was an American mathematician specialising in operator theory.], which says that the CPTP maps are exactly the maps which can be constructed from unitary evolutions by adding and removing subsystems.






## Unitary evolution is all there is...

Here we consider the constructive approach described above.
So we know that any evolution of any _isolated_ system is always unitary, since, at the fundamental level, this is the only evolution that is offered by quantum theory.
Anything else that is not unitary has to be, somehow, derived from a unitary evolution of the whole, and it is easy to see that a unitary evolution of the whole does not imply unitary evolutions of its constituent parts.
The question is: _what kind of sub-evolutions can be induced on subsystems by a global unitary evolution?_

Consider a physical system, prepared in some input state $\ket{\psi}\in\mathcal{H}$, which is then combined with another system (here, the environment) that is initially in state $\ket{e}\in\mathcal{H}_E$.
The two systems interact, and their joint unitary evolution $U$ produces, in general, an entangled state.
The system itself, after discarding the environment, ends in an output state $\rho'$, which is given by taking a partial trace, as shown in Figure \@ref(fig:joint-system-discard-output).

(ref:joint-system-discard-output-caption) The output (discarding what happens to the environment) is given by $\rho'=\tr_E \big(U\proj{\psi}\otimes\proj{e} U^\dagger\big)$.

```{r joint-system-discard-output,engine='tikz',engine.opts=list(template="tikz2pdf.tex"),fig.width=6,fig.cap='(ref:joint-system-discard-output-caption)'}
\begin{equation*}
  \begin{quantikz}
    \lstick{input $\ket{\psi}$} & \gate[wires=2]{U} &\rstick{output $\rho'$} \qw
  \\\lstick{fixed $\ket{e}$} &\hphantom{really wide} &\rstick{discard} \qw
  \end{quantikz}
\end{equation*}
```

The requirement that the environment start in a pure state is not very restrictive: if it were initially in a mixed state, then we could always regard the environment as a sub-environment of some larger environment in an entangled pure state.
It _is_ important, however, that the system and its environment _initially have no correlation with each other_: they are in a product state $\ket{\psi}\otimes \ket{e}$.
Then, if we fix the initial state of the environment $\ket{e}$ and the unitary $U$, the final state of the system depends _only_ on its initial state $\ket{\psi}$.
In fact, the initial state of the system can be a mixed state, described by some density operator $\rho$.
This is because any mixed state can be interpreted as a statistical mixture of pure states, and any linear process respects such a mixture.
Thus, by fixing $U$ and $\ket{e}$, we have constructed a well defined linear map $\mathcal{E}\colon\mathcal{B}(\mathcal{H})\to\mathcal{B}(\mathcal{H})$ that transforms the input state $\rho$ into the output state $\rho'=\mathcal{E}(\rho)$.

::: {.idea data-latex=""}
$$
  \begin{aligned}
    \mathcal{E}\colon \mathcal{B}(\mathcal{H}) &\longrightarrow \mathcal{B}(\mathcal{H})
  \\\rho &\longmapsto \rho'=\tr_E \big(U\proj{\psi}\otimes\proj{e} U^\dagger\big)
  \end{aligned}
$$
:::

This way of describing the action of a quantum channel is often called the **unitary representation** of a channel.
As mentioned above, the channel is completely defined by the unitary $U$ and the initial state of the environment $\ket{e}$, but note that, once the system and the environment cease to interact, any operation _on the environment alone_ has no effect on the state of the system.
That is, the two diagrams in Figure \@ref(fig:environment-same-channel) define the same channel, or, in other words, the unitaries $U$ and $(\id\otimes R)U$, where $R$ acts only on $\mathcal{H}_E$, define the same channel.^[Consider $U$ and $U(\id\otimes R)$, where $R$ acts only on $\mathcal{H}_E$. Do these two unitaries also define the same quantum channel?]

(ref:environment-same-channel-caption) The $\bullet$ here represents discarding the final state of the environment.

```{r environment-same-channel,engine='tikz',engine.opts=list(template="tikz2pdf.tex"),fig.width=6,fig.cap='(ref:environment-same-channel-caption)'}
\begin{equation*}
  \begin{quantikz}
    \lstick{$\ket{\psi}$} & \gate[wires=2]{U} &\qw &\qw &\rstick{$\rho'$} \qw
  \\\lstick{$\ket{e}$} &\hphantom{really wide} &\qw &\qw &\rstick{$\bullet$} \qw
  \end{quantikz}
\end{equation*}
\begin{equation*}
  \begin{quantikz}
    \lstick{$\ket{\psi}$} & \gate[wires=2]{U} &\qw &\rstick{$\rho'$} \qw
  \\\lstick{$\ket{e}$} &\hphantom{really wide} &\gate{R} &\rstick{$\bullet$} \qw
  \end{quantikz}
\end{equation*}
```

Note that, for any operator $\tilde{\rho}$ on $\mathcal{H}\otimes\mathcal{H}_E$, and for any operator $R$ on $\mathcal{H}_E$, we have that
$$
  \tr_E\left[
    (\id\otimes R) \tilde{\rho} (\id\otimes R^\dagger)
  \right] = \tr_E \tilde{\rho}.
$$
The reduced density operator $\rho=\tr_E\tilde{\rho}$ is not affected by $R$.
We can easily prove this for operators $\tilde{\rho}$ that are tensor products $\tilde{\rho}=X\otimes Y$ (a good exercise to try yourself), and then, by linearity, extend the result to any operator $\tilde{\rho}$.

We must point out that our construction of quantum channels does not capture all possible quantum evolutions.
The assumption that the system and the environment are not initially correlated is crucial, and it does impose some restrictions on the applicability of our formalism.
Compare, for example, the following two versions of a process in which the system, initially in state $\rho$, undergoes two stages of evolution.

Firstly:

```{r,engine='tikz',engine.opts=list(template="tikz2pdf.tex"),fig.width=7}
\begin{equation*}
  \begin{quantikz}
    \lstick{$\rho$} &\gate[2]{U_A} &\rstick{$\rho'$} \qw & &\gate[2]{U_B} &\rstick{$\rho''$} \qw
  \\\lstick{$\ket{e}$} &\qw &\qw &\qw &\qw & \ar[d,dash,thickness]\qw
  \\& & & & &\bullet
  \end{quantikz}
\end{equation*}
```

Here, the environment is not discarded after the first unitary evolution $U_A$ --- it carries on and participates in the second unitary evolution $U_B$.
In this case, the evolutions $\rho\mapsto\rho'$ and $\rho\mapsto\rho''$ _are_ well-defined quantum channels, but the evolution $\rho'\mapsto\rho''$ is _not_; it falls outside the remit of our formalism for the input state of the system and the state of the environment are not independent.

Secondly:

```{r,engine='tikz',engine.opts=list(template="tikz2pdf.tex"),fig.width=7}
\begin{equation*}
  \begin{quantikz}
    \lstick{$\rho$} &\gate[2]{U_A} &\qw &\rstick{$\rho'$} \qw & &\qw &\gate[2]{U_B} &\rstick{$\rho''$} \qw
  \\\lstick{$\ket{a}$} & &\qw \ar[d,dash,thickness]\qw & & & \lstick{$\ket{b}$} &\qw &\ar[d,dash,thickness]\qw
  \\& &\bullet & & & & &\bullet
  \end{quantikz}
\end{equation*}
```

In contrast to the previous process, here we discard the environment after the first unitary, and start the second unitary evolution in a fresh tensor product state with a _new_ environment --- the two stages involve independent environments.
In this case, all three evolutions ($\rho\mapsto\rho'$, $\rho'\mapsto\rho''$, and $\rho\mapsto\rho''$) are well-defined quantum channels, and can be composed.^[Unitary evolutions form a group; quantum channels form a _[semigroup](https://en.wikipedia.org/wiki/Semigroup)_. Quantum channels are invertible only if they are unitary operations or simple isometric embeddings, such as including the environment in some fixed state and then discarding it right away, without any intermediate interaction.]
If $\mathcal{E}_A$ describes the evolution from $\rho$ to $\rho'$, and $\mathcal{E}_B$ the evolution from $\rho'$ to $\rho''$, then the composition $\mathcal{E}_B\mathcal{E}_A$ describes the evolution from $\rho$ to $\rho''$.

In practice, we often deal with complex environments that have internal dynamics that "hide" any entanglement with the system as quickly as it arises.
For example, let our system be an atom, surrounded by electromagnetic field (which serves as the environment), and let the field start in the vacuum state.
If the atom emits a photon into the environment, then the photon quickly propagates away, and the immediate vicinity of the atom appears to be empty, i.e. it resets to the vacuum state.
In this approximation, we assume that the environment quickly forgets about its state resulting from any previous evolution.
This is known as the **Markov approximation**, and, in the quantum Markov process^[[Andrey Markov](https://en.wikipedia.org/wiki/Andrey_Markov) (1929--2012) was a Russian mathematician best known for his work on stochastic processes.], the environment has essentially no memory.






## Operator sum representation

The unitary representation of a quantum channel is usually too general to be of any practical use, at least for our purposes.
We will find it convenient, as you will see when we start discussing quantum error correction, to choose an orthonormal basis $\{\ket{e_k}\}$ of $\mathcal{H}_E$, and express the joint (i.e. "system plus environment") unitary evolution $U$ as
$$
  U(\ket{\psi}\otimes\ket{e})
  = \sum_k E_k\ket{\psi}\otimes\ket{e_k}
$$
where $E_k$ is an operator on $\mathcal{H}$ defined by
$$
  E_k\ket{\psi}
  = \bra{e_k}U(\ket{\psi}\otimes\ket{e})
$$
for any vector $\ket{\psi}\in\mathcal{H}$
Think about $\bra{e_k}U(\ket{\psi}\otimes\ket{e}$ as a partial inner product^[Recall that, given $\mathcal{H}_A\otimes\mathcal{H}_B$, the partial inner product of $\ket{x}\in \mathcal{H}_A$ and $\ket{a}\otimes\ket{b}\in\mathcal{H}_A\otimes\mathcal{H}_B$ is first defined by the formula $$\bra{x}(\ket{a}\otimes\ket{b}) = \braket{x|a}\ket{b}$$ and then extended to other (non direct tensor product) vectors in  $\mathcal{H}_A\otimes \mathcal{H}_B$ by linearity.] of $\ket{e_k}\in\mathcal{H}_E$ and  $U\ket{\psi}\ket{e}\in \mathcal{H}\otimes\mathcal{H}_E$.
In analogy with classical communication channels we sometimes refer to the operators $E_k$ as **quantum errors**.

The intuition behind the expression
$$
  \ket{\psi}\otimes \ket{e}
  \longmapsto \sum_k E_k\ket{\psi}\otimes\ket{e_k}
$$
is that the operation $E_k$ (which changes the state of the system as $\ket{\psi}\mapsto E_k\ket{\psi}$) occurs with the probability $p_k=\bra{\psi}E^\dagger_k E_k\ket{\psi}$.
The probabilities sum up to one, i.e. $\sum_k p_k=\bra{\psi}E^\dagger_k E_k\ket{\psi} =1$ for any state $\ket{\psi}$, and so the operators $E_k$ must satisfy the completeness relation
$$
  \sum_k E^\dagger_k E_k=\id.
$$

Note that the matrix $U$ acts on the tensor product space, which gives it a natural partition into blocks of sub-matrices, such as $E_k=\bra{e_k}U\ket{e}$.
In order to visualise $E_k=\bra{e_k}U\ket{e}$, write $U$ as a matrix on $\mathcal{H}_E\otimes\mathcal{H}$ rather than $\mathcal{H}\otimes\mathcal{H}_E$ (i.e. place the environment first and the system second).
Then, in a tensor product basis in which $\ket{e}\equiv\ket{e_1}$, the $(d\times d)$ matrices $E_k$ form the first block column:
$$
U=
  \left[
  \,
    \begin{array}{c|c|c}
        E_1
      & \cdots
      & \cdot
    \\\hline
      E_2
      & \cdots
      & \cdot
    \\\hline
       \vdots
      & \ddots
      & \vdots
    \\\hline
      E_n
      & \cdots
      & \cdot
    \end{array}
  \,
  \right].
$$
The remaining entries of $U$ are irrelevant for the purpose of describing our sub-dynamics, since we have fixed the initial state of the environment.
If we had chosen $\ket{e}\equiv\ket{e_2}$ instead, then we would have been looking at the matrices in the _second_ block column, and all other entries would be irrelevant.
You see the pattern, right?
Here, the $k$ in $E_k$ ranges from $1$ to some $n\leq D$, if we discount zero matrices.
Finally, to be clear, reversing the order of the system and the environment does not affect the physical description _as long as we remember which part is which_.
We changed the order just for pedagogical purposes; you can stick to the original order if you wish, but then the entries of $E_k$ will be dispersed all over the matrix $U$.

Now, if we express the system-plus-environment evolution in terms of density operators
$$
  \proj{\psi}\otimes\proj{e}
  \longmapsto \sum_{k,l} E_k\proj{\psi} E^\dagger_l\otimes \ket{e_k}\bra{e_l}
$$
and trace over the environment, then we can write the evolution of the system alone as
$$
  \proj{\psi}
  \longmapsto \sum_k E_k\proj{\psi} E^\dagger_k.
$$
Recall that any density operator can be represented as a statistical mixture of pure states, and so:

::: {.idea data-latex=""}
The above equation can be generalised and written as
$$\rho\longrightarrow \sum_k E_k\rho E^\dagger_k$$
where $\rho$ is any state of the system, pure or mixed.

It turns out that _all_ quantum channels can be represented in this way, which is known as the **operator sum representation**, or the **Kraus representation**.
The operators $E_k$ are often referred to as the **Kraus** operators.^[[Karl Kraus](https://en.wikipedia.org/wiki/Karl_Kraus_(physicist)) (1938--1988) was a German physicist.]
:::

The operator sum (Kraus) representation follows from the unitary representation once we choose an orthonormal basis in $\mathcal{H}_E$.
Conversely, given an operator sum representation $E_k\in\mathcal{B}(\mathcal{H})$ of the channel $\mathcal{E}$, we can always view it as an operation resulting from a unitary map acting on some extended system: we just introduce an auxiliary system, the environment, which has dimension equal to the number of Kraus operators, and then choose an orthonormal basis $\ket{e_k}$.
We then define $U$ via $U\ket{\psi}\ket{e}\mapsto\sum_k E_k\ket{\psi}\ket{e_k}$.
It is convenient to choose $\ket{e}\equiv\ket{e_1}$; in this case the operators $E_k$ form the first block column of $U$.
All other entries can be chosen as you please (as long as $U$ remains unitary).

By now it should be clear that an operator sum representation of a given quantum channel is _not_ unique: once we fix $U$ and $\ket{e}$, and hence define a quantum channel, we may still choose the basis vectors $\ket{e_k}$ in $\mathcal{H}_E$ as we please.
This means that the Kraus operators $E_k=\bra{e_k}U\ket{e}$ and $F_k=\bra{f_k}U\ket{e}$, where $\{\ket{e_k}\}$ and $\{\ket{f_k}\}$ are two orthonormal bases, describe the same quantum channel.
They are unitarily related:
$$
  \begin{aligned}
    F_k
    &=\bra{f_k} U\ket{e}
  \\&=\sum_l\braket{f_k|e_l}\bra{e_l}U\ket{e}
  \\&=\sum_l \braket{f_k|e_l} E_l
  \\&=\sum_l R_{kl} E_l
  \end{aligned}
$$
where $R_{kl}=\braket{f_k |e_l}$ is a unitary matrix, and we have used the decomposition of the identity $\sum_l\proj{e_l}=\id_E$.
In fact, the converse holds true as well:

::: {.idea data-latex=""}
Suppose that $E_1,\ldots,E_n$ and $F_1,\ldots,F_m$ are Kraus operators associated to the quantum channels $\mathcal{E}$ and $\mathcal{F}$, respectively.
Let us append zero operators to the shorter list to ensure that $n=m$.

_Then $\mathcal{E}$ and $\mathcal{F}$ describe the same channel if and only if $F_k=\sum_l R_{kl} E_l$ for some unitary $R$._
:::

It is easy to see the reverse implication:
$$
  \begin{aligned}
    \mathcal{F}(\rho)
    &=\sum_k F_k\rho F^\dagger_k
  \\&= \sum_{ijk} R_{ki}E_i \rho E^\dagger_j R^\star_{jk}
  \\&=\sum_{ij} \underbrace{\left(\sum_k R_{jk}^\star R_{ki}\right)}_{\delta_{ij}} E_i\rho E^\dagger_j
  \\&= \sum_j E_j\rho E^\dagger_j
  \\&= \mathcal{E} (\rho).
  \end{aligned}
$$

Without any restrictions on the operators $E_k$, any map of the form $U\mapsto\sum_k E_k U E_k^\dagger$ preserves Hermiticity and positivity.^[Prove this!]
If we additionally require the completeness relation $\sum_k E_k^\dagger E_k=\id$, then the map becomes trace-preserving:
$$
  \begin{aligned}
    \tr\mathcal{E}(\rho)
    &= \tr\sum_k E_k\rho E_k^\dagger
  \\&= \tr\underbrace{\left(\sum_k E^\dagger_k E_k\right)}_{\id} \rho
  \\&= \tr\rho
  \\&= 1.
  \end{aligned}
$$

Any unitary evolution of a density operator
$$
  \rho \longmapsto U\rho U^\dagger
$$
is a trivial example of the operator sum representation, with just one Kraus operator $U$.
Next we may consider a probability distribution on a finite set of unitary operations $U_1,\ldots, U_m$.
In this scenario, $U_k$ will be chosen at random according to the probability distribution $p_1\ldots p_k \ldots p_m$, and applied to $\rho$.
If this is all that is known about the procedure, then the resulting transformation of $\rho$ can be written as
$$
  \begin{aligned}
    \rho\longmapsto
    &\sum_k p_k U_k\rho U_k^\dagger
  \\=&\sum_k  \underbrace{\sqrt{p_k} U_k}_{E_k}  \rho \underbrace{U_k^\dagger\sqrt{p_k}}_{E_k^\dagger}
  \\=&\sum_k E_k\rho E^\dagger_k.
  \end{aligned}
$$
In this case,
$$
  \rho\lognmapsto \sum_k E_k\rho E_k^\dagger
$$
where $\sum_k E_k^\dagger E_k = \sum_k E_k E^\dagger_k =\id$.
This is an example of a **unital channel**, i.e. one for which $\sum_k E_k E^\dagger_k =\id$; such a channel sends maximally mixed inputs to maximally mixed outputs (if $\rho \propto \id$, then so too is $\rho'$).

In particular, if we restrict our attention to qubits, and choose the unitaries to be the identity and the three Pauli operators, then we construct what is known as a **Pauli channel**:
$$
  \rho
  \longmapsto p_0 \id\rho\id + p_x X\rho X + p_y Y\rho Y + p_z Z\rho Z.
$$

The most popular Pauli channel is the **depolarising channel**
$$
  \rho
  \longmapsto (1-p) \id\rho\id + \frac{p}{3} (X\rho X + Y\rho Y + Z\rho Z).
$$
In the depolarising channel, a qubit in state $\rho$ remains intact with probability $1-p$, or is otherwise transformed under one of the Pauli operators $X$, $Y$, or $Z$, each chosen randomly with probability $p/3$.

**Useful exercise.**
Show that the action of the depolarising channel is equivalent to the following operation: _with probability $p$, the input state is thrown away and replaced with the maximally mixed state, and with probability $(1-p)$ the input state survives without any disturbance_.
Use the Bloch sphere picture and show that the depolarising channel uniformly contracts the sphere by the factor $1-\frac{4}{3}p$.






## Expand, evolve, and discard
