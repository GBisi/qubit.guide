# Decoherence, and elements of quantum error correction

> In principle we know how to build a quantum computer: we can start with simple quantum logic gates and try to integrate them together into quantum networks.
> However, if we keep on putting quantum gates together into networks we will quickly run into some serious practical problems.
> The more interacting qubits involved, the harder it is to prevent them from getting entangled with the environment.
> This unwelcome entanglement, also known as **decoherence**, destroys the interference, and thus the power, of quantum computing.

## Decoherence simplified

Consider the following qubit-environment interaction:
$$
  \begin{aligned}
    \ket{0}\ket{e} &\longmapsto \ket{0}\ket{e_{00}}
  \\\ket{1}\ket{e} &\longmapsto \ket{1}\ket{e_{11}}
  \end{aligned}
$$
where $\ket{e}$, $\ket{e_{00}}$, and $\ket{e_{11}}$ are the states of the environment, which not need to be orthogonal.^[The reason we use two indices in $\ket{e_{00}}$ and $\ket{e_{11}}$ will become clear in a moment, when we consider more general interaction with the environment.]
Let $\ket{\psi} = \alpha\ket{0} + \beta\ket{1}$ be the initial state of the qubit.
The environment is essentially trying to _measure_ the qubit and, as the result, the two get entangled:
$$
  \Big( \alpha\ket{0} + \beta\ket{1} \Big) \ket{e}
  \longmapsto
  \alpha \ket{0}\ket{e_{00}} + \beta \ket{1} \ket{e_{11}}.
$$
This state can also be written as
$$
  \begin{aligned}
    \Big( \alpha\ket{0} + \beta\ket{1} \Big) \ket{e}
    \longmapsto
    & \Big( \alpha\ket{0} + \beta\ket{1} \Big) \frac{\ket{e_{00}}+\ket{e_{11}}}{2}
  \\+& \Big( \alpha\ket{0} - \beta\ket{1} \Big) \frac{\ket{e_{00}}-\ket{e_{11}}}{2}.
  \end{aligned}
$$
or as
$$
  \ket{\psi}\ket{e}
  \longmapsto
  \id\ket{\psi}\ket{e_1} + Z\ket{\psi}\ket{e_z},
$$
where $\ket{e_1} = \frac12(\ket{e_{00}} + \ket{e_{11}})$ and $\ket{e_z} = \frac12(\ket{e_{00}} - \ket{e_{11}})$.
We may interpret this expression by saying that two things can happen to the qubit: nothing $\id$ (first term), or phase-flip $Z$ (second term).
This, however, should not be taken literally unless the states of the environment, $\ket{e_1}$ and $\ket{e_z}$, are orthogonal.^[Why not?]

## Decoherence and interference

Suppose the qubit undergoes the usual interference experiment but in between the two Hadamard gates it is affected by decoherence (denoted by $\times$).

```{r decoherence-interference,echo=FALSE,cache=TRUE,engine='tikz',fig.width=4,fig.align='center',fig.cap='The usual interference experiment, but with decoherence.',fig.ext=if (knitr:::is_latex_output()) 'pdf' else 'png'}
\tikzset{dot/.style={fill,shape=circle,minimum size=5pt,inner sep=0pt}}
\tikzset{operator/.style={draw,fill=white}}
\newcommand{\ket}[1]{|#1\rangle}
\begin{tikzpicture}
  \node (input) at (-2,0) {$\ket{0}$};
  \node (output) at (3,0) {$\ket{1}$};
  \draw (input) to node [operator] {$H$} (0,0);
  \draw (0,0) to (1,0);
  \draw (1,0) to node [operator] {$H$} (output);
  \node [dot,label=above:{$\varphi$}] at (0,0) {};
  \node [fill=white,inner sep=0] at (0.75,0) {\Large$\times$};
\end{tikzpicture}
```

Let us step through the circuit in Figure \@ref(fig:decoherence-interference), keeping track of the state of the environment:
$$
  \begin{aligned}
    \ket{0}\ket{e}
    & \xmapsto{H} \Big( \ket{0} + \ket{1} \Big) \ket{e}
  \\& \xmapsto{\phi} \Big( \ket{0} + e^{i\phi}\ket{1} \Big) \ket{e}
  \\& \xmapsto{\times} \ket{0}\ket{e_0} + e^{i\phi}\ket{1}\ket{e_1}
  \\& \xmapsto{H} \ket{0}\Big( \ket{e_{00}} + e^{i\phi}\ket{e_{11}} \Big) + \ket{1}\Big( \ket{e_{00}} - e^{i\phi}\ket{e_{11}} \Big).
  \end{aligned}
$$
If we write $\braket{e_0|e_1} = ve^{i\alpha}$, then the final probabilities of $0$ and $1$ oscillate with $\phi$ as
$$
  \begin{aligned}
    P_{0}(\phi) &= \frac12\big(1 + v\cos(\phi + \alpha)\big),
  \\P_{1}(\phi) &= \frac12\big(1 - v\cos(\phi + \alpha)\big).
  \end{aligned}
$$

```{r visibility-suppression,echo=FALSE,cache=TRUE,engine='tikz',engine.opts=list(template="tikz2pdf.tex"),fig.margin=TRUE,fig.width=4,fig.cap='Visibility suppression.',fig.ext=if (knitr:::is_latex_output()) 'pdf' else 'png'}
\definecolor{primary}{RGB}{177,98,78}
\definecolor{secondary}{RGB}{91,132,177}
\begin{tikzpicture}
  \begin{axis}[
      xmin=0,xmax=5,
      xlabel=relative phase,
      ylabel=$p\,\text{(probability)}$,
      ymin=0,ymax=1.1,
      axis lines=middle,
      xtick={0},
      xticklabels={$0$},
      ytick={0.5,1},
      yticklabels={$\frac12$,$1$},very thick,
      xlabel style={font=\Large,anchor=north,at={(axis description cs:0.8,0)}},
      ylabel style={font=\Large,anchor=south},
      yticklabel style={font=\Large},
    ]
    \addplot[domain=0:2*pi,samples=200,line width=2pt,primary]{0.5+0.17*cos(deg(3*x))};
    \addplot[domain=0:2*pi,samples=200,gray,very thick]{0.5};
  \end{axis}
  \draw [<->,secondary] (0,4) to (1,4);
  \draw [dashed,secondary] (1,4) to (1,1.1);
  \node at (0.5,4.4) {\small$\alpha$};
  %
  \draw [<->,secondary] (-1,0.33*5) to (-1,0.7*5);
  \draw [dashed,secondary] (-1,0.33*5) to (5,0.33*5);
  \draw [dashed,secondary] (-1,0.7*5) to (5,0.7*5);
  \node at (-1.3,2.6) {\small$v$};
\end{tikzpicture}
```

As we can see in Figure \@ref(fig:visibility-suppression), the interference pattern is suppressed by a factor $v$, which we call the **visibility**.
As $v=|\!\braket{e_0|e_1}\!|$ decreases, we lose all the advantages of quantum interference.
For example, in Deutsch's algorithm we obtain the correct answer with probability at most $(1+v)/2$.
For $\braket{e_0|e_1} = 0$, the perfect decoherence case, the network outputs $0$ or $1$ with equal probabilities, i.e. it is _useless_ as a computing device.

::: {.idea}
  It is clear that we want to avoid decoherence, or at least diminish its impact on our computing device.
  For this we need **quantum error correction**: we encode the state of a single (logical) qubit across several (physical) qubits.
:::


## Evolution of density operators under decoherence

In terms of density operators, the qubit alone evolves from the pure state $\proj{\psi}$ to a mixed state, which can be obtained by tracing over the environment.
We start with the evolution of the state vector $\ket{\psi}=\alpha\ket{0}+\beta\ket{1}$, which is given by
$$
  \left( \alpha\ket{0} +\beta \ket{1}\right)\ket{e} \longmapsto
  \alpha \ket{0}\ket{e_{00}} +\beta \ket{1} \ket{e_{11}},
$$
Then we write it as the evolution of the projector $\proj{\psi}$, and trace over the environment to obtain
$$
  \begin{aligned}
    \proj{\psi} \longmapsto & |\alpha|^2\proj{0} \braket{e_{00}|e_{00}}+ \alpha\beta^\star \ket{0}\!\bra{1}\braket{e_{11}|e_{00}}
  \\+ &\alpha^\star\beta \ket{1}\!\bra{0}\braket{e_{00}|e_{11}}  + |\beta|^2\proj{1}\braket{e_{11}|e_{11}}.
  \end{aligned}
$$
Written in the matrix form, this is
$$
  \begin{bmatrix}
    |\alpha|^2 & \alpha\beta^\ast
  \\\alpha^\ast\beta & |\beta|^2
  \end{bmatrix}
  \longmapsto
  \begin{bmatrix}
    |\alpha|^2 & \alpha\beta^\ast \braket{e_{11}|e_{00}}
    \\\alpha^\ast\beta \braket{e_{00}|e_{11}} & |\beta|^2
  \end{bmatrix}.
$$
The off-diagonal elements, originally called **coherences**, vanish as $\braket{e_0|e_1}$ approaches zero.
This is why this particular interaction is called decoherence.

Notice that
$$
\ket{\psi}\ket{e} \longmapsto \id \ket{\psi}\ket{e_1} +Z\ket{\psi}\ket{e_z},
$$
implies
$$
\proj{\psi}\longmapsto \id \proj{\psi} \id \braket{e_1|e_1} +Z\proj{\psi} Z\braket{e_z|e_z},
$$
_only_ when $\braket{e_1|e_z}=0$ (otherwise you would have additional cross terms $\id\proj{\psi} Z$  and $Z\proj{\psi} \id$).
In this case we can indeed say that, with probability $\braket{e_1|e_1}$, nothing happens, and, with probability $\braket{e_z|e_z}$, the qubit undergoes the phase flip $Z$.


## Quantum errors

The most general qubit-environment interaction
$$
  \begin{aligned}
    \ket{0}\ket{e} &\longmapsto \ket{0}\ket{e_{00}} + \ket{1}\ket{e_{01}},
  \\\ket{1}\ket{e} &\longmapsto \ket{1}\ket{e_{10}} + \ket{0}\ket{e_{11}},
  \end{aligned}
$$
where the states of the environment are neither normalised nor orthogonal, leads to decoherence
$$
  \begin{aligned}
    \Big( \alpha\ket{0} + \beta\ket{1} \Big) \ket{e} \longmapsto
    & \Big( \alpha\ket{0} + \beta\ket{1} \Big) \frac{\ket{e_{00}}+\ket{e_{11}}}{2}
  \\+& \Big( \alpha\ket{0} - \beta\ket{1} \Big) \frac{\ket{e_{00}}-\ket{e_{11}}}{2}
  \\+& \Big( \alpha\ket{1} + \beta\ket{0} \Big) \frac{\ket{e_{01}}+\ket{e_{10}}}{2}
  \\+& \Big( \alpha\ket{1} - \beta\ket{0} \Big) \frac{\ket{e_{01}}-\ket{e_{10}}}{2}.
  \end{aligned}
$$
We can also write this as
$$
\ket{\psi}\ket{e} \longmapsto  \id \ket{\psi}\ket{e_1} + Z\ket{\psi} \ket{e_z} +X\ket{\psi} \ket{e_x} + Y\ket{\psi} \ket{e_y}.
$$
The intuition behind this expression is that four things can happen to the qubit:

1. nothing ($\id$),
2. phase-flip ($Z$),
3. bit-flip ($X$), or
4. both bit-flip and phase-flip ($Y$).

This is certainly the case when the states $\ket{e_1}, \ket{e_x}, \ket{e_y}$ and $\ket{e_z}$ are mutually orthogonal, otherwise we cannot perfectly distinguish between the four alternatives.

::: {.idea}
  What is important here is the discretisation of errors, and the fact that we can reduce quantum errors to _two types_: bit flip errors $X$, and phase flip errors $Z$.
:::

In general, given $n$ qubits in state $\ket{\psi}$ and the environment in state $\ket{e}$ the joint evolution can be expanded as
$$
\ket{\psi}\ket{e} \longmapsto \sum_i E_i\ket{\psi}\ket{e_i},
$$
where the $E_i$ are the $n$-fold tensor products of the Pauli operators and the $\ket{e_i}$ are the corresponding states of the environment, which are not assumed to be normalised or mutually orthogonal.
A typical operator $E_i$ acting on five qubits may look like this,
$$
  X\otimes Z \otimes \id \otimes \id \otimes Y
  \equiv XZ\id\id Y.
$$
We can say that $E_i$ represents an error consisting of the bit ($X$) error on the first qubit, phase ($Z$) error on the second qubit and both bit and phase ($Y$) error on the fifth qubit.
Again, _this is not quite accurate if the corresponding states of the environment are not mutually orthogonal_, but it gives the right kind of intuition nonetheless.
Here the index $i$ in $E_i$ ranges from $1$ to $4^5=1024$, because there are $4^5$ different Pauli operators acting on $5$ qubits.


## Same evolution, different errors

We can always pick up an orthonormal basis $\ket{u_i}$ in the environment and express the system--environment evolution as
$$
  \begin{aligned}
    \ket{\psi}\ket{e}
    \longmapsto &\sum_{ij} E_i\ket{\psi}\ket{u_j}\braket{u_j|e_i}
    \\&= \sum_{j}\Big( \sum_i \braket{u_j|e_i} E_i\Big)\ket{\psi}\ket{u_j}
    \\&= \sum_j M_j\ket{\psi}\ket{u_j}.
  \end{aligned}
$$
The new "error" operators $M_j$ satisfy $\sum_j M_j^\dagger M_j =\id$ and, in general, they are _not_ unitary.
Now, the evolution of the density operator $\proj{\psi}$ can be written as 
$$
  \proj{\psi}\longmapsto \sum_j M_j\proj{\psi} M_j^\dagger.
$$
Which particular errors you choose depends of your choice of the basis in the environment.
If, instead of $\ket{u_j}$, you pick up a different basis, say $\ket{v_k}$, then
$$
  \begin{aligned}
    \ket{\psi}\ket{e}
    \longmapsto &\sum_j M_j\ket{\psi}\ket{u_j}
  \\&= \sum_j M_j \ket{\psi}\sum_k\ket{v_k}\braket{v_k|u_j}
  \\&= \sum_k \Big(\sum_j \braket{v_k|u_j} M_j \Big)\ket{\psi}\ket{v_k}
  \\&= \sum_k N_k\ket{\psi}\ket{v_k},
  \end{aligned}
$$
and, consequently,
$$
  \proj{\psi}\longmapsto \sum_k N_k\proj{\psi} N_k^\dagger.
$$
The new "errors" satisfy $\sum_k N_k^\dagger N_k = \id$, and the error operators $N_k$ and $M_j$ are related by the unitary matrix $U_{kj}=\braket{v_k|u_j}$. 


## Some errors can be corrected on some states
