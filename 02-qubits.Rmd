# Qubits

:::: {.comment data-latex=""}
::: {.book-only}
[Click here to view this entire chapter on one page.](../tufte/qubits.html#qubits)
:::

::: {.tufte-only}
[Click here to view this chapter in the book.](../book/qubits.html#qubits)
:::
::::

> About quantum bits and quantum circuits, including the "impossible" square root of $\texttt{NOT}$, as well as an introduction to single-qubit unitaries and rotations of the Bloch sphere, and the implications concerning universal gates.





## Composing quantum operations 

In order to understand something in its full complexity it is always good to start with the simplest case.
Let us take a closer look at quantum interference in the simplest possible computing machine: the one that has only two distinguishable configurations  --- two quantum states --- which we label as $\ket{0}$ and $\ket{1}$.
We prepare the machine in some input state, usually $\ket{0}$, and let it **evolve**: the machine undergoes a prescribed sequence of computational steps, each of which induces transitions between the two "computational states", $\ket{0}$ and $\ket{1}$.
The machine then ends in the output state $\ket{\psi}=\alpha_0\ket{0}+\alpha_1\ket{1}$, meaning the two outputs, $\ket{0}$ and $\ket{1}$, are reached with probability amplitudes $\alpha_0$ and $\alpha_1$, respectively.
In the process of computation each computational step $U$ (also referred to as an **operation**) sends state $\ket{k}$ to state $\ket{l}$, where $k,l=0,1$, but only with some **amplitude** $U_{lk}$.
We write this as
\begin{equation}
  \ket{k} \mapsto \sum_l U_{lk} \ket{l}.
(\#eq:pulsemap)
\end{equation}
(watch out for the order of the indices).

Thus any computational step $U$ of this machine can be described by a matrix which tabulates all the transition amplitudes:
$$
  U =
  \begin{bmatrix}
    U_{00} & U_{01}
  \\U_{10} & U_{11}
  \end{bmatrix}.
$$
The matrix element $U_{lk}$ represents the amplitude of transition from state $\ket{k}$ to state $\ket{l}$ (again, watch the order of indices).
To be clear, the entries in this matrix are not any random complex numbers: their moduli squared represent transition probabilities, which in turn implies that such matrices must be **unitary**.^[Recall that matrix $U$ is called **unitary** if $$U^\dagger U = UU^\dagger = \id$$ where the **adjoint** or **Hermitian conjugate** $U^\dagger$ of any matrix $U$ with complex entries $U_{ij}$ is obtained by taking the complex conjugate of every element in the matrix and then interchanging rows and columns ($U^\dagger_{kl}= U^\star_{lk}$).]

We can also describe $U$ by drawing a diagram, which contains exactly the same information as the matrix representation, but just in a different form:

```{r,engine='tikz',fig.width=3.5,fig.align='center'}
\tikzset{dot/.style={fill,shape=circle,minimum size=5pt,inner sep=0pt}}
\newcommand{\ket}[1]{|#1\rangle}
\begin{tikzpicture}[xscale=0.8,yscale=1.6]
\node (input0) at (0,1) {$\ket{0}$};
\node (input1) at (0,0) {$\ket{1}$};
\node (output0) at (5,1) {$\ket{0}$};
\node (output1) at (5,0) {$\ket{1}$};
\foreach \x in {1,4}
  \foreach \y in {0,1}
    \node [dot] (n\x\y) at (\x,\y) {};
\draw [thick] (input0) to node [fill=white,pos=0.5] {$U_{00}$} (output0);
\draw [thick] (input1) to node [fill=white,pos=0.5] {$U_{11}$} (output1);
\draw [thick] (n11) to node [fill=white,pos=0.25] {$U_{10}$} (n40);
\draw [thick] (n10) to node [fill=white,pos=0.25] {$U_{01}$} (n41);
\end{tikzpicture}
```

Now how can we find some quantum interference to study?
Consider two computational steps, $U$ and $V$.
What is the amplitude that input $\ket{k}$ will generate output $\ket{m}$?
We have to check all computational paths leading from input $\ket{k}$ to output $\ket{m}$ and add the corresponding amplitudes.
For example, as you can see in Figure \@ref(fig:composition-of-two-computation-steps), input $\ket{0}$ and output $\ket{1}$ are connected by the two computational paths: $\ket{0}\mapsto\ket{0}\mapsto\ket{1}$ (amplitude $V_{10}U_{00}$) and $\ket{0}\mapsto\ket{1}\mapsto\ket{1}$ (amplitude $V_{11}U_{10}$).
Thus the total amplitude that input $\ket{0}$ gives output $\ket{1}$ is the sum $V_{10}U_{00}+V_{11}U_{10}$, and when we take the modulus squared of this expression we will see the interference term.

(ref:composition-of-two-computation-steps-caption) The composition of two computational steps, $U$ and $V$, with the possible paths from $\ket{0}$ to $\ket{1}$ highlighted.

```{r composition-of-two-computation-steps,engine='tikz',fig.fullwidth=TRUE,fig.cap='(ref:composition-of-two-computation-steps-caption)'}
\definecolor{primary}{RGB}{177,98,78}
\tikzset{dot/.style={fill,shape=circle,minimum size=5pt,inner sep=0pt}}
\newcommand{\ket}[1]{|#1\rangle}
\begin{tikzpicture}[yscale=1.8]
  \node (input0) at (0,1) {$\ket{0}$};
  \node (input1) at (0,0) {$\ket{1}$};
  \node (middle0) at (5,1) {$\ket{0}$};
  \node (middle1) at (5,0) {$\ket{1}$};
  \node (output0) at (10,1) {$\ket{0}$};
  \node (output1) at (10,0) {$\ket{1}$};
  \foreach \x in {1,4,6,9}
    \foreach \y in {0,1}
      \node [dot] (n\x\y) at (\x,\y) {};
  \draw [thick] (input1) to (n10) to node [fill=white,pos=0.5] {$U_{11}$} (n40);
  \draw [thick] (n60) to node [fill=white,pos=0.25] {$V_{01}$} (n91);
  \draw [thick] (n10) to node [fill=white,pos=0.25] {$U_{01}$} (n41);
  \draw [thick] (n61) to node [fill=white,pos=0.5] {$V_{00}$} (n91) to (output0);
  \draw [ultra thick,primary] (input0) to node [fill=white,pos=0.5] {$U_{00}$} (middle0);
  \draw [ultra thick,primary] (n40) to (middle1);
  \draw [ultra thick,primary] (n11) to node [fill=white,pos=0.25] {$U_{10}$} (n40);
  \draw [ultra thick,primary] (middle0) to (n61);
  \draw [ultra thick,primary] (middle1) to node [fill=white,pos=0.5] {$V_{11}$} (output1);
  \draw [ultra thick,primary] (n61) to node [fill=white,pos=0.25] {$V_{10}$} (n90);
  \node [dot] at (n11) {};
  \node [dot] at (n41) {};
  \node [dot] at (n60) {};
  \node [dot] at (n90) {};
\end{tikzpicture}
```

In general, given $U$ and $V$
$$
  \begin{aligned}
    \ket{k}
    &\mapsto
    \sum_l U_{lk}\ket{l}
  \\\ket{l}
    &\mapsto
    \sum_m V_{ml}\ket{m}
  \end{aligned}
$$
we can compose the two operations: we first apply $U$, and then $V$, to obtain
$$
  \begin{aligned}
    \ket{k}
    &\mapsto
    \sum_l U_{lk} \left(
      \sum_m V_{ml}\ket{m}
    \right)
  \\&=
    \sum_m \left(
      \sum_l V_{ml}U_{lk}
    \right) \ket{m}
  \\&=
    \sum_m (VU)_{mk} \ket{m}.
  \end{aligned}
$$

If you want to hone your quantum intuition think about it the following way.
The amplitude that input $\ket{k}$ evolves to $\ket{m}$ via a specific intermediate state $\ket{l}$ is given by $V_{ml}U_{lk}$ (evolutions are independent so the amplitudes are multiplied).
This done, we have to sum over all possible values of $l$ (the transition can occur in several mutually exclusive ways so the amplitudes are added) to obtain $\sum_l V_{ml}U_{lk}$.
Thus the matrix multiplication $VU$ (watch the order of matrices) in one swoop takes care of multiplication and addition of amplitudes corresponding to different computational paths.





## Quantum bits, called "qubits"

A two-state machine that we have just described in abstract terms is usually realised as a controlled evolution of a two state system, called a quantum bit or a qubit.
For example, state $\ket{0}$ may be chosen to be the lowest energy state of an atom, the **ground state**, and state $\ket{1}$ a higher energy state, the **excited state**.
Pulses of light of appropriate frequency, duration and intensity can take the atom back and forth between the basis states $\ket{0}$ and $\ket{1}$ (implementing logical $\texttt{NOT}$).

```{r,engine='tikz',fig.width=3,fig.margin=TRUE}
\definecolor{primary}{RGB}{177,98,78}
\tikzset{blob/.style args={#1}{circle,draw,fill={#1}}}
\newcommand{\ket}[1]{|#1\rangle}
\begin{tikzpicture}[scale=0.7]
  \foreach \x in {0,2,4}
    \draw[thick] (0+\x,0) ellipse (20pt and 28pt);
  \foreach \x in {0,2,4}
    \draw (-0.4+\x,-0.4) to (0.4+\x,-0.4);
  \foreach \x in {0,2,4}
    \draw (-0.4+\x,0.4) to (0.4+\x,0.4);
  \node [blob=primary] at (0,0.4) {};
  \node [blob=primary] at (2,-0.4) {};
  \draw [fill=primary] (4,0) ellipse (3pt and 16pt);
  \node at (0,-1.4) {$\ket{0}$};
  \node at (2,-1.4) {$\ket{1}$};
  \node at (4,-1.4) {$\ket{\psi}$};
\end{tikzpicture}
```

Some other pulses, say, half the duration or intensity will take the atom into states that have no classical analogue.
Such states are called **coherent superpositions** of $\ket{0}$ and $\ket{1}$, and represent a qubit in state $\ket{0}$ with some amplitude $\alpha_0$ and in state $\ket{1}$ with some other amplitude $\alpha_1$.
This is conveniently represented by a state vector
$$
    \ket{\psi} =
    \alpha_0\ket{0} + \alpha_1\ket{1}
    \leftrightarrow
    \begin{bmatrix}
      \alpha_0
    \\\alpha_1
    \end{bmatrix}
$$

```{r,engine='tikz',fig.width=3,fig.margin=TRUE}
\definecolor{primary}{RGB}{177,98,78}
\definecolor{secondary}{RGB}{91,132,177}
\usetikzlibrary{arrows.meta}
\tikzset{blob/.style args={#1}{circle,draw,fill={#1}}}
\newcommand{\ket}[1]{|#1\rangle}
\begin{tikzpicture}[scale=1.1]
  \draw [->] (-1.3,0) to (1.3,0) node [label=right:{$\ket{0}$}] {};
  \draw [->] (0,-1.3) to (0,1.3) node [label=above:{$\ket{1}$}] {};
  \draw (0,0) circle (1cm);
  \draw [-,ultra thick,primary] (0,0) to (0.51,0);
  \draw [-,ultra thick,primary] (0,0) to (0,0.85);
  \draw [thick,primary,dashed] (0.51,0) to (0.51,0.85);
  \draw [thick,primary,dashed] (0,0.85) to (0.51,0.85);
  \draw [-{Latex},thick,rotate=59,secondary] (0,0) to (1,0);
  \node at (0.7,1.05) {$\ket{\psi}$};
  \node at (0.4,-0.15) {$\alpha_0$};
  \node at (-0.15,0.65) {$\alpha_1$};
\end{tikzpicture}
```

::: {.idea data-latex=""}
  A **qubit** is a quantum system in which the Boolean states $0$ and $1$ are represented by a prescribed pair of normalised and mutually orthogonal quantum states labelled as $\{\ket{0},\ket{1}\}$.
  The two states form a so-called **computational** (or **standard**) basis, and so any other state of an isolated qubit can be written as a coherent superposition
  $$
    \ket{\psi} = \alpha_0\ket{0} + \alpha_1\ket{1}
  $$
  for some $\alpha_0$ and $\alpha_1$ such that $|\alpha_0|^2 + |\alpha_1|^2 = 1$.

  In practice, a qubit is typically a microscopic system, such as an atom, a nuclear spin, or a polarised photon.
:::

As we have already mentioned, any^[ Here we are talking about _isolated_ systems. As you will soon learn, a larger class of physically admissible operations is described by completely positive maps. It may sound awfully complicated but, as you will soon see, it is actually very simple.] computational step, that is, any physically admissible operation $U$ on a qubit, is described by a $(2\times 2)$ unitary matrix $U$.
It modifies the state of the qubit as
$$
  \ket{\psi}
  \mapsto
  \ket{\psi'}
  =
  U\ket{\psi}
$$
which we can write explicitly as
$$
  \begin{bmatrix}
    \alpha'_0
  \\\alpha'_1
  \end{bmatrix}
  =
  \begin{bmatrix}
    U_{00} & U_{01}
  \\U_{10} & U_{11}
  \end{bmatrix}
  \begin{bmatrix}
    \alpha_0
  \\\alpha_1
  \end{bmatrix}
$$
That is, operation $U$ sends state $\ket{\psi}$, with components $\alpha_k$, into state $\ket{\psi'}=U\ket{\psi}$, with components $\alpha'_l= \sum_k U_{lk}\alpha_k$.





## Quantum gates and circuits

Atoms, trapped ions, molecules, nuclear spins and many other quantum objects, which we call qubits, can be used to implement simple quantum interference, and hence simple quantum computation.
There is no need to learn about physics behind these diverse technologies if all you want is to understand the basics of quantum computation.
We may now conveniently forget about any specific experimental realisation of a qubit and just remember that any manipulations on qubits have to be performed by physically admissible operations, and that such operations are represented by unitary transformations.

::: {.idea data-latex=""}
  A **quantum (logic) gate** is a device which performs a fixed unitary operation on selected qubits in a fixed period of time, and a **quantum circuit** is a device consisting of quantum logic gates whose computational steps are synchronised in time.
  The **sizes** of the circuit is the number of gates it contains.
:::

Some unitary $U$ acting on a single qubit is represented diagrammatically as

```{r,engine='tikz',fig.width=2.5,fig.align='center'}
\tikzset{operator/.style={draw,fill=white}}
\begin{tikzpicture}
  \draw (-1.5,0) to node [operator] {$U$} (1.5,0);
\end{tikzpicture}
```

This diagram should be read from left to right.
The horizontal line represents a qubit that is inertly carried from one quantum operation to another.
We often call this line a **quantum wire**.
The wire may describe translation in space (e.g. atoms travelling through cavities) or translation in time (e.g. a sequence of operations performed on a trapped ion).
A sequence of two gates acting on the same qubit, say $U$ followed by $V$, is represented by

```{r,engine='tikz',fig.width=2.5,fig.align='center'}
\tikzset{operator/.style={draw,fill=white}}
\begin{tikzpicture}
  \draw (-1.5,0) to (-1,0) to node [operator] {$U$} (0,0) to node [operator] {$V$} (1,0) to (1.5,0);
\end{tikzpicture}
```

and is described by the matrix product $VU$ (note the order in which we multiply the matrices).





## Single qubit interference

Let me now describe what is probably the most important sequence of operations performed on a single qubit, namely a generic **single qubit interference**.
It is typically constructed as a sequence of three elementary operations:

1. the Hadamard gate
2. a phase shift gate
3. the Hadamard gate again.

We represent it graphically as

```{r,engine='tikz',fig.width=2.5,fig.align='center'}
\tikzset{operator/.style={draw,fill=white}}
\tikzset{dot/.style={fill,shape=circle,minimum size=5pt,inner sep=0pt}}
\begin{tikzpicture}
  \draw (-1.5,0) to node [operator] {$H$} (0,0);
  \draw (0,0) to node [operator] {$H$} (1.5,0);
  \node [label=above:{$\varphi$},dot] at (0,0) {};
\end{tikzpicture}
```

::: {.idea data-latex=""}
  | Hadamard | Phase |
  | :------: | :---: |
  | $H=\frac{1}{\sqrt2}\begin{bmatrix}1&1\\1&-1\end{bmatrix}$ | $P_\varphi=\begin{bmatrix}1&0\\0&e^{i\varphi}\end{bmatrix}$ |
  | $\begin{array}{lcr}\ket{0}&\mapsto&\frac1{\sqrt{2}}(\ket{0}+\ket{1})\\\ket{1}&\mapsto&\frac1{\sqrt{2}}(\ket{0}-\ket{1})\end{array}$ | $\begin{array}{lcr}\ket{0}&\mapsto&\ket{0}\\\ket{1}&\mapsto&e^{i\varphi}\ket{1}\end{array}$ |
:::

You will see it over and over again, for it is quantum interference that gives quantum computation additional capabilities.
The product of the three matrices $HP_\varphi H$ describes the action of the whole circuit: it gives the transition amplitudes between states $\ket{0}$ and $\ket{1}$ at the input and the output as
$$
  e^{i\frac{\varphi}{2}}
  \begin{bmatrix}
    \cos\varphi/2 & -i\sin\varphi/2
  \\-i\sin\varphi/2 & \cos\varphi/2
  \end{bmatrix}
  =
  \frac{1}{\sqrt 2}
  \begin{bmatrix}
    1 & 1
  \\1 & -1
  \end{bmatrix}
  \begin{bmatrix}
    1 & 0
  \\0 & e^{i\varphi}
  \end{bmatrix}
  \frac{1}{\sqrt 2}
  \begin{bmatrix}
    1 & 1
  \\1 & -1
  \end{bmatrix}
$$

Given that our input state is almost always $\ket{0}$, it is sometimes much easier and more instructive to step through the execution of this circuit and follow the evolving state.
The interference circuit effects the following sequence of transformations:^[We ignore the global phase factor $e^{i\frac{\varphi}{2}}$.]
$$
  \ket{0}
  \xmapsto{H}
  \frac{1}{\sqrt2} \left(
    \ket{0}+\ket{1}
  \right)
  \xmapsto{P_\phi}
  \frac{1}{\sqrt2} \left(
    \ket{0}+e^{i\phi}\ket{1}
  \right)
  \xmapsto{H}
  \cos\frac{\phi}{2}\ket{0} - i\sin\frac{\phi}{2}\ket{1}.
$$
The first Hadamard gate prepares an equally weighted superposition of $\ket{0}$ and $\ket{1}$ and the second one closes the interference by bringing the interfering paths together.
The phase shift $\varphi$ effectively controls the evolution and determines the output.
The probabilities of finding the qubit in state $\ket{0}$ or $\ket{1}$ at the output are, respectively,
$$
  \begin{aligned}
    \Pr(0) &= \cos^2\frac{\phi}{2}
  \\\Pr(1) &= \sin^2\frac{\phi}{2}.
  \end{aligned}
$$
This simple quantum process contains, in a nutshell, the essential ingredients of quantum computation.
This sequence (Hadamard -- phase shift -- Hadamard) will appear over and over again.
It reflects a natural progression of quantum computation: first we prepare different computational paths, then we evaluate a function which effectively introduces phase shifts into different computational paths, then we bring the computational paths together at the output.





## The square root of NOT

Now that we have poked our heads into the quantum world, let us see how quantum interference challenges conventional logic.
Consider a following task: design a logic gate that operates on a single bit and such that when it is followed by another, identical, logic gate the output is always the negation of the input.
Let us call this logic gate **the square root of $\texttt{NOT}$**, or $\sqrt{\texttt{NOT}}$.

```{r,engine='tikz',fig.width=3,fig.margin=TRUE}
\tikzset{operator/.style={draw,fill=white}}
  \begin{tikzpicture}[scale=1.3]
    \draw [fill=gray!40,rounded corners=2mm] (-1.2,-0.4) rectangle (1.2,0.4);
    \draw (-1.5,0) to (-1,0) to node [operator] {$\sqrt{\texttt{NOT}}$} (0,0) to node [operator] {$\sqrt{\texttt{NOT}}$} (1,0) to (1.5,0);
    \node at (0,-0.65) {$\texttt{NOT}$};
  \end{tikzpicture}
```

A simple check, such as an attempt to construct a truth table, should persuade you that there is no such operation in logic.
It may seem reasonable to argue that since there is no such operation in logic, $\sqrt{\texttt{NOT}}$ is impossible.
But it does exist!
Experimental physicists routinely construct such ``impossible'' gates in their laboratories.
It is a physically admissible operation described by the unitary matrix^[There are infinitely many unitary operations that act as the square root of $\texttt{NOT}$.]
$$
  \sqrt{\texttt{NOT}}
  =
  \frac12
  \begin{bmatrix}
    1+i & 1-i
  \\1-i&1+i
  \end{bmatrix}
  =
  \frac1{\sqrt2}
  \begin{bmatrix}
    e^{i\frac{\pi}{4}} & e^{-i\frac{\pi}{4}}
  \\e^{-i\frac{\pi}{4}} & e^{i\frac{\pi}{4}}
  \end{bmatrix}.
$$
Indeed,
$$
  \frac12
  \begin{bmatrix}
    1+i & 1-i
  \\1-i & 1+i
  \end{bmatrix}
  \frac12
  \begin{bmatrix}
    1+i & 1-i
  \\1-i & 1+i
  \end{bmatrix}
  =
  \begin{bmatrix}
    0&1
  \\1&0
  \end{bmatrix}.
$$

We could also step through the circuit diagram and follow the evolution of the state vector:

```{r,engine='tikz',fig.width=5,fig.align='center'}
\tikzset{operator/.style={draw,fill=white}}
\newcommand{\ket}[1]{|#1\rangle}
\begin{tikzpicture}
  \begin{scope}[xscale=3]
    \node (input) at (-1.5,0) {$\ket{0}$};
    \node (output) at (1.5,0) {$\ket{1}$};
    \draw (input) to node [operator] {$\sqrt{\texttt{NOT}}$} (0,0);
    \draw (0,0) to node [operator] {$\sqrt{\texttt{NOT}}$} (output);
  \end{scope}
  \begin{scope}[xscale=3,shift={(0,-1.5)}]
    \node (input) at (-1.5,0) {$\ket{0}$};
    \node (inter) at (0,0) {$\frac{1}{\sqrt 2}\left[e^{i\frac{\pi}{4}}\ket{0}+e^{-i\frac{\pi}{4}}\ket{1}\right]$};
    \node (output) at (1.5,0) {$\ket{1}$};
    \draw[|->] (input) to node[label=above:{$\sqrt{\texttt{NOT}}$}]{} (inter);
    \draw[|->] (inter) to node[label=above:{$\sqrt{\texttt{NOT}}$}]{} (output);
  \end{scope}
\end{tikzpicture}
```

Or, if you prefer to work with column vectors and matrices, you can write the two consecutive application of $\sqrt{\texttt{NOT}}$ to state $\ket{0}$ as
$$
  \begin{bmatrix}0\\1\end{bmatrix}
  \,\longleftarrow\!\!\!\vert\,\,
  \frac{1}{\sqrt 2}
  \begin{bmatrix}
    e^{i\frac{\pi}{4}}
  \\e^{-i\frac{\pi}{4}}
  \end{bmatrix}
  \,\longleftarrow\!\!\!\vert\,\,
  \begin{bmatrix}1\\0\end{bmatrix}
$$
(following a well established convention, the above should be read from _right to left_)^[Just remember that circuits diagrams are read from _left to right_, and vector and matrix operations go from _right to left_.], where each $\longleftarrow\!\!\!\vert$ denotes multiplication by $\frac1{\sqrt2}\begin{bmatrix}e^{i\frac{\pi}{4}} & e^{-i\frac{\pi}{4}}\\e^{-i\frac{\pi}{4}} & e^{i\frac{\pi}{4}}\end{bmatrix}$.


One way or another, quantum theory explains the behaviour of $\sqrt{\texttt{NOT}}$, and so, reassured by the physical experiments^[We discuss this in more detail in [Appendix: Physics against logic, via beamsplitters].] that corroborate this theory, logicians are now entitled to propose a new logical operation $\sqrt{\texttt{NOT}}$.
Why?
Because a faithful physical model for it exists in nature!





## Phase gates galore

As well as the generic phase gate $P_\varphi$, let us mention three specific phase gates that will frequently pop up (two of which have rather confusing names, at first glance!).

::: {.idea data-latex=""}
  | Generic phase | Phase-flip | $\pi/4$-phase | $\pi/8$-phase |
  | :-----------: | :--------: | :-----------: | :-----------: |
  | $P_\varphi=\begin{bmatrix}1&0\\0&e^{i\varphi}\end{bmatrix}$ | $Z=\begin{bmatrix}1&0\\0&-1\end{bmatrix}$ | $S=\begin{bmatrix}1&0\\0&i\end{bmatrix}$ | $T=\begin{bmatrix}1&0\\0&e^{i\frac{\pi}{4}}\end{bmatrix}$ |
:::

Note that the phase gate $P_\varphi$ is only defined up to a global phase factor,^[In general, states differing only by a global phase are physically indistinguishable, and so it is physical experimentation that leads us to this mathematical choice of only defining things up to a global phase.] and so we can write its matrix either as
$$
  P_\varphi =
  \begin{bmatrix}
    1 & 0
  \\0 & e^{i\varphi}
  \end{bmatrix}
$$
or as
$$
  P_\varphi =
  \begin{bmatrix}
    e^{-i\frac{\varphi}{2}} & 0
  \\0 & e^{i\frac{\varphi}{2}}
  \end{bmatrix}
$$
The first version is more common in the quantum information science community, but the second one is sometimes more convenient to use, as it has determinant $1$, and hence belongs to the group $\mathrm{SU}(2)$.
We will occasionally switch to the $\mathrm{SU}(2)$ version of a phase gates, and this is where the $\pi/4$-phase and $\pi/8$-phase gates get their names, since their $\mathrm{SU}(2)$ versions have $e^{\mp i\pi/4}$ and $e^{\mp i\pi/8}$ (respectively) on the diagonal.

The remaining gate ($Z$) is arguably the most important specific phase gate, since it is one of the **Pauli operators**, which we will now discuss.





## Pauli operators

Adding to our collection of common single-qubit gates, we now look at the three **Pauli operators**^[We use the standard basis $\{\ket{0},\ket{1}\}$ most of the time, and so often refer to operators as matrices.] $\sigma_x$, $\sigma_y$, and $\sigma_z$, also denoted by $X$, $Y$, and $Z$ (respectively).
These three operators, combined with the identity, satisfy a lot of nice formal properties, which we shall examine briefly here, and the return to in more detail in [Linking Pauli matrices and the Bloch sphere].

::: {.idea data-latex=""}
  | Identity | Bit-flip | Bit-phase-flip | Phase-flip |
  | :------: | :------: | :------------: | :--------: |
  | $\id=\begin{bmatrix}1&0\\0&1\end{bmatrix}$ | $X=\begin{bmatrix}0&1\\1&0\end{bmatrix}$ | $Y=\begin{bmatrix}0&-i\\i&0\end{bmatrix}$ | $Z=\begin{bmatrix}1&0\\1&-1\end{bmatrix}$ |
:::

The identity is just a quantum wire, and we have already seen the $X$ and $Z$ gates in [Phase gates galore], as the bit-flip and phase-flip (respectively).
Note that, of these latter two, only the $X$ gate has a classical analogue (as the logical $\texttt{NOT}$ operator).
The remaining gate, the $Y$ operator, describes the combined effect of both the bit- and the phase-flip: $ZX=iY$.

In fact, this is just one of the equations that the Pauli matrices satisfy.
The Pauli matrices are both unitary and Hermitian, they square to the identity, and they anti-commute.
By this last point, we mean that
$$
  \begin{aligned}
    XY+YX&=0,
  \\XZ+ZX&=0,
  \\YZ+ZY&=0.
  \end{aligned}
$$
As already mentioned, they satisfy $ZX=iY$, but also any cyclic permutation of this equation.

These operators are also called **sigma matrices**, or **Pauli spin matrices**.
They are so ubiquitous in quantum physics that they should certainly be memorised.





## From bit-flips to phase-flips, and back again

The Pauli $Z$ gate is a special case of a phase gate $P_\varphi$ with $\varphi=\pi$.
When we insert it into the interference circuit we obtain

```{r,engine='tikz',fig.width=5,fig.align='center'}
\tikzset{operator/.style={draw,fill=white}}
\begin{tikzpicture}
  \draw (-2,0) to (-1.5,0) to node [operator] {$H$} (-0.5,0) to node [operator] {$Z$} (0.5,0) to node [operator] {$H$} (1.5,0) to (2,0);
  \node at (2.5,0) {=};
  \draw (3,0) to node [operator] {$X$} (4.5,0);
\end{tikzpicture}
```

If you wish to verify this, write the Hadamard gate as $H = (X+Z)/\sqrt{2}$ and use the properties of the Pauli operators.^[$\begin{aligned}HXH &= Z\\HZH &= X\\HYH &= -Y\end{aligned}$]
So the Hadamard gate turns phase-flips into bit-flips, but it also turns bit-flips into phase-flips:

```{r,engine='tikz',fig.width=5,fig.align='center'}
\tikzset{operator/.style={draw,fill=white}}
\begin{tikzpicture}
  \draw (-2,0) to (-1.5,0) to node [operator] {$H$} (-0.5,0) to node [operator] {$Z$} (0.5,0) to node [operator] {$H$} (1.5,0) to (2,0);
  \node at (2.5,0) {=};
  \draw (3,0) to node [operator] {$X$} (4.5,0);
\end{tikzpicture}
```

Let us also add, for completeness, that $HYH=-Y$.
You will see these identities again and again, especially when we discuss quantum error corrections.^[Unitaries, such as $H$, that take the three Pauli operators to the Pauli operators via conjugation form the so-called **Clifford group**, which we will meet later on. Which phase gate is in the Clifford group of a single qubit?]





## Any unitary operation on a single qubit

There are infinitely many unitary operations that can be performed on a single qubit.
In general, any complex $(n\times n)$ matrix has $n^2$ complex entries, and can thus be specified by $2n^2$ real independent parameters.
The unitarity constraint removes $n^2$ of these, and so any unitary $(n\times n)$ matrix has $n^2$ real independent parameters.
In particular, we need _four_ real parameters to specify a $(2\times 2)$ unitary matrix.
If we are prepared to ignore global phase factors (which we are) then there are only three real parameters left.
So, with this in mind, can we construct and implement any unitary on a single qubit in some simple way?

_Yes, we can._

Any unitary operation on a qubit (up to an overall multiplicative phase factor) can be implemented by a circuit containing just two Hadamards and three phase gates, with adjustable phase settings, as in Figure \@ref(fig:universal-circuit-for-2-by-2).

(ref:universal-circuit-for-2-by-2-caption) The universal circuit for unitary $(2\times2)$ matrices.

```{r universal-circuit-for-2-by-2,engine='tikz',fig.width=5,fig.align='center',fig.cap='(ref:universal-circuit-for-2-by-2-caption)'}
\tikzset{operator/.style={draw,fill=white}}
\tikzset{dot/.style={fill,shape=circle,minimum size=5pt,inner sep=0pt}}
\begin{tikzpicture}[xscale=2]
  \node [dot,label=above:{$\alpha$}] (phase1) at (-1,0) {};
  \node [dot,label=above:{$\varphi$}] (phase2) at (0,0) {};
  \node [dot,label=above:{$\beta$}] (phase3) at (1,0) {};
  \draw (-1.5,0) to (-1,0);
  \draw (1,0) to (1.5,0);
  \draw (phase1) to node [operator] {$H$} (phase2);
  \draw (phase2) to node [operator] {$H$} (phase3);
\end{tikzpicture}
```

If we multiply the matrices corresponding to each gate in the network (remember that the order of matrix multiplication is reversed) we obtain
$$
  U(\alpha,\beta,\gamma)
  =\begin{bmatrix}
    e^{-i\left(\frac{\alpha+\beta}{2}\right)}\cos\varphi/2
    & -ie^{i\left(\frac{\alpha-\beta}{2}\right)}\sin\varphi/2
  \\-ie^{-i\left(\frac{\alpha-\beta}{2}\right)}\sin\varphi/2
    & e^{i\left(\frac{\alpha+\beta}{2}\right)}\cos\varphi/2
  \end{bmatrix}.
$$
Any $(2\times 2)$ unitary matrix (up to global phase) can be expressed in this form using the three independent real parameters, $\alpha$, $\beta,$ and $\varphi$, which take values in $[0,2\pi]$.
In order to see that this construction does what it claims, let us explore an intriguing mathematical connection between single qubit unitaries and rotations in three dimensions.





## The Bloch sphere

Unitary operations on a single qubit form a group.
More precisely, the set of all $(2\times 2)$ unitary matrices forms a non-abelian group under the matrix multiplication, denoted by $\mathrm{U}(2)$.
It turns out that compositions of single qubit unitaries behave pretty much the same as compositions of rotations in three dimensions.
Technically speaking, $\mathrm{U}(2)/\mathrm{U}(1)\cong \mathrm{SO}(3)$.^[Note that $\mathrm{U}(1)\cong\mathbb{C}^\times$, where $\mathbb{C}^\times$ is the multiplicative group of unit elements of the complex numbers, i.e. the set $\mathbb{C}\setminus\{0\}$ with the group operation given by multiplication.]
That is, $(2\times 2)$ unitaries, up to global phase, form a group which is isomorphic to the group of rotations in three dimensions, denoted by $\mathrm{SO}(3)$.
This isomorphism helps to visualise the actions of single qubit gates.

There are many ways to introduce this isomorphism.
Here we will first show how to represent single-qubit state vectors in terms of Euclidean vectors in three dimensions, and then relate unitary operations on state vectors to rotations in this Euclidean space.

Any single qubit state can be written as $\ket{\psi}=\alpha\ket{0}+\beta\ket{1}$, constrained by the relation $|\alpha|^2+|\beta|^2=1$.
This suggests a more natural parametrisation as^[There is a good reason to use $\theta/2$ instead of $\theta$, which we will explain later on.]
$$
  \ket{\psi} =
  \cos\frac{\theta}{2}e^{i\varphi_0}\ket{0}
  + \sin\frac{\theta}{2}e^{i\varphi_1}\ket{1}.
$$
We can then factor out a global phase:
$$
  \ket{\psi} =
  e^{i\varphi_0}\left(
    \cos\frac{\theta}{2}\ket{0} + \sin\frac{\theta}{2}e^{i\varphi}\ket{1}
  \right),
$$
and even remove it completely, since states that are identical up to a global phase are physically indistinguishable.

The parametrisation in terms of $\theta$ and $\varphi$ should remind you of spherical polar coordinates for the surface of a sphere.

(ref:bloch-sphere-caption) The Bloch sphere, with the point $\vec{s}$ corresponding to $\ket{\psi}$ marked.

```{r bloch-sphere,engine='tikz',fig.width=4.5,fig.align='center',fig.cap='(ref:bloch-sphere-caption)'}
\usetikzlibrary{arrows.meta}
\tikzset{dot/.style={fill,shape=circle,minimum size=5pt,inner sep=0pt}}
\definecolor{primary}{RGB}{177,98,78}
\definecolor{secondary}{RGB}{91,132,177}
\newcommand{\ket}[1]{|#1\rangle}
\begin{tikzpicture}
  \shade [ball color=gray!40,opacity=0.4] (0,0) circle (2cm);
  \draw (0,0) circle (2cm);
  \draw (-2,0) arc (180:360:2 and 0.9);
  \draw [dashed,thin] (2,0) arc (0:180:2 and 0.9);
  %
  \node [label=above:{$\ket{0}$}] (top) at (0,2) {};
  \node [label=right:{$y$}] (right) at (2,0) {};
  \node [label=below:{$\ket{1}$}] (bottom) at (0,-2) {};
  \node (front) at (225:1.2) {};
  \node at (225:1.4) {$x$};
  \draw [<->] (bottom) to (top);
  \draw [->] (0,0) to (right);
  \draw [->] (0,0) to (front);
  %
  \draw [thin,fill=primary!80] (0,0) to (0,0.72) to [bend left] (0.35,0.525) to cycle;
  \draw [thin,fill=primary!80] (0,0) to (0.48,-0.3) to [bend left] (225:0.5) to cycle;
  \node at (0.15,0.45) {$\theta$};
  \node [fill=primary!80,inner sep=0] at (0.05,-0.25) {$\varphi$};
  %
  \node [fill,shape=circle,minimum size=3pt,inner sep=0pt] (origin) at (0,0) {};
  \node [dot,secondary,label=right:{$\vec{s}$}] (vector) at (0.8,1.2) {};
  \draw [-Latex,secondary] (origin) to (vector);
  \draw [dashed,ultra thick] (vector) to (0.8,-0.5) to (origin);
\end{tikzpicture}
```

We call this sphere the **Bloch sphere**, and the unit vector ${\vec s}$ defined by $\theta$ and $\varphi$ the **Bloch vector**.^[We will revisit this construction again in more detail, and from a slightly different point of view, in [Linking Pauli matrices and the Bloch sphere].]
This is a very useful way to visualise quantum states of a single qubit and unitary operations that we perform on it.
Any unitary action on the state vector will induce a rotation of the corresponding Bloch vector.
But what kind of rotation?

Note that any two orthogonal state vectors appear on the Bloch sphere as two Bloch vectors pointing in opposite directions.
Now, the two eigenvectors of a single-qubit unitary $U$ must be orthogonal, and thus define an axis running through the centre of the Bloch sphere.
This is the axis about which the Bloch vector is rotated when $U$ acts on the corresponding state vector.
The rotation angle $\alpha$ is given by the eigenvalues of $U$, which, up to a global phase factor, are of the form $e^{\mp i\alpha/2}$.

It is instructive to work out few simple cases and get a feel for the rotations corresponding to the most common unitaries.
For example, it is easy to check that a phase gate $P_\alpha$ acts by
$$
  \cos\frac{\theta}{2}\ket{0} + e^{i\varphi}\sin\frac{\theta}{2}\ket{1}
  \longmapsto
  \cos\frac{\theta}{2}\ket{0} + e^{i(\varphi+\alpha)}\sin\frac{\theta}{2}\ket{1}.
$$
The azimuthal angle changes from $\varphi$ to $\varphi+\alpha$, and so the Bloch sphere is rotated anticlockwise by $\alpha$ about the $z$-axis.
The Bloch vectors corresponding to the two eigenvectors of $P_\alpha$, namely $\ket{0}$ and $\ket{1}$, define the axis of the rotation.

(ref:bloch-sphere-rotation-caption) Phase gates $P_\alpha$ represent rotations of the Bloch sphere around the $z$-axis.

```{r bloch-sphere-rotation,engine='tikz',fig.width=5,fig.align='center',fig.cap='(ref:bloch-sphere-rotation-caption)'}
\usetikzlibrary{arrows.meta}
\definecolor{primary}{RGB}{177,98,78}
\definecolor{secondary}{RGB}{91,132,177}
\begin{tikzpicture}
  \shade [ball color=gray!40,opacity=0.4] (0,0) circle (2cm);
  \draw (0,0) circle (2cm);
  \draw (-2,0) arc (180:360:2 and 0.9);
  \draw [dashed,thin] (2,0) arc (0:180:2 and 0.9);
  %
  \draw [<->,secondary] (0,-3) to (0,3);
  \draw [->,thin] (0,0) to (1,0);
  \draw [->,thin] (0,0) to (225:0.7);
  %
  \node [fill,shape=circle,minimum size=3pt,inner sep=0pt,label=above:{$\vec s$}] at (-1.15,0.85) {};
  \draw [-Latex,primary] (-1,0.7) arc (200:320:1 and 0.4);
  \node [fill,shape=circle,minimum size=3pt,inner sep=0pt,label=above:{$P_\alpha\vec s$}] at (0.85,0.65) {};
  %
  \draw [-Latex,ultra thick,primary] (-2.5,0.2) arc (160:400:2.75 and 1.2);
\end{tikzpicture}
```

As previously mentioned, the Pauli operator  $Z=\sigma_z$ is a special case of a phase gate, and represents rotation by ${180}^{\circ}$ (that is, $\pi$ radians), about the $z$-axis.
You can also verify that $X=\sigma_x$, with eigenvectors ${(\ket{0}\pm\ket{1})/\sqrt{2}}$, represents rotation by ${180}^{\circ}$ about the $x$-axis, and $Y=\sigma_y$, with eigenvectors ${(\ket{0}\pm i\ket{1})/\sqrt{2}}$, represents rotation by ${180}^{\circ}$ about the $y$-axis.

How about the Hadamard gate?
Like the Pauli operators, it squares to the identity ($H^2=\id$), which implies that its eigenvalues are $\pm 1$.
Thus it will correspond to a rotation by ${180}^{\circ}$.
But about which axis?
This time, rather than finding eigenvectors of $H$, we notice that $HXH=Z$ and $HZH=X$, thus $H$ must swap $x$- and $z$-axes, turning rotations about the $z$-axis into rotations about the $x$-axis, and vice versa.
The Hadamard gate must then represent rotation by ${180}^{\circ}$ about the diagonal $(x+z)$-axis.
You may also notice that, after this rotation, the $y$-axis points in the opposite direction, which seems to be related to another identity: $HYH=-Y$.
This is not a coincidence.

One can show^[Again, see [Linking Pauli matrices and the Bloch sphere].] that the effect of the rotation represented by unitary $U$ on the Bloch vector with components $s_x$, $s_y$, $s_z$ is summarised in the formula
$$
  U (s_x X + s_y Y + s_z Z) U^\dagger
  = s'_x X+ s'_y Y + s'_z Z,
$$
where $s'_x$, $s'_y$, and $s'_z$ are the components of the rotated Bloch vector.





## Composition of rotations

We are now in a position understand the circuit in Figure \@ref(fig:universal-circuit-for-2-by-2) in geometric terms.
Recall that _any_ rotation in the Euclidean space can be performed as a sequence of three rotations: one about the $z$-axis, one about the $x$-axis, and one more about $z$-axis.
The circuit does exactly this:

```{r,engine='tikz',fig.width=5,fig.align='center'}
\tikzset{operator/.style={draw,fill=white}}
\tikzset{dot/.style={fill,shape=circle,minimum size=5pt,inner sep=0pt}}
\begin{tikzpicture}[xscale=2]
  \draw [fill=gray!40,rounded corners=2mm] (-0.75,-0.75) rectangle (0.75,0.75);
  \node [dot,label=above:{$\alpha$}] (phase1) at (-1,0) {};
  \node [dot,label=above:{$\varphi$}] (phase2) at (0,0) {};
  \node [dot,label=above:{$\beta$}] (phase3) at (1,0) {};
  \draw (-1.5,0) to (-1,0);
  \draw (1,0) to (1.5,0);
  \draw (phase1) to node [operator] {$H$} (phase2);
  \draw (phase2) to node [operator] {$H$} (phase3);
\end{tikzpicture}
```

The first phase gate effects rotation by $\alpha$ about the $z$-axis, the second phase gate is sandwiched between the two Hadamard gates, and these three gates together effect rotation by $\varphi$ about the $x$-axis, and, finally, the third phase gates effects rotation by $\beta$ about the $z$-axis.
So we can implement any unitary $U$ by choosing the three phase shifts, $\alpha$, $\varphi$, and $\beta$, which are known as the three **Euler's angles**.






## A finite set of universal gates

The Hadamard gate and the phase gates, with adjustable phases, allow us to implement an arbitrary single-qubit unitary _exactly_.
The tacit assumption here is that we have here _infinitely many_ phase gates: one gate for each phase.
In fact, we can pick just one phase gate, namely any phase gate $P_\alpha$ with the phase $\alpha$ that is incommensurate^[That is, there do _not_ exist any $m,n\in\mathbb{Z}$ such that $m\alpha=n\pi$. For example, it suffices to take $\alpha$ to be rational.] with $\pi$.
It is clear that repeated iteration of $P_\alpha$ can be used to approximate any other phase gate to arbitrary accuracy: indeed, rotate the Bloch sphere by $\alpha$ about the $z$-axis sufficiently many times and you end up as close as you please to any other rotation about the $z$-axis.

If you want to be $\epsilon$-close to the desired angle of rotation, then you may need to repeat the rotation by $\alpha$ roughly $1/\epsilon$ times.
Indeed, within $n$ applications (for $n\alpha\gg 2\pi$) of $P_\alpha$, we expect the accessible angles to be approximately evenly distributed within the range $[0,2\pi]$, i.e. any angle of rotation can be achieved to an accuracy of $\epsilon=2\pi/n$ by using up to $n\approx 1/\epsilon$ applications of $P_\alpha$.
So we can use _just one_ phase gate to _approximate_ the _three_ phase gates in the circuit in Figure \@ref(fig:universal-circuit-for-2-by-2).

There are other ways of implementing irrational rotations of the Bloch sphere.
For example, take the Hadamard gate and the $T$ gate.
You can check that the compositions $THTH$ and $HTHT$ represent rotations by angles which are irrational multiples of $\pi$, about two different axes.
We can then compose a sequence of these two rotations to approximate any other rotation of the sphere.
This may look very nice in theory, but there are issues with the actual physical implementation of this approach.
All the gates in the circuit will operate with finite precision, and the phase gates will deviate from implementing the required irrational rotations.
It turns out, however, that we can tolerate minor imperfections; the final result will not be that far off.

For more details on all the above, see [Linking Pauli matrices and the Bloch sphere].





## Appendix: Physics against logic, via beamsplitters

> The square root of $\texttt{NOT}$, and showing that it can be as simple as a symmetric beam-splitter.
> In fact, playing with mirrors and beam-splitters can give you lots of insights into the quantum world.

A symmetric beam-splitter is a cube of glass which reflects half the light that impinges upon it, while allowing the remaining half to pass through unaffected.
For our purposes it can be viewed as a device which has two input and two output ports which we label as $\ket{0}$ and $\ket{1}$, as in Figure \@ref(fig:beam-splitter).

```{r beam-splitter,engine='tikz',fig.align='center',fig.width=2,fig.cap='A beam-splitter.'}
\usetikzlibrary{arrows.meta}
\tikzset{beamsplitter/.pic={\draw [fill=gray!10] (-0.4,-0.4) -- (-0.4,0.4) -- (0.4,0.4);\draw [fill=gray!40] (-0.4,-0.4) -- (0.4,-0.4) -- (0.4,0.4);\draw (-0.4,-0.4) -- (0.4,0.4);}}
\tikzset{process/.style={thick,-{Latex},shorten >=0.1cm,shorten <=0.1cm}}
\newcommand{\ket}[1]{|#1\rangle}
\begin{tikzpicture}
  \path (0,0) pic {beamsplitter};
  \draw [process] (-1,0) to (1,0);
  \draw [process] (0,-1) to (0,1);
  \node at (-1.2,0) {$\ket{0}$};
  \node at (0,-1.2) {$\ket{1}$};
  \node at (1.2,0) {$\ket{0}$};
  \node at (0,1.2) {$\ket{1}$};
\end{tikzpicture}
```

When we aim a single photon at such a beam-splitter using one of the input ports, we notice that the photon doesn't split in two: we can place photo-detectors wherever we like in the apparatus, fire in a photon, and verify that if any of the photo-detectors registers a hit, none of the others do.
In particular, if we place a photo-detector behind the beam-splitter in each of the two possible exit beams, the photon is detected with equal probability at either detector, no matter whether the photon was initially fired from input port $\ket{0}$ or $\ket{1}$.

It may seem obvious that, at the very least, the photon is _either_ in the transmitted beam $\ket{0}$ _or_ in the reflected beam $\ket{1}$ during any one run of this experiment.
Thus we may be tempted to think of the beam-splitter as a random binary switch which, with equal probability, transforms any binary input into one of the two possible outputs.
However, that is not necessarily the case.
Let us introduce a second beam-splitter and place two normal mirrors so that both paths intersect at the second beam-splitter, resulting in something resembling the Mach-Zehnder interferometer (see \@ref(fig:two-beam-splitters)).

```{r two-beam-splitters,engine='tikz',fig.align='center',fig.width=5,fig.cap='Two beam-splitters with mirrors, so that a photon travels through both.'}
\usetikzlibrary{arrows.meta}
\usetikzlibrary{decorations.markings}
\tikzset{beamsplitter/.pic={\draw [fill=gray!10] (-0.4,-0.4) -- (-0.4,0.4) -- (0.4,0.4);\draw [fill=gray!40] (-0.4,-0.4) -- (0.4,-0.4) -- (0.4,0.4);\draw (-0.4,-0.4) -- (0.4,0.4);}}
\tikzset{process/.style={thick,-{Latex},shorten >=0.1cm,shorten <=0.1cm}}
\tikzset{mirror/.pic={\draw [line width=2pt] (-0.3,-0.3) -- (0.3,0.3);}}
\tikzset{middlearrow/.style 2 args={decoration={markings,mark=at position #2 with {\arrow{#1}}},postaction=decorate}}
\tikzset{pics/measure left/.style args={#1}{code={\draw [fill=gray!15] (0,-0.5) arc (-90:90:0.5cm) -- cycle;\node [anchor=mid] at (0.22,0) {#1};}}}
\tikzset{pics/measure top/.style args={#1}{code={\draw [fill=gray!15] (0.5,0) arc (0:180:0.5cm) -- cycle;\node [anchor=mid] at (0,0.22) {#1};}}}
\newcommand{\ket}[1]{|#1\rangle}
\begin{tikzpicture}
  \draw (0,0) pic {beamsplitter};
  \draw (4,3) pic {beamsplitter};
  \draw (0,3) pic {mirror};
  \draw (4,0) pic {mirror};
  \draw (5.2,3) pic {measure left={1}};
  \draw (4,4.2) pic {measure top={0}};
  \draw [thick,middlearrow={Latex}{0.6}] (0,-1.1) to (0,3);
  \draw [thick,-Latex,shorten >=0.1cm] (0,3) to (5.2,3);
  \draw [thick,middlearrow={Latex}{0.5}] (-1.1,0) to (4,0);
  \draw [thick,-Latex,shorten >=0.1cm] (4,0) to (4,4.2);
  \node at (-1.5,0) {$\ket{0}$};
  \node at (0,-1.5) {$\ket{1}$};
\end{tikzpicture}
```

Now, the axiom of additivity in probability theory says that whenever something can happen in several alternative ways we add probabilities for each way considered separately.
We might argue that a photon fired into the input port $\ket{0}$ can reach the detector $0$ in two _mutually exclusive_ ways: either by two consecutive reflections or by two consecutive transmissions.
Each reflection happens with probability $1/2$ and each transmission happens with probability $1/2$ thus the total probability of reaching detector 0 is a sum of the probability of the two consecutive reflections ($1/2\times 1/2 = 1/4$) and the probability of the two consecutive transmissions ($1/2\times 1/2 = 1/4$) which gives probability $1/2$.
This is summarised in \@ref(fig:classical-guess-double-beam-splitter), and makes perfect sense --- a random switch followed by a random switch should give nothing else but a random switch.
However, if we set up such an experiment, that is not what happens!

::: {.idea data-latex=""}
  There is no reason why probability theory or any other a priori mathematical construct should make any meaningful statements about outcomes of physical experiments.
:::

```{r classical-guess-double-beam-splitter,engine='tikz',fig.fullwidth=TRUE,fig.cap='The two possible classical scenarios. Note that this is **not** what actually happens in the real physical world!'}
\usetikzlibrary{arrows.meta}
\usetikzlibrary{decorations.markings}
\tikzset{beamsplitter/.pic={\draw [fill=gray!10] (-0.4,-0.4) -- (-0.4,0.4) -- (0.4,0.4);\draw [fill=gray!40] (-0.4,-0.4) -- (0.4,-0.4) -- (0.4,0.4);\draw (-0.4,-0.4) -- (0.4,0.4);}}
\tikzset{process/.style={thick,-{Latex},shorten >=0.1cm,shorten <=0.1cm}}
\tikzset{mirror/.pic={\draw [line width=2pt] (-0.3,-0.3) -- (0.3,0.3);}}
\tikzset{middlearrow/.style 2 args={decoration={markings,mark=at position #2 with {\arrow{#1}}},postaction=decorate}}
\tikzset{pics/measure left/.style args={#1}{code={\draw [fill=gray!15] (0,-0.5) arc (-90:90:0.5cm) -- cycle;\node [anchor=mid] at (0.22,0) {#1};}}}
\tikzset{pics/measure top/.style args={#1}{code={\draw [fill=gray!15] (0.5,0) arc (0:180:0.5cm) -- cycle;\node [anchor=mid] at (0,0.22) {#1};}}}
\newcommand{\ket}[1]{|#1\rangle}
\begin{tikzpicture}[yscale=0.7]
  \begin{scope}
    \draw (0,0) pic {beamsplitter};
    \draw (4,3) pic {beamsplitter};
    \draw (0,3) pic {mirror};
    \draw (4,0) pic {mirror};
    \draw (5.2,3) pic {measure left={1}};
    \draw (4,4.2) pic {measure top={0}};
    \draw [thick,middlearrow={Latex}{0.5}] (-1.1,0) to (4,0);
    \draw [thick,-Latex,shorten >=0.1cm] (4,0) to (4,4.2);
    \draw [thick,gray!70,dashed] (0,0) to (0,3) to (5,3);
    \node at (-1.5,0) {$\ket{0}$};
    \node at (2.5,-1.5) {two consecutive transmissions:};
    \node at (2.5,-2.5) {probability amplitude = $\frac{i}{\sqrt2}\frac{i}{\sqrt2}=-\frac12$};
  \end{scope}
  \begin{scope}[shift={(8,0)}]
    \draw (0,0) pic {beamsplitter};
    \draw (4,3) pic {beamsplitter};
    \draw (0,3) pic {mirror};
    \draw (4,0) pic {mirror};
    \draw (5.2,3) pic {measure left={1}};
    \draw (4,4.2) pic {measure top={0}};
    \draw [thick,middlearrow={Latex}{0.5}] (-1.1,0) to (0,0);
    \draw [thick,middlearrow={Latex}{0.5}] (0,0) to (0,3);
    \draw [thick,middlearrow={Latex}{0.5}] (0,3) to (4,3);
    \draw [thick,-Latex,shorten >=0.1cm] (4,3) to (4,4.2);
    \draw [thick,gray!70,dashed] (0,0) to (0,0) to (4,0) to (4,3) to (5,3);
    \node at (-1.5,0) {$\ket{0}$};
    \node at (2.5,-1.5) {two consecutive reflections:};
    \node at (2.5,-2.5) {probability amplitude = $\frac{1}{\sqrt2}\frac{1}{\sqrt2}=\frac12$};
  \end{scope}
\end{tikzpicture}
```

In experimental reality, when the optical paths between the two beam-splitters are the same, the photon fired from input port $\ket{0}$ _always_ strikes detector 1 and _never_ detector 0 (and the photon fired from input port $\ket{1}$ _always_ strikes detector 0 and _never_ detector 1).
Thus a beam-splitter acts as the square root of $\texttt{NOT}$ gate.

The action of the beam-splitter --- in fact, the action of any quantum device --- can be described by tabulating the amplitudes of transitions between its input and output ports.^[Note that gate $B$ is not the same square root of $\texttt{NOT}$ as the one described in the first diagram in this section. There are infinitely many ways of implementing this "impossible" logical operation.]
\begin{equation}
  B = 
  \begin{bmatrix}
  B_{00} & B_{01}\\
  B_{10} & B_{11}
  \end{bmatrix}
  =
  \begin{bmatrix}
  \frac{1}{\sqrt 2} & \frac{i}{\sqrt 2}\\
  \frac{i}{\sqrt 2} & \frac{1}{\sqrt 2}
  \end{bmatrix}.
(\#eq:beam-splitter)
\end{equation}
The matrix element $B_{lk}$, where $k,l=0,1$, represents the amplitude of transition from input  $\ket{k}$ to output  $\ket{l}$ (watch the order of indices).
Each reflection (entries $B_{01}$ and $B_{10}$) happens with amplitude $i/\sqrt{2}$ and each transmission  (entries $B_{00}$ and $B_{11}$) happens with amplitude $1/\sqrt{2}$.
Thus the total amplitude that a photon fired from input port $\ket{0}$ will reach detector $0$ is the sum of the amplitude of the two consecutive reflections ($i/\sqrt{2}\times i/{\sqrt 2} = -1/2$) and the amplitude of the two consecutive transmissions ($1/{\sqrt 2}\times 1/{\sqrt 2} = 1/2$) which gives the total amplitude $0$.
The resulting probability is then zero.
Unlike probabilities, amplitudes can cancel out each other out.
We can now go on and calculate the amplitude that the photon will reach detector $1$.
In this case we will get $i$, which gives probability $1$.
We can then switch to input $\ket{1}$ and repeat our calculations.
All possible paths and associated amplitudes are shown in \@ref(fig:paths-and-amplitudes-two-beam-splitters).

```{r paths-and-amplitudes-two-beam-splitters,engine='tikz',fig.align='center',fig.cap='All possible transitions and their amplitudes when we compose two beam-splitters $B$.'}
\tikzset{centrelabel/.style={pos=0.5,fill=white}}
\tikzset{dot/.style={fill,shape=circle,minimum size=5pt,inner sep=0pt}}
\newcommand{\ket}[1]{|#1\rangle}
\begin{tikzpicture}[xscale=3,yscale=2]
  \node [dot,label=left:{$\ket{0}$}] (i0) at (0,1) {};
  \node [dot,label=left:{$\ket{1}$}] (i1) at (0,0) {};
  \node [dot] (m0) at (1,1) {};
  \node [dot] (m1) at (1,0) {};
  \node [dot,label=right:{$\ket{0}$}] (o0) at (2,1) {};
  \node [dot,label=right:{$\ket{1}$}] (o1) at (2,0) {};
  \draw [thick] (i0) to node [centrelabel] {$\frac{1}{\sqrt2}$} (1,1);
  \draw [thick] (i0) to node [pos=0.25,fill=white] {$\frac{i}{\sqrt2}$} (1,0);
  \draw [thick] (i1) to node [pos=0.25,fill=white] {$\frac{i}{\sqrt2}$} (1,1);
  \draw [thick] (i1) to node [centrelabel] {$\frac{1}{\sqrt2}$} (1,0);
  \draw [thick] (m0) to node [centrelabel] {$\frac{1}{\sqrt2}$} (o0);
  \draw [thick] (m0) to node [pos=0.25,fill=white] {$\frac{i}{\sqrt2}$} (o1);
  \draw [thick] (m1) to node [pos=0.25,fill=white] {$\frac{i}{\sqrt2}$} (o0);
  \draw [thick] (m1) to node [centrelabel] {$\frac{1}{\sqrt2}$} (o1);
  %
  \node at (0.5,-0.45) {$B$};
  \node at (1.5,-0.45) {$B$};
\end{tikzpicture}
```

However, instead of going through all the paths in this diagram and linking specific inputs to specific outputs, we can simply multiply the transition matrices:
$$
  BB =
  \begin{bmatrix}
    \frac{1}{\sqrt 2} & \frac{i}{\sqrt 2}\\
    \frac{i}{\sqrt 2} & \frac{1}{\sqrt 2}
  \end{bmatrix}
  \begin{bmatrix}
    \frac{1}{\sqrt 2} & \frac{i}{\sqrt 2}\\
    \frac{i}{\sqrt 2} & \frac{1}{\sqrt 2}
  \end{bmatrix}
  =
  \begin{bmatrix}
  0 & i\\
  i & 0
  \end{bmatrix}
  = iX
$$
where $X=\begin{bmatrix}0&1\\1&0\end{bmatrix}$ is the $\texttt{NOT}$ operator.

Recalling [The square root of NOT], we see that beam-splitters give a physical way of constructing the square root of $\texttt{NOT}$.

::: {.idea data-latex=""}
  | $\texttt{NOT}$ | $\sqrt{\texttt{NOT}}$ |
  | :------------: | :-------------------: |
  | $X = \begin{bmatrix}0&1\\1&0\end{bmatrix}$ | $B = \frac{1}{\sqrt2}\begin{bmatrix}1&i\\i&1\end{bmatrix}$ |
  | bit flip | beam-splitter |
:::





## Appendix: Quantum interference revisited (still about beam-splitters)

One of the simplest quantum devices in which quantum interference can be controlled is a **Mach--Zehnder interferometer** --- see Figure \@ref(fig:mach-zehnder).

(ref:mach-zehnder-caption) The [Mach-Zehnder interferometer](https://en.wikipedia.org/wiki/Mach-Zehnder_interferometer), with the input photon represented by the coloured dot. This experimental set-up is named after the physicists Ludwig Mach and Ludwig Zehnder, who proposed it back in 1890s.

```{r mach-zehnder,engine='tikz',fig.align='center',fig.cap='(ref:mach-zehnder-caption)'}
\usetikzlibrary{arrows.meta}
\usetikzlibrary{decorations.markings}
\tikzset{smallblob/.style args={#1}{circle,draw,fill={#1},minimum size=6pt,inner sep=0pt,thin}}
\tikzset{beamsplitter/.pic={\draw [fill=gray!10] (-0.4,-0.4) -- (-0.4,0.4) -- (0.4,0.4);\draw [fill=gray!40] (-0.4,-0.4) -- (0.4,-0.4) -- (0.4,0.4);\draw (-0.4,-0.4) -- (0.4,0.4);}}
\tikzset{mirror/.pic={\draw [line width=2pt] (-0.3,-0.3) -- (0.3,0.3);}}
\tikzset{pics/measure left/.style args={#1}{code={\draw [fill=gray!15] (0,-0.5) arc (-90:90:0.5cm) -- cycle;\node [anchor=mid] at (0.22,0) {#1};}}}
\tikzset{pics/measure top/.style args={#1}{code={\draw [fill=gray!15] (0.5,0) arc (0:180:0.5cm) -- cycle;\node [anchor=mid] at (0,0.22) {#1};}}}
\tikzset{middlearrow/.style 2 args={decoration={markings,mark=at position #2 with {\arrow{#1}}},postaction=decorate}}
\tikzset{pics/phase shift/.style args={#1}{code={\draw [thick,fill=gray=40] (-0.1,-0.5) rectangle (0.1,0.5);\node [anchor=north] at (0,-0.5) {#1};}}}
\newcommand{\ket}[1]{|#1\rangle}
\definecolor{primary}{RGB}{177,98,78}
\begin{tikzpicture}
  \path (0,0) pic {beamsplitter};
  \path (4,3) pic {beamsplitter};
  \draw [thick,middlearrow={Latex}{0.6}] (0,-1.1) to (0,3) pic {mirror};
  \draw [thick,-Latex,shorten >=0.1cm] (0,3) to (5.1,3) pic {measure left={1}};
  \draw [thick,middlearrow={Latex}{0.5}] (-1.1,0) to (4,0) pic {mirror};
  \draw [thick,-Latex,shorten >=0.1cm] (4,0) to (4,4.1) pic {measure top={0}};
  \draw (2,0) pic {phase shift={$\varphi_0$}};
  \draw (2,3) pic {phase shift={$\varphi_1$}};
  \node [smallblob=primary] at (-1.4,0) {};
  \node at (-2.3,0) {Input $\ket{0}$};
  \node at (0,-1.5) {Input $\ket{1}$};
  \node [fill=white] at (0,2) {Beam 1};
  \node [fill=white] at (4,1) {Beam 0};
\end{tikzpicture}
```

It consists of two beam-splitters (the square boxes, bottom left and top right) and two slivers of glass of different thickness which are inserted into each of the optical paths connecting the two beam-splitters.
The slivers are usually referred to as "phase shifters" and their thicknesses, $\varphi_0$ and $\varphi_1$, are measured in units of the photon's wavelength multiplied by $2\pi$.
The two inputs ports of the interferometer are labelled as $\ket{0}$ and $\ket{1}$, and each of the two output ports, also labelled as $0$ and $1$, terminates in a photodetector.^[The two diagonal objects in the top-left and bottom-right corners of \@ref(fig:mach-zehnder) are simply mirrors to make the two possible paths meet at the second beam-splitter.]

A photon (the coloured dot in the figure) impinges on the first beam-splitter from one of the two input ports (here input 1) and begins its journey towards one of the two photodetectors.
Let^[We will often use $i$ as an index even though it is also used for the imaginary unit. Hopefully, no confusion will arise for it should be clear from the context which one is which.] $U_{ij}$ denote the probability amplitude that the photon initially in input port $j=0,1$ ends up in detector $i=0,1$.
At each of the two beam-splitters the photon is transmitted with the probability amplitude $\sqrt{T}$ and reflected with the probability amplitude $i\sqrt{R}$, with $R+T=1$, and the two phase shifters modify the amplitudes by phase factors $e^{i\varphi_0}$ and $e^{i\varphi_1}$, respectively.
In quantum theory we almost always start with the amplitudes, and once we have a full expression for the amplitude of a given outcome we square its absolute value to get the corresponding probability.
For example, let us calculate  $U_{00}$.

We notice that there are two alternative ways for the photon in the input port $0$ to end up in the output port $0$.
It can take the lower path, through the phase shifter $\varphi_0$, or the upper path, through the phase shifter $\varphi_1$.
The lower path implies two consecutive transmissions at the beam-splitters and the phase factor $e^{i\varphi_0}$, whereas the upper path implies two consecutive reflections and the phase factor $e^{i\varphi_1}$.
Once the photon ends in the output port $0$ there is no way of knowing which path was taken, thus we add the amplitudes pertaining to each path.
The resulting amplitude is
$$
  U_{00}
  = \sqrt{T} e^{i\varphi_0} \sqrt{T}
  + i\sqrt{R} e^{i\varphi_1} i \sqrt{R},
$$
and the corresponding probability $P_{00}=|U_{00}|^2$ reads
$$
  \begin{aligned}
    P_{00}
    & = \left\vert
          \sqrt{T}e^{i\varphi_0}\sqrt{T} + i\sqrt{R}e^{i\varphi_1}i\sqrt{R}
        \right\vert^2
      = \left\vert
          Te^{i\varphi_0} - Re^{i\varphi_1}
        \right\vert^2
  \\& = T^2 + R^2
        - 2TR\cos(\varphi_1-\varphi_0).
  \end{aligned}
$$

```{r,engine.opts=list(template="tikz2pdf.tex"),engine='tikz',fig.margin=TRUE,fig.width=4}
\definecolor{secondary}{RGB}{91,132,177}
\begin{tikzpicture}
  \begin{axis}[
    xmin=0,xmax=5,
    xlabel=relative phase,
    ylabel=$\Pr(\mbox{detector 0 clicks})$,
    ymin=0,ymax=1.1,
    axis lines=middle,
    xtick={0},
    xticklabels={$0$},
    ytick={0.16,0.58,1},
    yticklabels={$(T-R)^2$,$T^2+R^2$,1},very thick,
    xlabel style={font=\Large, anchor=north,at={(axis description cs:0.8,0)}},
    ylabel style={font=\Large, anchor=south,at={(axis description cs:0.15,1.05)}},
    yticklabel style={font=\Large}
  ]
    \addplot[domain=0:1.6*pi,samples=200,secondary,line width=2pt]{0.58-0.42*cos(deg(3*x))};
    \addplot[domain=0:1.6*pi,samples=200,gray,dashed]{0.16};
    \addplot[domain=0:1.6*pi,samples=200,gray,dashed]{1};
    \addplot[domain=0:1.6*pi,samples=200,gray,dashed]{0.58};
  \end{axis}
\end{tikzpicture}
```

The "classical" part of this expression, $T^2+R^2$, basically says that the photon undergoes either two consecutive transmissions with probability $T^2$, or two consecutive reflections with probability $R^2$.
The probability of being transmitted through any phase shifter is always $1$, hence the phase shifters play no role in the classical description of this process.
But the classical description is not correct, as the experiments show, whence the interference term $2TR\cos(\varphi_1-\varphi_0)$ in which the phase shifters play the essential role.
Depending on the _relative_ phase $\varphi=\varphi_1-\varphi_0$ the probability that the detector $0$ "clicks" can vary from $(T-R)^2$, for $\varphi=0$, to $1$, for $\varphi=\pi$.

If we do not care about the experimental details, we can represent the action of the Mach--Zehnder interferometer in terms of a diagram: see \@ref(fig:mach-zehnder-diagram).

```{r mach-zehnder-diagram,engine='tikz',fig.align='center',fig.cap='The Mach-Zehnder interferometer represented as an abstract diagram.'}
\definecolor{primary}{RGB}{177,98,78}
\definecolor{secondary}{RGB}{91,132,177}
\tikzset{dot/.style={fill,shape=circle,minimum size=5pt,inner sep=0pt}}
\newcommand{\ket}[1]{|#1\rangle}
\begin{tikzpicture}[xscale=1.8]
  \draw [ultra thick,dashed,primary] (0.6,2.5) rectangle (2.3,-0.5);
  \draw [ultra thick,dashed,secondary] (2.5,2.5) rectangle (3.4,-0.5);
  \draw [ultra thick,dashed,primary] (3.6,2.5) rectangle (5.3,-0.5);
  \node at (1.5,-1) {first beamsplitter};
  \node at (3,-1) {phase};
  \node at (4.5,-1) {second beamsplitter};
  \node [label=left:{$\ket{0}$}] (input1) at (0.2,2) {};
  \node [label=left:{$\ket{1}$}] (input2) at (0.2,0) {};
  \node [label=right:{$\ket{0}$}] (output1) at (5.7,2) {};
  \node [label=right:{$\ket{1}$}] (output2) at (5.7,0) {};
  \draw [thick] (input1) to node [pos=0.5,fill=white] {$e^{i\varphi_0}$} (output1);
  \draw [thick] (input2) to node [pos=0.5,fill=white] {$e^{i\varphi_1}$} (output2);
  \foreach \x in {1,2,4,5}
    \foreach \y in {0,2}
      \node [dot] (n\x\y) at (\x,\y) {};
  \draw [thick] (n12) to node [pos=0.25,fill=white] {\small$i\sqrt{R}$} (n20);
  \draw [thick] (n10) to node [pos=0.25,fill=white] {\small$i\sqrt{R}$} (n22);
  \draw [thick] (n42) to node [pos=0.25,fill=white] {\small$i\sqrt{R}$} (n50);
  \draw [thick] (n40) to node [pos=0.25,fill=white] {\small$i\sqrt{R}$} (n52);
  \node [fill=white] at (1.6,2) {\small$\sqrt{T}$};
  \node [fill=white] at (4.6,2) {\small$\sqrt{T}$};
  \node [fill=white] at (1.6,0) {\small$\sqrt{T}$};
  \node [fill=white] at (4.6,0) {\small$\sqrt{T}$};
\end{tikzpicture}
```

Here we can follow, from left to right, the multiple different paths that a photon can take in between specific input and output ports.
The amplitude along any given path is just the product of the amplitudes pertaining to the path segments (Rule 1), while the overall amplitude is the sum of the amplitudes for the many different paths (Rule 2). You can, for example, see that the probability amplitude $U_{10}$ is given by
$$
  U_{10}
  = \sqrt{T}e^{i\varphi_0}i\sqrt{R} + i\sqrt{R}e^{i\varphi_1}\sqrt{T}
$$
and the corresponding probability is
$$
  \begin{aligned}
    P_{10}
    & = \left\vert
        \sqrt{T}e^{i\varphi_0}i\sqrt{R} + i\sqrt{R}e^{i\varphi_1}\sqrt{T}
      \right\vert^2
  \\& = 2RT + 2RT\cos(\varphi_1-\varphi_0).
  \end{aligned}
$$
Again, the first term is of "classical" origin and represents probabilities corresponding to each path: one reflection followed by one transmission plus one transmission followed by one reflection, that is, $RT+TR=2RT$.
The second term is the interference term.
Clearly, the photon entering port $1$ will end up in one of the two detectors, hence,
$$
  P_{00} + P_{10}
  = R^2 + 2RT + T^2
  = (T+R)^2
  = 1.
$$
The action of the interferometer is thus fully described^[In general, any isolated quantum device, including a quantum computer, can be described by a matrix of probability amplitudes $U_{ij}$ that input $j$ generates output $i$. Watch the order of indices.] by the four probability amplitudes $U_{ij}$ ($i,j=0,1$).
The most popular instance of a Mach--Zehnder interferometer involves only symmetric beam-splitters $(R=T=\frac12)$ and is fully described by the matrix
$$
  U =
  \begin{bmatrix}
    -\sin\varphi/2 & \cos\varphi/2
  \\\cos\varphi/2 & \sin\varphi/2
  \end{bmatrix}
$$
where $\varphi=\varphi_1-\varphi_0$.
In fact, when you do all the calculations you obtain $ie^{i\frac{\varphi_0+\varphi_1}{2}}U$ rather than $U$, but the global phase factor $ie^{i\frac{\varphi_0+\varphi_1}{2}}$ is common to all the amplitudes in the matrix and as such it does not contribute to the resulting probabilities.^[Why is this? Hint: think about the eigenvalues of a matrix $A$ and of the matrix $\mu A$, where $\mu$ is a complex number with $|\mu|=1$.]
