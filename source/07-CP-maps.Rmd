# Quantum channels {#chapter7}

> Quantum evolution of any *isolated* system is unitary but its constituent parts may evolve in a more complicated way. In this chapter we will go beyond unitary evolutions and describe physically realisable transformations of density operators, called quantum channels. Be prepared for some name dropping; you will hear about Karl Kraus, Woody Stinespring, Andrzej Jamiołkowski and Man-Duen Choi. To be sure, knowing names will not give you more insights, but at least you will not be intimidated when you hear about the **Stinespring** and the **Kraus representations**, the **Jamiołkowski isomorphism**, or the **Choi matrix**.

We discussed how entanglement forced us to describe quantum states of open quantum systems (ones which are part of a larger system) in terms of density operators.
In this chapter we will describe how open systems evolve.
The question we are asking here is: what are the most general physically admissible transformations of density operators?
At the fundamental level --- and this should be your quantum mantra^[...there is only one unitary evolution, there is only one unitary evolution, there only one unitary evolution... ...and everything else is cheating] --- there is *only one* unitary evolution, and if there is any other evolution then it has to be derived from a unitary evolution.
From this perspective, any non-unitary evolution of an open system is induced by a unitary evolution of a larger system.
But how?
The short answer is: by adding (tensoring) and removing (partial trace) physical systems.
A typical combination of these operations is shown in the following diagram:

```{r,engine='tikz',engine.opts=list(template="tikz2pdf.tex"),fig.width=3}
\begin{quantikz}
  \lstick{fixed state $\ket{a}$}
  & \gate[wires=2]{U}
  & \rstick{discard} \qw
\\\lstick{input $\rho$}
  &
  & \rstick{$\rho'$ output } \qw
\end{quantikz}
```

First, we prepare our system of interest in an input state $\rho$.
Then we dilate the system by "adding" (or "taking into account") an auxiliary system^[Depending on the context, the auxiliary system is either called the **ancilla** (usually when we can control it) or the **environment** (usually when we cannot control it).] which is large enough to include everything our system will interact with, and also large enough to be in a pure state $\ket{a}$.
Mathematically, we do this by tensoring the input state $\rho$ with $\proj{a}$ to obtain $\proj{a}\otimes\rho$ (here we place the auxiliary system first and our system of interest second).
The dilated system is assumed to be closed so that it undergoes some unitary evolution $U$.
After all the interactions have taken place, we *trace out* the auxiliary system, turning the joint state $U\proj{a}\otimes\rho U^\dagger$ of the dilated system into the final state of our system of interest: the output state $\rho'$.
The net effect of this composition, as we shall see in a moment, is the input-output transformation which can be written, as long as the initial state of the auxiliary system in *not* correlated with the input state, in a nice compact way:
$$
  \rho\longmapsto\rho' = \sum_i E_i\rho E_i^\dagger
$$
where the $E_i$ are some operators that satisfy $\sum_i E_i^\dagger E_i=\id$.
This linear map is called a **completely positive trace-preserving map**, or, in the parlance of quantum information science, a **quantum channel**.
We will elaborate on the mathematics behind quantum channels shortly, but for now let us only check the essential properties, i.e. that this map preserves both trace and positivity (as its name suggests).

- Trace preserving: since the trace is linear, invariant under cyclic permutations of operators, and we ask that $\sum_i E_i^\dagger E_i=\id$, we see that
    $$
      \tr \left(\sum_k E_k\rho E_k^\dagger\right)
      = \tr \left(\sum_k E^\dagger_k E_k \rho\right)
      = \tr\rho.
    $$
- Positivity preserving: since $\rho$ is a positive^[Recall that an operator is positive if and only if it can be written in the form $XX^\dagger$ for some $X$ (here $X=E_k\sqrt{\rho}$). Also, the sum of positive operators is again a positive operator.] (semi-definite) operator, and so is $\sqrt{\rho}$, we see that
    $$
      \sum_k E_k\rho E_k^\dagger
      = \sum_k (E_k\sqrt{\rho})(\sqrt{\rho} E_k^\dagger).
    $$

These conditions are certainly *necessary* if we want to map density operators into legal density operators, but we shall see in a moment that they are not *sufficient*: quantum channels are not just positive maps, they are **completely** positive maps.
We will discuss their special properties, describe the most common examples, and, last but not least, specify when the action of quantum quantum channels can be reversed, or corrected, so that we can recover the original input state.
This will set the stage for our subsequent discussion of quantum error correction.


## Random unitaries

As a first step toward understanding the quantum description of an evolving open system, consider a "two-qubit universe" in which we observe *only one* of the qubits.
Let us revisit the controlled-$\texttt{NOT}$ gate, in which two qubits undergo the unitary transformation
$$
  U
  = \proj{0}\otimes\id +\proj{1}\otimes X
  = \diag{\id}{X}
$$
and let us focus on the transformation of the target qubit alone.
We know that it depends on the state of the control qubit:

- if the input state of the control qubit is $\ket{0}$, the target qubit evolves unitarily according to the identity operator $\id$;
- if the input state of the control qubit is $\ket{1}$, the target qubit evolves unitarily according to the bit flip operator $X$;
- but for input states of the control that are superpositions of $\ket{0}$ and $\ket{1}$ the evolution of the target qubit is *not* unitary.

To justify this last point, note that, if the control qubit is in the state $\alpha_0\ket{0}+\alpha_1\ket{1}$ and the target qubit is in some state $\ket{\psi}$, then the output state can be written as
$$
  \alpha_0\ket{0}\otimes\id\ket{\psi} + \alpha_1\ket{1}\otimes X\ket{\psi}
$$
which shows that the control and the target become entangled.
The target qubit alone ends up in the statistical mixture of states $\ket{\psi}$ (with probability $|\alpha_0|^2$) and $X\ket{\psi}$ (with probability $|\alpha_1|^2$).
This can be easily verified by expressing the above output state of the two qubits as the density matrix
$$
  \begin{aligned}
    |\alpha_0|^2\proj{0}\otimes \id\proj{\psi}\id
    \quad &+\quad |\alpha_1|^2\proj{1}\otimes X\proj{\psi}X
  \\+\, \alpha_0\alpha_1^\star\ket{0}\bra{1} \otimes \id\proj{\psi}X
    \quad &+\quad \alpha_0^\star\alpha_1\ket{1}\bra{0} \otimes X\proj{\psi}\id
  \end{aligned}
$$
and then tracing over the control qubit, which gives^[Recall that, for the basis states, $\tr\ket{i}\bra{j}=\braket{i}{j}=\delta_{ij}$.]
$$
  |\alpha_0|^2 \id\proj{\psi}\id
  + |\alpha_1|^2 X\proj{\psi} X.
$$
We can then say that the input state of the target qubit evolves either according to the identity operator (with probability $|\alpha_0|^2$) or according to the operator $X$ (with probability $|\alpha_1|^2$).

This argument works even if the target qubit is initially in a mixed state, since we are dealing with a linear transformation, and any mixed state can be expressed as a statistical ensemble of pure states (via the convex decomposition of a density matrix).
Thus, in general, we can express the evolution of the target qubit as^[We can also focus on the evolution of the control qubit: see the examples and exercises section **!!!TO-DO!!!**. In fact, we can choose any subset of qubits for our inputs and outputs. For example, our input could be the control qubit, and the output could be both the control and the target qubits.]

$$
  \rho\longmapsto
  \rho'= |\alpha_0|^2 \id\rho\id + |\alpha_1|^2 X\rho X
$$
where $\rho$ and $\rho'$ are the input and the output states, respectively.
We may think about this input-output relation as a mathematical representation of a quantum communication channel in which an input qubit is bit-flipped (via the operator $X$) with some prescribed probability.
But we may also take a more "global" view and see the action of the channel as arising from a unitary evolution on a larger (dilated) system, here composed of two qubits.

Our discussion can easily be extended beyond the qubits to cover any conditional dynamics of the type
$$
  U
  = \sum_i \proj{i}\otimes U_i
  =
  \begin{bmatrix}
    U_1 & 0 & 0 & \ldots
  \\0 & U_2 & 0 & \ldots
  \\0 & 0 & U_3 & \ldots
  \\\vdots & \vdots &\vdots & \ddots
  \end{bmatrix}
$$
where the vectors $\ket{i}$ form an orthonormal basis in the Hilbert space associated with a control system, and the $U_i$ are the corresponding unitary operations performed on a target system.
If the control system is prepared in state $\sum_i\alpha_i\ket{i}$ and the target in state $\ket{\psi}$, then the final state of the two systems is
$$
  \sum_i \alpha_i\ket{i}\otimes U_i\ket{\psi}
$$
and, by the same sequence of arguments as before, we obtain the evolution of the target system alone, and express it as
$$
  \rho\longmapsto
  \rho' = \sum_{i=1} p_i U_i \rho U^\dagger_i
$$
where $p_i=|\alpha_i|^2$.
That is, the state of the target system is modified by the unitary $U_i$, chosen randomly with probability $p_i$.

The reason we are paying a particular attention to the random unitaries is that each unitary is invertible, and, as such, they offer a sliver of hope for reversing the action of the channel.
If we can learn, post factum, which particular unitary operation $U_i$ was chosen then we can simply apply the inverse of that unitary and recover the original state.
For example, if we can measure the control system in the $\ket{i}$ basis, then measuring the outcome to be $k$ tells us that we have to apply $U_k^\dagger$ to the target to recover its input state.
However, if we do not have access to the control system, then there is very little we can do: *we cannot figure out which particular unitary was applied by inspecting the target system alone*.
In this case the best we can do is to apply the inverse of the most likely unitary, which will then recover the input state, *but only with some probability of success*.
In order to do better than that we have to look at slightly different channels.


### Example

A **single qubit Pauli channel** applies one of the Pauli operators, $X$, $Y$ or $Z$, chosen randomly with some prescribed probabilities $p_x$, $p_y$ and $p_z$, giving
$$
  \rho\longmapsto
  p_0 \id \rho\id + p_x X\rho X+ p_y Y\rho Y+  p_z Z\rho Z.
$$
The Pauli operators represent **quantum errors**: bit-flip $X$, phase-flip $Z$, and the composition of the two $Y=iXZ$.



## Random isometries

There is another invertible operation in quantum theory: an **isometry**, which is a combination of adding another quantum system and then applying a unitary transformation to the resulting composite system.
So let us take a quick look at a simple generalisation of random unitaries, namely random isometries $V_i$, which give
$$
  \rho\longmapsto
  \rho' = \sum_{i=1} p_i V_i \rho V^\dagger_i.
$$
An isometry $V$ is similar to a unitary operator except that it maps states in the Hilbert space $\mathcal{H}$ to states in a larger Hilbert space $\mathcal{H}'$ (cf. the supplementary material on isometries **!!!TO-DO!!!**).
Here $\mathcal{H}$ is associated with the input and $\mathcal{H}'=\mathcal{H}_\mathcal{A}\otimes\mathcal{H}$ with the dilated system (i.e. the ancilla $\mathcal{A}$ plus our system of interest).
Isometries satisfy $V^\dagger V=\id$, and they are usually implemented by adding an ancilla in a fixed state and then applying a unitary operation to the resulting composed system.
They can be then reversed by applying the inverse of that unitary and discarding the ancilla.

Now, if $\mathcal{H}'$ is sufficiently larger than $\mathcal{H}$, and if the images $\mathcal{H}'_i$ of $\mathcal{H}$ in $\mathcal{H}'$ under the different isometries $V_i$ do not overlap^[That is, if the subspaces $\mathcal{H}'_i$ are mutually orthogonal.], then we can reverse the action of the channel:
we can, at least in principle, perform a measurement on $\mathcal{H}'$, defined by the partition $\mathcal{H}'=\mathcal{H}'_1\oplus\mathcal{H}'_2\oplus\ldots$, and find out which subspace contains the output state;
once we know which subspace the input was sent to, we know which particular isometry $V_k$ was applied by the channel;
then we simply apply $V^\dagger_k$.

In order to see this consider the following simple, but important, example, which we will revisit several times in different disguises.


### Example

Alice constructs a quantum channel which is a mixture of four isometries.
The input is a single qubit, and the output is a dilated system composed of three qubits.
She prepares the input qubit in a state^[Our arguments here can be easily extended to any mixed state $\rho$, but for simplicity we consider the case of a pure state.] $\ket{\psi}$ and then combines it with the two ancillary qubits which are in a fixed state $\ket{0}\ket{0}$.
Then she applies one of the four, randomly chosen, unitary operations to the three qubits, to generate the following four isometries:
$$
  \begin{aligned}
    V_1 &= \ket{000}\bra{0} + \ket{111}\bra{1}
  \\V_2 &= \ket{001}\bra{0} + \ket{110}\bra{1}
  \\V_3 &= \ket{010}\bra{0} + \ket{101}\bra{1}
  \\V_4 &= \ket{100}\bra{0} + \ket{011}\bra{1}.
  \end{aligned}
$$

The three qubits, which form the output of the channel, are given to Bob, whose task is to recover the original state $\ket{\psi}$ of the input qubit.
In this scenario, Bob, who knows the four isometries, can find out which particular isometry was applied.
He knows that^[**!!!TO-DO!!! picture**]

- $V_1$ maps $\mathcal{H}$ to $\mathcal{H}'_1$, which is a subspace of $\mathcal{H}'$ spanned by $\ket{000}$ and $\ket{111}$;
- $V_2$ maps $\mathcal{H}$ to $\mathcal{H}'_2$, which is a subspace of $\mathcal{H}'$ spanned by $\ket{001}$ and $\ket{110}$;
- $V_3$ maps $\mathcal{H}$ to $\mathcal{H}'_3$, which is a subspace of $\mathcal{H}'$ spanned by $\ket{010}$ and $\ket{101}$;
- $V_4$ maps $\mathcal{H}$ to $\mathcal{H}'_4$, which is a subspace of $\mathcal{H}'$ spanned by $\ket{100}$ and $\ket{011}$.

Given that these subspaces are mutually orthogonal, and $\mathcal{H}'=\mathcal{H}'_1\oplus\mathcal{H}'_2\oplus\mathcal{H}'_3\oplus\mathcal{H}'_4$, Bob can perform a measurement defined by the projectors on these subspaces.
For example, if Alice randomly picked $V_2$, then the input state $\ket{\psi}=\alpha_0\ket{0}+\alpha_1\ket{1}$ will be mapped to the output state $\alpha_0\ket{001}+\alpha_1\ket{110}$ in the $\mathcal{H}'_2$ subspace.
Bob's measurement will then detect $\mathcal{H}'_2$ as the subspace where the output state resides, but the measurement (i.e. the corresponding projection) will not affect any state in that subspace.
Bob can now simply apply $V_2^\dagger$ and obtain $\ket{\psi}$.

Just in case you are curious (as you should be!), below is a diagram of how the four isometries are implemented.
How would you reverse these operations?

```{r,engine='tikz',engine.opts=list(template="tikz2pdf.tex"),fig.width=6}
\[
  V_1 =
  \begin{quantikz}[ampersand replacement=\&]
    \lstick{$\ket{\psi}$} \& \ctrl{1} \& \ctrl{2} \& \hphantomgate{X}\qw \& \qw
  \\\lstick{$\ket{0}$} \& \targ{} \& \qw \& \qw \& \qw
  \\\lstick{$\ket{0}$} \& \qw \& \targ{} \& \qw \& \qw
  \end{quantikz}
  \qquad\qquad
  V_2 =
  \begin{quantikz}[ampersand replacement=\&]
    \lstick{$\ket{\psi}$} \& \ctrl{1} \& \ctrl{2} \& \gate{X} \& \qw
  \\\lstick{$\ket{0}$} \& \targ{} \& \qw \& \qw \& \qw
  \\\lstick{$\ket{0}$} \& \qw \& \targ{} \& \qw \& \qw
  \end{quantikz}
\]
\[
  V_3 =
  \begin{quantikz}[ampersand replacement=\&]
    \lstick{$\ket{\psi}$} \& \ctrl{1} \& \ctrl{2} \& \qw \& \qw
  \\\lstick{$\ket{0}$} \& \targ{} \& \qw \& \gate{X} \& \qw
  \\\lstick{$\ket{0}$} \& \qw \& \targ{} \& \qw \& \qw
  \end{quantikz}
  \qquad\qquad
  V_4 =
  \begin{quantikz}[ampersand replacement=\&]
    \lstick{$\ket{\psi}$} \& \ctrl{1} \& \ctrl{2} \& \qw \& \qw
  \\\lstick{$\ket{0}$} \& \targ{} \& \qw \& \qw \& \qw
  \\\lstick{$\ket{0}$} \& \qw \& \targ{} \& \gate{X} \& \qw
  \end{quantikz}
\]
```

Single unitaries or isometries apart, it turns out that the only reversible, or **correctable** channels (i.e. channels in which the input state can be recovered) are exactly the mixtures of mutually orthogonal isometries $V^\dagger_i V_j=\delta_{ij}\id$.
We shall return to these channels later on.



## Evolution of open systems

Needless to say, there is more to evolutions of open systems than random isometries, and what follows is the most general scenario we will discuss.
Consider two interacting systems, $\mathcal{A}$ and $\mathcal{B}$, but this time we do *not* assume that their interacting dynamics admits a control-target interpretation.
We will view $\mathcal{A}$ as an auxiliary system, i.e. an ancilla, and focus on^[As a small notational remark, for now, when we write tensor products, we will place the ancilla first and the system of interest second: $\mathcal{H}_\mathcal{A}\otimes\mathcal{H}_\mathcal{B}$. This is for pedagogical purposes, simply because block matrices on tensor products are easier to interpret when written in this particular order. Later on we will revert to the more common convention in which the system of interest is placed first.] the evolution of system $\mathcal{B}$.

Let us pick an orthonormal basis $\ket{i}$ of the Hilbert space $\mathcal{H}_\mathcal{A}$ associated with the ancilla.
Any unitary transformation of the combined system $\mathcal{AB}$ can then be written as
$$
  U
  = \sum_{ij}\ket{i}\bra{j}\otimes B_{ij}
  =
  \begin{bmatrix}
    B_{11} & B_{12} & B_{13} & \ldots
  \\B_{21} & B_{22} & B_{23} & \ldots
  \\B_{31} & B_{32} & B_{33} & \ldots
  \\\vdots & \vdots & \vdots & \ddots
  \end{bmatrix}
$$
where the $B_{ij}$ are operators acting on the the Hilbert space $\mathcal{H}_\mathcal{B}$ associated with system $\mathcal{B}$.
Note that the $B_{ij}$ do *not* need to be unitary, but, for the overall transformation $U$ to be unitary^[$U^\dagger U = UU^\dagger = \id_{AB}$.], they must satisfy
**!!!to-do: fix label!!!**
$$
\begin{equation}
  \begin{split}
    \sum_i B_{ik}^\dagger B_{il}
    &= \delta_{kl} \id_\mathcal{AB}
  \\\sum_i B_{ki}B_{li}^\dagger
    &= \delta_{kl} \id_\mathcal{B}
  \end{split}
(\#eq:subconditions)
\end{equation}
$$
where $\id_\mathcal{AB}$ and $\id_\mathcal{B}$ are the identity operators on $\mathcal{H}_\mathcal{A}\otimes\mathcal{H}_\mathcal{B}$ and $\mathcal{H}_\mathcal{B}$, respectively.
These two conditions correspond to the requirement that both column and row vectors must be orthonormal for a matrix to be unitary , except that here $U$ is a block matrix, and the entries $B_{ij}$ are complex matrices rather than complex numbers, so some care must be taken with the order of multiplication.
Again, the evolution of the system $\mathcal{B}$ depends on both $U$ *and* on the initial state of the auxiliary system $\mathcal{A}$.

Without any loss of generality, we may assume that system $\mathcal{A}$ is in a pure state^[If $\mathcal{A}$ were initially in a mixed state, we could always regard $\mathcal{A}$ as a subsystem of some larger $\widetilde{\mathcal{A}}$ that is in an entangled pure state.] which can be chosen to be one of the basis states $\ket{i}$, say $\ket{k}$.
In this case, $U$ acts by
**!!!to-do: fix label!!!**
$$
\begin{equation}
  U\colon \ket{k}\otimes\ket{\psi} \longmapsto
  \sum_i \ket{i}\otimes B_{ik}\ket{\psi}
(\#eq:unitary-rep)
\end{equation}
$$
for an arbitrary state $\ket{\psi}$ of $\mathcal{B}$.

The resulting density operator for $\mathcal{B}$ is found by taking the density operator of the output state of $\mathcal{AB}$, which is
$$
  \sum_{ij} \ket{i}\bra{j}\otimes B_{ik}\proj{\psi}B_{jk}^\dagger
$$
and then tracing out $\mathcal{A}$, obtaining
$$
  \begin{aligned}
    \tr_\mathcal{A} \left(
      \sum_{ij} \ket{i}\bra{j}\otimes B_{ik}\proj{\psi}B_{jk}^\dagger
    \right)
    &= \sum_{ij} \braket{i}{j}\cdot B_{ik}\proj{\psi}B_{jk}^\dagger
  \\&= \sum_i B_{ik}\proj{\psi}B_{ik}^\dagger
  \end{aligned}
$$
where we have used the fact that $\braket{i}{j}=\delta_{ij}$.
In general, for any input state $\rho$, we obtain the map
$$
  \rho\longmapsto
  \rho'= \sum_i B_{ik}\rho B^\dagger_{ik} \equiv \sum_i B_{i}\rho B^\dagger_{i}
$$
where, in the last expression on the right-hand size, we have dropped index $k$ (remember, it was there only to remind us about the initial state of the ancilla).
Since the overall transformation $U$ is unitary, recall that the $B_i$ satisfy $\sum_i B_i^\dagger B_i=\id$.
This normalisation conditions guarantees that the trace is preserved.

::: {.idea latex=""}
In summary, we can think about a quantum evolution of subsystem $\mathcal{B}$ as a sequence of the three distinct operations:
$$
  \begin{aligned}
    \rho
    \longmapsto &\underbrace{\proj{k}\otimes\rho}_{\text{add ancilla}}
  \\\longmapsto &\underbrace{U(\proj{k}\otimes\rho) U^\dagger}_{\text{unitary evolution}}
  \\\longmapsto &\underbrace{\tr_\mathcal{A} \left[U(\proj{k}\otimes\rho) U^\dagger\right]}_{\text{discard ancilla}}
    = \sum_i B_{i}\rho B_{i}^\dagger
    =\rho'.
  \end{aligned}
$$
:::

In summary:

- First we pick up a system of interest which, in general, can be in a mixed state $\rho$. It may be the case that this system is entangled with some other degrees of freedom or with some other physical systems, but these other entities will remain passive and will not enter any subsequent dynamics.
- Then we dilate the system: we add an ancilla which is large enough to include everything our system will interact with, and also large enough to be in a pure state. The expansion ends when the composed system is (for all practical purposes) isolated and follows a unitary evolution $U$.
- After the unitary evolution takes place, we discard the ancilla and focus on the system alone. In fact we do not have to discard exactly what we added: we can discard only part of the ancilla, or any other part of the dilated system.
- The output system in this scenario does not have to be the original input system, but usually it is.

```{r,engine='tikz',engine.opts=list(template="tikz2pdf.tex"),fig.width=2}
\begin{quantikz}
  & \lstick{$\ket{k}$} & \gate[wires=2]{U} & \rstick{discard} \qw
\\& \lstick{$\rho$} & \qw & \hphantom{}\qw & \qw\rstick{$\rho'$}
\\\lstick{} \ar[dr,dash,thickness] \ar[ur,dash,thickness]
\\\lstick{} & & \qw &\qw &\qw
\end{quantikz}
```

It is adding (i.e. tensoring) the auxiliary system in a fixed state, and then discarding it (via the partial trace), that is responsible for the *non-unitary* character of this evolution.



## Stinespring's dilation and Kraus's ambiguity

Once we start playing with adding physical systems and increasing the dimension of the underlying Hilbert space, it is convenient to switch from unitaries to isometries.
This is more for mathematical simplicity than physical insight, but it is always good to declutter our equations a bit if we can.
Note that when we fix the initial state of system $\mathcal{A}$ to be $\ket{k}$, we can use Equation \@ref(eq:unitary-rep) **!!!to-do: fix ref!!!** to define an isometry $V$ from $\mathcal{H}_\mathcal{B}$ to $\mathcal{H}_\mathcal{A}\otimes \mathcal{H}_\mathcal{B}$, by

**!!!to-do: fix label!!!**
$$
\begin{equation}
  V\colon \ket{\psi}
  \longmapsto \sum_i\ket{i}\otimes E_i\ket{\psi}
(\#eq:isometry-definition)
\end{equation}
$$

where $E_i\equiv B_{ik}$ and, according to Equation \@ref(eq:subconditions) **!!!to-do: fix ref!!!**, $\sum_i E_i^\dagger E_i=\id$ (here the identity operator acts on $\mathcal{H}_\mathcal{B}$).^[Recall that a map $V$ is an isometry if $V^\dagger V=\id$. For example, adding a system in state $\ket{k}$ gives an isometry $V\colon\ket{\psi}\mapsto\ket{k}\otimes\ket{\psi}$, and the combination of adding a system in a fixed state followed by a unitary evolution of the combined system is also an isometry. Isometries preserve inner products, and therefore also preserve both the norm and the metric based upon the norm.]
The matrix representation of an isometry is a rectangular matrix given by selecting only a few of the columns from a unitary matrix;
here, with $\ket{k}$ fixed, it is only the $k$-th column of the block matrix $U$ that determines the evolution of $\mathcal{B}$, as shown in Figure \@ref(fig:unitary-isometry).

(ref:unitary-isometry-caption) For $k=2$, the second block column is selected. The matrix representation of the isometry $V$ on the right-hand side look like a column vector, but remember that the entries $E_i$ are *matrices*.

```{r unitary-isometry,engine='tikz',engine.opts=list(template="tikz2pdf.tex"),fig.width=7,fig.cap='(ref:unitary-isometry-caption)'}
\definecolor{primary}{RGB}{177,98,78}
\definecolor{secondary}{RGB}{91,132,177}
\begin{equation*}
U=
\left[\,
  \setlength\arraycolsep{0.4em}
  \begin{array}{cccc}
    B_{11} & \cellcolor{primary!20}B_{12} & B_{13} & \ldots
  \\B_{21} & \cellcolor{primary!20}B_{22} & B_{23} & \ldots
  \\B_{31} & \cellcolor{primary!20}B_{32} & B_{33} & \ldots
  \\\vdots & \cellcolor{primary!20}\vdots & \vdots & \ddots
  \end{array}
\right]
\longmapsto
V= \left[\,
  \setlength\arraycolsep{0.4em}
  \begin{array}{c}
    \cellcolor{primary!20}E_{1}
  \\\cellcolor{primary!20}E_{2}
  \\\cellcolor{primary!20}E_{3}
  \\ \cellcolor{primary!20}\vdots
  \end{array}
\right]
\end{equation*}
```

Let us now rephrase our derivation of the evolution of system $\mathcal{B}$ using isometries.
Note that the isometry $V$ in Figure \@ref(fig:unitary-isometry) acts by
$$
  \proj{\psi}
  \longmapsto
  V\proj{\psi}V^\dagger
  = \sum_{ij} \ket{i}\bra{j} \otimes E_i\proj{\psi} E_j^\dagger.
$$$
We trace out $\mathcal{A}$, recall that $\tr\ket{i}\bra{j} = \braket{i}{j}=\delta_{ij}$, and express the evolution of system $\mathcal{B}$ as
$$
  \rho
  \longmapsto
  \rho' = \tr_\mathcal{A} V\rho V^\dagger =\sum_i E_i\rho E_i^\dagger,
$$
where $\sum_iE_i^\dagger E_i=\id$, and we allowed the input states $\rho$ of $\mathcal{B}$ to be mixed (since they can always be expressed as statistical mixtures of pure states $\ket{\psi}$).
This expression shows two different ways of looking at quantum evolutions, and both even have names associated with them.

::: {.idea latex=""}
- **Stinespring**^[[William Forrest "Woody" Stinespring](https://en.wikipedia.org/wiki/W.%5FForrest%5FStinespring) (1929--2012) was an American mathematician specialising in operator theory.] **dilation.**
    Any quantum channel $\mathcal{E}$ can be thought of as arising from a *unitary* evolution on a *dilated* system.
    When we combine tensoring and the unitary evolution into an isometry $V$, we can express the action of the channel $\mathcal{E}$ as
    $$
      \rho \longmapsto \rho'= \tr_\mathcal{A} V\rho V^\dagger,
    $$
    where we trace out a suitably chosen ancilla $\mathcal{A}$.
    In quantum information science we often refer to this approach as *"the Church of the Larger Hilbert Space"*.
<!--  -->

- **Kraus**^[[Karl Kraus](https://en.wikipedia.org/wiki/Karl%5FKraus%5F(physicist)) (1938--1988) was a German physicist known for his contributions to the mathematical foundations of quantum theory. His book *States, effects, and operations* (Lecture Notes in Physics, Vol. **190**, Springer-Verlag, Berlin 1983) is an early account of the notion of complete positivity in physics.] **representation** (a.k.a. **operator-sum decomposition**).
    It is often more convenient to not deal with a larger Hilbert space, but to instead work with operators between the input and output Hilbert spaces
    $$
      \rho \longmapsto \rho'= \sum_i E_i\rho E_i^\dagger.
    $$
    Here we avoid dragging in the ancilla, which can be a good thing, since ancillas typically represent environments that can be very large and complex.
    This operator–sum decomposition is not unique, since the operators $E_i$ (known as the **Kraus operators** or **effects**) depend on the choice of basis in the ancilla.
    The Kraus operators must satisfy the normalisation condition $\sum_i E^\dagger_iE_i=\id$, also known as the **completeness relation**.
:::

We can easily switch between these two equivalent representations:

- We have already seen how to go from a unitary evolution $U$ on a larger system, to an isometry $V$, and then to a map on density operators represented by a set of Kraus operators $E_i$ (as in Figure \@ref(fig:unitary-isometry)).
- Conversely, once we have an operator-sum representation of the channel with a set of Kraus operators $E_i$, we can introduce an ancilla of dimension equal to the number of Kraus operators, and use the orthonormal basis $\ket{i}$ to form the isometry $V=\sum_i\ket{i}\otimes E_i$.
    In terms of matrices, this corresponds to simply "stacking up" the matrices $E_i$ to form the block column (as shown in Figure \@ref(fig:unitary-isometry)), which gives us the matrix representation of $V$.
    If we want to go further, from an isometry $V$ to a unitary $U$, then the next step is somewhat arbitrary: we can choose all the remaining block columns of $U$ however we please, *as long as* we end up with a unitary matrix $U$.

In summary:

::: {.idea latex=""}
All linear transformations of density operators that can be written in the Stinespring (or, equivalently, Kraus) form represent *physically realisable operations*, and we call them **quantum channels**.^[Quantum channels are also known as **superoperators** --- this way physicists remind themselves that these transformations take operators to operators.]
:::

We note again that the Kraus decomposition is *not unique*: the operators $V_i$ in Equation \@ref(eq:isometry-definition) depend on the choice of the ancilla basis.
Indeed, let $\ket{e_i}$ and $\ket{f_j}$ be two orthonormal bases in the Hilbert space associated with the ancilla.
Then $V$ can be expressed as
$$
  \begin{aligned}
    V
    &= \sum_i\ket{e_i}\otimes E_i
  \\&= \sum _{ij} \ket{f_j}\braket{f_j}{e_i}\otimes E_i
  \\&= \sum_{j} \ket{f_j} \otimes \sum_i \underbrace{\braket{f_j}{e_i}}_{R_{ji}} E_i
  \\&= \sum_{j} \ket{f_j} \otimes F_j
  \end{aligned}
$$
where we have used the fact that $\sum_j \proj{f_j}=\id$, and where $R_{ji}=\braket{f_j}{e_i}$ is a unitary matrix connecting the two orthonormal bases (and also the two sets of the Kraus operators) via $F_j=\sum_i R_{ji} E_i$.
So we have a set of Kraus operators $E_i$ associated with basis $\ket{e_i}$ and another, unitarily related, set of Kraus operators associated with basis $\ket{f_j}$, and the two sets describe the same isometry, and hence the same quantum channel.
This correspondence goes both ways: if two channels $\mathcal{E}$ and $\mathcal{F}$ have their Kraus operators related by some unitary $R_{ji}$, then the two channels are identical:
$$
  \begin{aligned}
    \mathcal{F}(\rho)
    &= \sum_j F_j\rho F^\dagger_j
  \\&= \sum_{ijk} R_{ji}E_i \rho E^\dagger_k R^\star_{jk}
  \\&=\sum_{ik} \underbrace{\left(\sum_j R_{jk}^\star R_{ji}\right)}_{\delta_{ki}} E_i\rho E^\dagger_k
  \\&= \sum_i E_i\rho E^\dagger_i
  \\&= \mathcal{E}(\rho).
  \end{aligned}
$$

In summary:

::: {.idea latex=""}
Suppose $E_1,\ldots,E_n$ and $F_1,\ldots,F_m$ are Kraus operators associated with quantum channels $\mathcal{E}$ and $\mathcal{F}$, respectively.
We can append zero operators to the shorter list^[If you wish, instead of appending zeros, you may view $R_{ji}$ as an isometry from the the smaller to the larger set of Kraus operators.] to ensure that $n=m$.
Then *$\mathcal{E}$ and $\mathcal{F}$ describe the same channel if and only if $F_j=\sum_i R_{ji} E_i$ for some unitary $R$*.
:::

In particular, this unitary equivalence of the Kraus operators implies that the identity channel $\rho\mapsto\rho'=\id\rho\id$ can only have Kraus operators that are proportional to the identity.


## Single qubit channels

The best way to familiarise ourselves with the concept of a quantum channel is to study a few examples, and we will start with the simplest case: **single qubit channels**.
The single qubit case is special since we can visualise the action of the channel by looking at the corresponding deformation of the Bloch sphere.
Recall that an arbitrary density matrix for a single qubit can be written in the form
$$
  \begin{aligned}
    \rho
    &= \frac{1}{2}\left(\id +\vec{s}\cdot \vec\sigma\right)
  \\&= \frac{1}{2}\left(\id  +s_x X+ s_y Y + s_z Z\right)
  \end{aligned}
$$
where $\vec{s}$ is the Bloch vector of the qubit with components $(s_x, s_y, s_z)$, and $X$, $Y$, and $Z$ are the Pauli operators.
Recall that unitary operations rotate the Bloch sphere.
In particular the $X$, $Y$, and $Z$ --- viewed as unitary transformations --- rotate the Bloch sphere by $180^\circ$ around the $x$, $y$, and $z$ axes, respectively.
General quantum channels, however, may deform it further, into spheroids with a displaced centre, as the following examples show.

- *A bit-flip with probability $p$:*
    $$
      \rho \longmapsto (1-p)\rho+pX\rho X.
    $$
    The Kraus operators are $\sqrt{1-p}\id$ and $\sqrt{p}X$;
    the original Bloch sphere shrinks into a prolate spheroid aligned with the $x$-axis;
    for the specific case of $p=\frac{1}{2}$, the Bloch sphere degenerates to the $[-1,1]$ interval on the $x$-axis.

- *A phase-flip with probability $p$:*
    $$
      \rho \longmapsto (1-p)\rho+pZ\rho Z.
    $$
    The Kraus operators are $\sqrt{1-p}\id$ and $\sqrt{p}Z$;
    the original Bloch sphere shrinks into a prolate spheroid aligned with the $z$-axis;
    for the specific case of $p=\frac{1}{2}$, the Bloch sphere degenerates to the $[-1,1]$ interval on the $z$-axis.

- *The depolarising channel:*
    $$
      \rho\longmapsto (1-p)\rho + \frac{p}{3}\left(X\rho X+Y\rho Y+Z\rho Z\right).
    $$
    Here the qubit remains intact with probability $1-p$, while a quantum error occurs with probability $p$.
    The error can be of any one of three types: bit-flip $X$, phase-flip $Z$, or and both bit- and phase-flip $Y$; each type of error is equally likely.
    For $p<\frac{3}{4}$, the original Bloch sphere contracts uniformly under the action of the channel, and the Bloch vector shrinks by the factor $1-\frac{4}{3}p$;
    for the specific case of $p=\frac{3}{4}$, the Bloch sphere degenerates to the point at the centre of the sphere;
    for $p>\frac{3}{4}$, the Bloch sphere is flipped, and the Bloch vector starts pointing in the opposite direction increasing the magnitude up to $\frac{1}{3}$ (which occurs for $p=1$).

There are two interesting points that must be mentioned here.
The first one is about the interpretation of the action of the channel in terms of Kraus operators: our narrative may change when we switch to a different set of effects.
For example, take the phase-flip channel with $p=\frac{1}{2}$ and switch from the effects
$$
  \begin{aligned}
    E_1 &= \frac{1}{\sqrt{2}}\id
  \\E_2 &= \frac{1}{\sqrt{2}}Z
  \end{aligned}
$$
to
$$
  \begin{aligned}
    F_1 &= \frac{1}{\sqrt{2}}(E_1+E_2)=\proj{0}
  \\F_2 &= \frac{1}{\sqrt{2}}(E_1-E_2)=\proj{1}.
  \end{aligned}
$$
These two sets of Kraus operators $\{E_1,E_2\}$ and $\{F_1,F_2\}$ describe the same channel, but the *narrative* is different.
The first set of effects tells us that the channel chooses randomly, with the same probability, between the two options: let the qubit pass undisturbed or apply the phase-flip $Z$;
the second set tells us that channel essentially performs the measurement in the standard basis, but the outcome of the measurement is not revealed.
In general:

::: {.idea latex=""}
Describing actions of quantum channels purely in terms of their effects (i.e. Kraus operators) can be ambiguous.
:::

The second interesting point is that not *all* transformations of the Bloch sphere into spheroids are possible.
For example, we cannot deform the Bloch sphere into a pancake-like oblate spheroid.
This is due to *complete* positivity (instead of mere positivity) of quantum channels, which we will explain shortly.


## Composition of quantum channels

We mentioned that quantum channels are combinations of

1. adding a physical system in a fixed state (via tensoring),
2. discarding a physical system (taking a partial trace),
3. and unitary transformations.

For consistency let us note that each of these operations admits an operator sum decomposition. This is obvious for unitary evolution ($\rho\mapsto U\rho U^\dagger$), but perhaps less so for the other two operations.

- **Adding a system.**
    Any quantum system can be expanded by bringing in an auxiliary system in a fixed state $\ket{a}$.
    This transformation takes vectors in the Hilbert space associated with the original system and tensors them with a fixed vector $\ket{a}$ in the Hilbert space associated with the auxiliary system:
    $$
      \ket{\psi}
      \longmapsto \ket{a}\otimes\ket{\psi}
      = (\ket{a}\otimes\id) \ket{\psi}.
    $$
    In terms of density operators, we write this "expansion" transformation as
    $$
      \begin{aligned}
        \rho
        \longmapsto \rho'
        &= \proj{a}\otimes\rho
      \\&= (\ket{a}\otimes\id)\rho (\bra{a}\otimes\id)
      \\&= V\rho V^\dagger
      \end{aligned}
    $$
    where $V=\id\otimes\ket{a}$.
    We note that $V^\dagger V = \id\otimes\braket{a|a} =\id$ is the identity in the Hilbert space associated with the system, and so $V$ is an isometry.
    Indeed, this transformation is an *isometric embedding*.

- **Discarding a system.**
    Conversely, given a composite system in state $\rho$, we can discard one of its subsystems.
    The partial trace over an auxiliary system can be written in the Kraus representation as
    $$
      \begin{aligned}
        \rho
        \longmapsto \rho'
        &= \tr_\mathcal{A}\rho
      \\&= (\tr\otimes\id)\rho
      \\&= \sum_i (\bra{i}\otimes\id)\rho(\ket{i}\otimes\id)
      \\&= \sum_i E_i\rho E^\dagger_i
      \end{aligned}
    $$
    where the vectors $\ket{i}$ form an orthonormal basis in the Hilbert space associated with the auxiliary system.
    Again, we can check that the Kraus operators $E_i=\bra{i}\otimes\id$ satisfy the completeness relation $\sum_i E^\dagger_i E_i =\id\otimes\id$ (using the fact that $\sum_i\proj{i}=\id$).

Any *sequential* composition of two quantum channels $\mathcal{E}$ and $\mathcal{F}$ with Kraus operators $\{A_i\}_{i\in I}$ and $\{B_j\}_{j\in J}$ (respectively) is another quantum channel^[Here we have tacitly assumed that the dimensions agree, i.e. that the output of $\mathcal{E}$ and the input of $\mathcal{F}$ are of the same dimension, so that the composition makes sense.] described by the Kraus operators $\{B_jA_i\}_{i\in I,j\in J}$.
Showing this is rather straightforward, at least in the operator sum representation: let 
$$
  \begin{aligned}
    \mathcal{E} &= \sum_i A_i\cdot A^\dagger_i
  \\\mathcal{F} &= \sum_j B_j\cdot B^\dagger_j
  \end{aligned}
$$
where $\sum_i A^\dagger_i A_i=\sum_j B^\dagger_j B_j=\id$;
then the sequential composition of $\mathcal{E}$ followed by $\mathcal{F}$ can be written as 
$$
  \mathcal{F} \circ\mathcal{E}
  = \sum_{ij} (B_jA_i) \cdot (B_jA_i)^\dagger
$$
so that the $B_jA_i$ are the Kraus operators associated with the new channel $\mathcal{F}\circ\mathcal{E}$, where the normalisation condition (or completeness relation) follows from
$$
  \begin{aligned}
    \sum_{ij} (B_jA_i)^\dagger (B_jA_i)
    &= \sum_i A_i^\dagger\left(\sum_j B_j^\dagger B_j\right)A_i 
  \\&= \sum_i A_i^\dagger A_i
  \\&= \id.
  \end{aligned}
$$

You might wonder why we explicitly called the above composition "sequential" --- isn't this how we always compose functions?
In actual fact, since we have access to tensor products, there is another sort of composition, namely **parallel** composition: if we have systems $\mathcal{A}$ and $\mathcal{B}$ with channels $\mathcal{E}_\mathcal{A}$ acting on $\mathcal{A}$ and $\mathcal{E}_\mathcal{B}$ acting on $\mathcal{B}$, then the parallel composition is denoted by $\mathcal{E}_\mathcal{A}\otimes\mathcal{E}_\mathcal{B}$, acting on the joint system $\mathcal{A}\otimes\mathcal{B}$, and with Kraus operators given by the $A_i\otimes B_j$.
The normalisation condition again follows from a simple calculation:
$$
  \begin{aligned}
    \sum_{ij} (A_i\otimes B_j)^\dagger (A_i\otimes B_j)
    &= \sum_{ij} A_i^\dagger A_i \otimes B_j^\dagger B_j 
  \\&= \id_A\otimes\id_B.
  \end{aligned}
$$

Now that we know how to compose quantum channels in terms of Kraus operators, we can see that the Stinespring representation is perfectly consistent with the Kraus representation: the three basic operations that we are allowed to use to build channels in the Stinespring representation (i.e. adding a system, unitary evolution, and discarding a system) are all themselves quantum channels, in that they admit a Kraus decomposition.

Before moving on, we make a small (but important) remark:

::: {.idea latex=""}
When we compose quantum channels, each channel needs its own independent ancilla;
*do not share ancillas between different channels*.
:::

For example, say we have three channels, $\mathcal{E}_1$, $\mathcal{E}_2$, and $\mathcal{E}_3$, with $\mathcal{E}_i$ defined by the unitary $U_i$ and the state $\ket{a_i}$ of its ancilla.
Then the (sequential) composition $\mathcal{E}_3\circ\mathcal{E}_2\circ\mathcal{E}_1$ is given by

```{r,engine='tikz',engine.opts=list(template="tikz2pdf.tex"),fig.width=4}
\begin{quantikz}
  \lstick{$\ket{a_1}$}
  & \gate[2]{U_1}
  & \qw
  & & & \lstick{$\ket{a_2}$}
  & \gate[2]{U_2}
  & \qw
  & & & \lstick{$\ket{a_3}$}
  & \gate[2]{U_3}
  &\qw
\\\lstick{$\rho$}
  & &\qw
  & \qw \rstick{$\rho'_1$}
  & & \qw
  & & \qw
  & \qw \rstick{$\rho'_2$}
  & & \qw
  & & \rstick{$\rho'_3$} \qw
\end{quantikz}
```

For more on this, see the **!!TO-DO: supplementary material on the Markov approximation.!!**


## Completely positive trace-preserving maps
