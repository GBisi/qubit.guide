# Quantum channels {#chapter7}

> Quantum evolution of any *isolated* system is unitary but its constituent parts may evolve in a more complicated way. In this chapter we will go beyond unitary evolutions and describe physically realisable transformations of density operators, called quantum channels. Be prepared for some name dropping; you will hear about Karl Kraus, Woody Stinespring, Andrzej Jamiołkowski and Man-Duen Choi. To be sure, knowing names will not give you more insights, but at least you will not be intimidated when you hear about the **Stinespring** and the **Kraus representations**, the **Jamiołkowski isomorphism**, or the **Choi matrix**.

We discussed how entanglement forced us to describe quantum states of open quantum systems (ones which are part of a larger system) in terms of density operators.
In this chapter we will describe how open systems evolve.
The question we are asking here is: what are the most general physically admissible transformations of density operators?
At the fundamental level --- and this should be your quantum mantra^[...there is only one unitary evolution, there is only one unitary evolution, there only one unitary evolution... ...and everything else is cheating] --- there is *only one* unitary evolution, and if there is any other evolution then it has to be derived from a unitary evolution.
From this perspective, any non-unitary evolution of an open system is induced by a unitary evolution of a larger system.
But how?
The short answer is: by adding (tensoring) and removing (partial trace) physical systems.
A typical combination of these operations is shown in the following diagram:

```{r,engine='tikz',engine.opts=list(template="tikz2pdf.tex"),fig.width=3}
\begin{quantikz}
  \lstick{fixed state $\ket{a}$}
  & \gate[wires=2]{U}
  & \rstick{discard} \qw
\\\lstick{input $\rho$}
  &
  & \rstick{$\rho'$ output } \qw
\end{quantikz}
```

First, we prepare our system of interest in an input state $\rho$.
Then we dilate the system by "adding" (or "taking into account") an auxiliary system^[Depending on the context, the auxiliary system is either called the **ancilla** (usually when we can control it) or the **environment** (usually when we cannot control it).] which is large enough to include everything our system will interact with, and also large enough to be in a pure state $\ket{a}$.
Mathematically, we do this by tensoring the input state $\rho$ with $\proj{a}$ to obtain $\proj{a}\otimes\rho$ (here we place the auxiliary system first and our system of interest second).
The dilated system is assumed to be closed so that it undergoes some unitary evolution $U$.
After all the interactions have taken place, we *trace out* the auxiliary system, turning the joint state $U\proj{a}\otimes\rho U^\dagger$ of the dilated system into the final state of our system of interest: the output state $\rho'$.
The net effect of this composition, as we shall see in a moment, is the input-output transformation which can be written, as long as the initial state of the auxiliary system in *not* correlated with the input state, in a nice compact way:
$$
  \rho\longmapsto\rho' = \sum_i E_i\rho E_i^\dagger
$$
where the $E_i$ are some operators that satisfy $\sum_i E_i^\dagger E_i=\id$.
This linear map is called a **completely positive trace-preserving map**, or, in the parlance of quantum information science, a **quantum channel**.
We will elaborate on the mathematics behind quantum channels shortly, but for now let us only check the essential properties, i.e. that this map preserves both trace and positivity (as its name suggests).

- Trace preserving: since the trace is linear, invariant under cyclic permutations of operators, and we ask that $\sum_i E_i^\dagger E_i=\id$, we see that
    $$
      \tr \left(\sum_k E_k\rho E_k^\dagger\right)
      = \tr \left(\sum_k E^\dagger_k E_k \rho\right)
      = \tr\rho.
    $$
- Positivity preserving: since $\rho$ is a positive^[Recall that an operator is positive if and only if it can be written in the form $XX^\dagger$ for some $X$ (here $X=E_k\sqrt{\rho}$). Also, the sum of positive operators is again a positive operator.] (semi-definite) operator, and so is $\sqrt{\rho}$, we see that
    $$
      \sum_k E_k\rho E_k^\dagger
      = \sum_k (E_k\sqrt{\rho})(\sqrt{\rho} E_k^\dagger).
    $$

These conditions are certainly *necessary* if we want to map density operators into legal density operators, but we shall see in a moment that they are not *sufficient*: quantum channels are not just positive maps, they are **completely** positive maps.
We will discuss their special properties, describe the most common examples, and, last but not least, specify when the action of quantum quantum channels can be reversed, or corrected, so that we can recover the original input state.
This will set the stage for our subsequent discussion of quantum error correction.



## Random evolution

### Random unitaries

As a first step toward understanding the quantum description of an evolving open system, consider a "two-qubit universe" in which we observe *only one* of the qubits.
Let us revisit the controlled-$\texttt{NOT}$ gate, in which two qubits undergo the unitary transformation
$$
  U
  = \proj{0}\otimes\id +\proj{1}\otimes X
  = \diag{\id}{X}
$$
and let us focus on the transformation of the target qubit alone.
We know that it depends on the state of the control qubit:

- if the input state of the control qubit is $\ket{0}$, the target qubit evolves unitarily according to the identity operator $\id$;
- if the input state of the control qubit is $\ket{1}$, the target qubit evolves unitarily according to the bit flip operator $X$;
- but for input states of the control that are superpositions of $\ket{0}$ and $\ket{1}$ the evolution of the target qubit is *not* unitary.

To justify this last point, note that, if the control qubit is in the state $\alpha_0\ket{0}+\alpha_1\ket{1}$ and the target qubit is in some state $\ket{\psi}$, then the output state can be written as
$$
  \alpha_0\ket{0}\otimes\id\ket{\psi} + \alpha_1\ket{1}\otimes X\ket{\psi}
$$
which shows that the control and the target become entangled.
The target qubit alone ends up in the statistical mixture of states $\ket{\psi}$ (with probability $|\alpha_0|^2$) and $X\ket{\psi}$ (with probability $|\alpha_1|^2$).
This can be easily verified by expressing the above output state of the two qubits as the density matrix
$$
  \begin{aligned}
    |\alpha_0|^2\proj{0}\otimes \id\proj{\psi}\id
    \quad &+\quad |\alpha_1|^2\proj{1}\otimes X\proj{\psi}X
  \\+\, \alpha_0\alpha_1^\star\ket{0}\bra{1} \otimes \id\proj{\psi}X
    \quad &+\quad \alpha_0^\star\alpha_1\ket{1}\bra{0} \otimes X\proj{\psi}\id
  \end{aligned}
$$
and then tracing over the control qubit, which gives^[Recall that, for the basis states, $\tr\ket{i}\bra{j}=\braket{i}{j}=\delta_{ij}$.]
$$
  |\alpha_0|^2 \id\proj{\psi}\id
  + |\alpha_1|^2 X\proj{\psi} X.
$$
We can then say that the input state of the target qubit evolves either according to the identity operator (with probability $|\alpha_0|^2$) or according to the operator $X$ (with probability $|\alpha_1|^2$).

This argument works even if the target qubit is initially in a mixed state, since we are dealing with a linear transformation, and any mixed state can be expressed as a statistical ensemble of pure states (via the convex decomposition of a density matrix).
Thus, in general, we can express the evolution of the target qubit as^[We can also focus on the evolution of the control qubit: see the examples and exercises section **!!!to-do!!!**. In fact, we can choose any subset of qubits for our inputs and outputs. For example, our input could be the control qubit, and the output could be both the control and the target qubits.]

$$
  \rho\longmapsto
  \rho'= |\alpha_0|^2 \id\rho\id + |\alpha_1|^2 X\rho X
$$
where $\rho$ and $\rho'$ are the input and the output states, respectively.
We may think about this input-output relation as a mathematical representation of a quantum communication channel in which an input qubit is bit-flipped (via the operator $X$) with some prescribed probability.
But we may also take a more "global" view and see the action of the channel as arising from a unitary evolution on a larger (dilated) system, here composed of two qubits.

Our discussion can easily be extended beyond the qubits to cover any conditional dynamics of the type
$$
  U
  = \sum_i \proj{i}\otimes U_i
  =
  \begin{bmatrix}
    U_1 & 0 & 0 & \ldots
  \\0 & U_2 & 0 & \ldots
  \\0 & 0 & U_3 & \ldots
  \\\vdots & \vdots &\vdots & \ddots
  \end{bmatrix}
$$
where the vectors $\ket{i}$ form an orthonormal basis in the Hilbert space associated with a control system, and the $U_i$ are the corresponding unitary operations performed on a target system.
If the control system is prepared in state $\sum_i\alpha_i\ket{i}$ and the target in state $\ket{\psi}$, then the final state of the two systems is
$$
  \sum_i \alpha_i\ket{i}\otimes U_i\ket{\psi}
$$
and, by the same sequence of arguments as before, we obtain the evolution of the target system alone, and express it as
$$
  \rho\longmapsto
  \rho' = \sum_{i=1} p_i U_i \rho U^\dagger_i
$$
where $p_i=|\alpha_i|^2$.
That is, the state of the target system is modified by the unitary $U_i$, chosen randomly with probability $p_i$.

The reason we are paying a particular attention to the random unitaries is that each unitary is invertible, and, as such, they offer a sliver of hope for reversing the action of the channel.
If we can learn, post factum, which particular unitary operation $U_i$ was chosen then we can simply apply the inverse of that unitary and recover the original state.
For example, if we can measure the control system in the $\ket{i}$ basis, then measuring the outcome to be $k$ tells us that we have to apply $U_k^\dagger$ to the target to recover its input state.
However, if we do not have access to the control system, then there is very little we can do: *we cannot figure out which particular unitary was applied by inspecting the target system alone*.
In this case the best we can do is to apply the inverse of the most likely unitary, which will then recover the input state, *but only with some probability of success*.
In order to do better than that we have to look at slightly different channels.

First though, a fundamental example of a random unitary evolution: a **single qubit Pauli channel** applies one of the Pauli operators, $X$, $Y$ or $Z$, chosen randomly with some prescribed probabilities $p_x$, $p_y$ and $p_z$, giving
$$
  \rho\longmapsto
  p_0 \id \rho\id + p_x X\rho X+ p_y Y\rho Y+  p_z Z\rho Z.
$$
The Pauli operators represent **quantum errors**: bit-flip $X$, phase-flip $Z$, and the composition of the two $Y=iXZ$.



### Random isometries

There is another invertible operation in quantum theory: an **isometry**, which is a combination of adding another quantum system and then applying a unitary transformation to the resulting composite system.
So let us take a quick look at a simple generalisation of random unitaries, namely random isometries $V_i$, which give
$$
  \rho\longmapsto
  \rho' = \sum_{i=1} p_i V_i \rho V^\dagger_i.
$$
An isometry $V$ is similar to a unitary operator except that it maps states in the Hilbert space $\mathcal{H}$ to states in a larger Hilbert space $\mathcal{H}'$ (cf. {the appendix on isometries}(#isometries)).
Here $\mathcal{H}$ is associated with the input and $\mathcal{H}'=\mathcal{H}_\mathcal{A}\otimes\mathcal{H}$ with the dilated system (i.e. the ancilla $\mathcal{A}$ plus our system of interest).
Isometries satisfy $V^\dagger V=\id$, and they are usually implemented by adding an ancilla in a fixed state and then applying a unitary operation to the resulting composed system.
They can be then reversed by applying the inverse of that unitary and discarding the ancilla.

Now, if $\mathcal{H}'$ is sufficiently larger than $\mathcal{H}$, and if the images $\mathcal{H}'_i$ of $\mathcal{H}$ in $\mathcal{H}'$ under the different isometries $V_i$ do not overlap^[That is, if the subspaces $\mathcal{H}'_i$ are mutually orthogonal.], then we can reverse the action of the channel:
we can, at least in principle, perform a measurement on $\mathcal{H}'$, defined by the partition $\mathcal{H}'=\mathcal{H}'_1\oplus\mathcal{H}'_2\oplus\ldots$, and find out which subspace contains the output state;
once we know which subspace the input was sent to, we know which particular isometry $V_k$ was applied by the channel;
then we simply apply $V^\dagger_k$.

In order to see this consider the following simple, but important, example, which we will revisit several times in different disguises.

Alice constructs a quantum channel which is a mixture of four isometries.
The input is a single qubit, and the output is a dilated system composed of three qubits.
She prepares the input qubit in a state^[Our arguments here can be easily extended to any mixed state $\rho$, but for simplicity we consider the case of a pure state.] $\ket{\psi}$ and then combines it with the two ancillary qubits which are in a fixed state $\ket{0}\ket{0}$.
Then she applies one of the four, randomly chosen, unitary operations to the three qubits, to generate the following four isometries:
$$
  \begin{aligned}
    V_1 &= \ket{000}\bra{0} + \ket{111}\bra{1}
  \\V_2 &= \ket{001}\bra{0} + \ket{110}\bra{1}
  \\V_3 &= \ket{010}\bra{0} + \ket{101}\bra{1}
  \\V_4 &= \ket{100}\bra{0} + \ket{011}\bra{1}.
  \end{aligned}
$$

The three qubits, which form the output of the channel, are given to Bob, whose task is to recover the original state $\ket{\psi}$ of the input qubit.
In this scenario, Bob, who knows the four isometries, can find out which particular isometry was applied.
He knows that^[**!!!to-do!!! picture**]

- $V_1$ maps $\mathcal{H}$ to $\mathcal{H}'_1$, which is a subspace of $\mathcal{H}'$ spanned by $\ket{000}$ and $\ket{111}$;
- $V_2$ maps $\mathcal{H}$ to $\mathcal{H}'_2$, which is a subspace of $\mathcal{H}'$ spanned by $\ket{001}$ and $\ket{110}$;
- $V_3$ maps $\mathcal{H}$ to $\mathcal{H}'_3$, which is a subspace of $\mathcal{H}'$ spanned by $\ket{010}$ and $\ket{101}$;
- $V_4$ maps $\mathcal{H}$ to $\mathcal{H}'_4$, which is a subspace of $\mathcal{H}'$ spanned by $\ket{100}$ and $\ket{011}$.

Given that these subspaces are mutually orthogonal, and $\mathcal{H}'=\mathcal{H}'_1\oplus\mathcal{H}'_2\oplus\mathcal{H}'_3\oplus\mathcal{H}'_4$, Bob can perform a measurement defined by the projectors on these subspaces.
For example, if Alice randomly picked $V_2$, then the input state $\ket{\psi}=\alpha_0\ket{0}+\alpha_1\ket{1}$ will be mapped to the output state $\alpha_0\ket{001}+\alpha_1\ket{110}$ in the $\mathcal{H}'_2$ subspace.
Bob's measurement will then detect $\mathcal{H}'_2$ as the subspace where the output state resides, but the measurement (i.e. the corresponding projection) will not affect any state in that subspace.
Bob can now simply apply $V_2^\dagger$ and obtain $\ket{\psi}$.

Just in case you are curious (as you should be!), below is a diagram of how the four isometries are implemented.
How would you reverse these operations?

```{r,engine='tikz',engine.opts=list(template="tikz2pdf.tex"),fig.width=6}
\[
  V_1 =
  \begin{quantikz}[ampersand replacement=\&]
    \lstick{$\ket{\psi}$} \& \ctrl{1} \& \ctrl{2} \& \hphantomgate{X}\qw \& \qw
  \\\lstick{$\ket{0}$} \& \targ{} \& \qw \& \qw \& \qw
  \\\lstick{$\ket{0}$} \& \qw \& \targ{} \& \qw \& \qw
  \end{quantikz}
  \qquad\qquad
  V_2 =
  \begin{quantikz}[ampersand replacement=\&]
    \lstick{$\ket{\psi}$} \& \ctrl{1} \& \ctrl{2} \& \gate{X} \& \qw
  \\\lstick{$\ket{0}$} \& \targ{} \& \qw \& \qw \& \qw
  \\\lstick{$\ket{0}$} \& \qw \& \targ{} \& \qw \& \qw
  \end{quantikz}
\]
\[
  V_3 =
  \begin{quantikz}[ampersand replacement=\&]
    \lstick{$\ket{\psi}$} \& \ctrl{1} \& \ctrl{2} \& \qw \& \qw
  \\\lstick{$\ket{0}$} \& \targ{} \& \qw \& \gate{X} \& \qw
  \\\lstick{$\ket{0}$} \& \qw \& \targ{} \& \qw \& \qw
  \end{quantikz}
  \qquad\qquad
  V_4 =
  \begin{quantikz}[ampersand replacement=\&]
    \lstick{$\ket{\psi}$} \& \ctrl{1} \& \ctrl{2} \& \qw \& \qw
  \\\lstick{$\ket{0}$} \& \targ{} \& \qw \& \qw \& \qw
  \\\lstick{$\ket{0}$} \& \qw \& \targ{} \& \gate{X} \& \qw
  \end{quantikz}
\]
```

Single unitaries or isometries apart, it turns out that the only reversible, or **correctable** channels (i.e. channels in which the input state can be recovered) are exactly the mixtures of mutually orthogonal isometries $V^\dagger_i V_j=\delta_{ij}\id$.
We shall return to these channels later on.



## Evolution of open systems

Needless to say, there is more to evolutions of open systems than random isometries, and what follows is the most general scenario we will discuss.
Consider two interacting systems, $\mathcal{A}$ and $\mathcal{B}$, but this time we do *not* assume that their interacting dynamics admits a control-target interpretation.
We will view $\mathcal{A}$ as an auxiliary system, i.e. an ancilla, and focus on^[As a small notational remark, for now, when we write tensor products, we will place the ancilla first and the system of interest second: $\mathcal{H}_\mathcal{A}\otimes\mathcal{H}_\mathcal{B}$. This is for pedagogical purposes, simply because block matrices on tensor products are easier to interpret when written in this particular order. Later on we will revert to the more common convention in which the system of interest is placed first.] the evolution of system $\mathcal{B}$.

Let us pick an orthonormal basis $\ket{i}$ of the Hilbert space $\mathcal{H}_\mathcal{A}$ associated with the ancilla.
Any unitary transformation of the combined system $\mathcal{AB}$ can then be written as
$$
  U
  = \sum_{ij}\ket{i}\bra{j}\otimes B_{ij}
  =
  \begin{bmatrix}
    B_{11} & B_{12} & B_{13} & \ldots
  \\B_{21} & B_{22} & B_{23} & \ldots
  \\B_{31} & B_{32} & B_{33} & \ldots
  \\\vdots & \vdots & \vdots & \ddots
  \end{bmatrix}
$$
where the $B_{ij}$ are operators acting on the the Hilbert space $\mathcal{H}_\mathcal{B}$ associated with system $\mathcal{B}$.
Note that the $B_{ij}$ do *not* need to be unitary, but, for the overall transformation $U$ to be unitary^[$U^\dagger U = UU^\dagger = \id_{AB}$.], they must satisfy
**!!!to-do: fix label!!!**
$$
\begin{equation}
  \begin{split}
    \sum_i B_{ik}^\dagger B_{il}
    &= \delta_{kl} \id_\mathcal{AB}
  \\\sum_i B_{ki}B_{li}^\dagger
    &= \delta_{kl} \id_\mathcal{B}
  \end{split}
(\#eq:subconditions)
\end{equation}
$$
where $\id_\mathcal{AB}$ and $\id_\mathcal{B}$ are the identity operators on $\mathcal{H}_\mathcal{A}\otimes\mathcal{H}_\mathcal{B}$ and $\mathcal{H}_\mathcal{B}$, respectively.
These two conditions correspond to the requirement that both column and row vectors must be orthonormal for a matrix to be unitary , except that here $U$ is a block matrix, and the entries $B_{ij}$ are complex matrices rather than complex numbers, so some care must be taken with the order of multiplication.
Again, the evolution of the system $\mathcal{B}$ depends on both $U$ *and* on the initial state of the auxiliary system $\mathcal{A}$.

Without any loss of generality, we may assume that system $\mathcal{A}$ is in a pure state^[If $\mathcal{A}$ were initially in a mixed state, we could always regard $\mathcal{A}$ as a subsystem of some larger $\widetilde{\mathcal{A}}$ that is in an entangled pure state.] which can be chosen to be one of the basis states $\ket{i}$, say $\ket{k}$.
In this case, $U$ acts by
**!!!to-do: fix label!!!**
$$
\begin{equation}
  U\colon \ket{k}\otimes\ket{\psi} \longmapsto
  \sum_i \ket{i}\otimes B_{ik}\ket{\psi}
(\#eq:unitary-rep)
\end{equation}
$$
for an arbitrary state $\ket{\psi}$ of $\mathcal{B}$.

The resulting density operator for $\mathcal{B}$ is found by taking the density operator of the output state of $\mathcal{AB}$, which is
$$
  \sum_{ij} \ket{i}\bra{j}\otimes B_{ik}\proj{\psi}B_{jk}^\dagger
$$
and then tracing out $\mathcal{A}$, obtaining
$$
  \begin{aligned}
    \tr_\mathcal{A} \left(
      \sum_{ij} \ket{i}\bra{j}\otimes B_{ik}\proj{\psi}B_{jk}^\dagger
    \right)
    &= \sum_{ij} \braket{i}{j}\cdot B_{ik}\proj{\psi}B_{jk}^\dagger
  \\&= \sum_i B_{ik}\proj{\psi}B_{ik}^\dagger
  \end{aligned}
$$
where we have used the fact that $\braket{i}{j}=\delta_{ij}$.
In general, for any input state $\rho$, we obtain the map
$$
  \rho\longmapsto
  \rho'= \sum_i B_{ik}\rho B^\dagger_{ik} \equiv \sum_i B_{i}\rho B^\dagger_{i}
$$
where, in the last expression on the right-hand size, we have dropped index $k$ (remember, it was there only to remind us about the initial state of the ancilla).
Since the overall transformation $U$ is unitary, recall that the $B_i$ satisfy $\sum_i B_i^\dagger B_i=\id$.
This normalisation conditions guarantees that the trace is preserved.

::: {.idea latex=""}
In summary, we can think about a quantum evolution of subsystem $\mathcal{B}$ as a sequence of the three distinct operations:
$$
  \begin{aligned}
    \rho
    \longmapsto &\underbrace{\proj{k}\otimes\rho}_{\text{add ancilla}}
  \\\longmapsto &\underbrace{U(\proj{k}\otimes\rho) U^\dagger}_{\text{unitary evolution}}
  \\\longmapsto &\underbrace{\tr_\mathcal{A} \left[U(\proj{k}\otimes\rho) U^\dagger\right]}_{\text{discard ancilla}}
    = \sum_i B_{i}\rho B_{i}^\dagger
    =\rho'.
  \end{aligned}
$$
:::

In summary:

- First we pick up a system of interest which, in general, can be in a mixed state $\rho$. It may be the case that this system is entangled with some other degrees of freedom or with some other physical systems, but these other entities will remain passive and will not enter any subsequent dynamics.
- Then we dilate the system: we add an ancilla which is large enough to include everything our system will interact with, and also large enough to be in a pure state. The expansion ends when the composed system is (for all practical purposes) isolated and follows a unitary evolution $U$.
- After the unitary evolution takes place, we discard the ancilla and focus on the system alone. In fact we do not have to discard exactly what we added: we can discard only part of the ancilla, or any other part of the dilated system.
- The output system in this scenario does not have to be the original input system, but usually it is.

```{r,engine='tikz',engine.opts=list(template="tikz2pdf.tex"),fig.width=2}
\begin{quantikz}
  & \lstick{$\ket{k}$} & \gate[wires=2]{U} & \rstick{discard} \qw
\\& \lstick{$\rho$} & \qw & \hphantom{}\qw & \qw\rstick{$\rho'$}
\\\lstick{} \ar[dr,dash,thickness] \ar[ur,dash,thickness]
\\\lstick{} & & \qw &\qw &\qw
\end{quantikz}
```

It is adding (i.e. tensoring) the auxiliary system in a fixed state, and then discarding it (via the partial trace), that is responsible for the *non-unitary* character of this evolution.



## Stinespring's dilation and Kraus's ambiguity

Once we start playing with adding physical systems and increasing the dimension of the underlying Hilbert space, it is convenient to switch from unitaries to isometries.
This is more for mathematical simplicity than physical insight, but it is always good to declutter our equations a bit if we can.
Note that when we fix the initial state of system $\mathcal{A}$ to be $\ket{k}$, we can use Equation \@ref(eq:unitary-rep) **!!!to-do: fix ref!!!** to define an isometry $V$ from $\mathcal{H}_\mathcal{B}$ to $\mathcal{H}_\mathcal{A}\otimes \mathcal{H}_\mathcal{B}$, by

**!!!to-do: fix label!!!**
$$
\begin{equation}
  V\colon \ket{\psi}
  \longmapsto \sum_i\ket{i}\otimes E_i\ket{\psi}
(\#eq:isometry-definition)
\end{equation}
$$

where $E_i\equiv B_{ik}$ and, according to Equation \@ref(eq:subconditions) **!!!to-do: fix ref!!!**, $\sum_i E_i^\dagger E_i=\id$ (here the identity operator acts on $\mathcal{H}_\mathcal{B}$).^[Recall that a map $V$ is an isometry if $V^\dagger V=\id$. For example, adding a system in state $\ket{k}$ gives an isometry $V\colon\ket{\psi}\mapsto\ket{k}\otimes\ket{\psi}$, and the combination of adding a system in a fixed state followed by a unitary evolution of the combined system is also an isometry. Isometries preserve inner products, and therefore also preserve both the norm and the metric based upon the norm.]
The matrix representation of an isometry is a rectangular matrix given by selecting only a few of the columns from a unitary matrix;
here, with $\ket{k}$ fixed, it is only the $k$-th column of the block matrix $U$ that determines the evolution of $\mathcal{B}$, as shown in Figure \@ref(fig:unitary-isometry).

(ref:unitary-isometry-caption) For $k=2$, the second block column is selected. The matrix representation of the isometry $V$ on the right-hand side look like a column vector, but remember that the entries $E_i$ are *matrices*.

```{r unitary-isometry,engine='tikz',engine.opts=list(template="tikz2pdf.tex"),fig.width=7,fig.cap='(ref:unitary-isometry-caption)'}
\definecolor{primary}{RGB}{177,98,78}
\definecolor{secondary}{RGB}{91,132,177}
\begin{equation*}
U=
\left[\,
  \setlength\arraycolsep{0.4em}
  \begin{array}{cccc}
    B_{11} & \cellcolor{primary!20}B_{12} & B_{13} & \ldots
  \\B_{21} & \cellcolor{primary!20}B_{22} & B_{23} & \ldots
  \\B_{31} & \cellcolor{primary!20}B_{32} & B_{33} & \ldots
  \\\vdots & \cellcolor{primary!20}\vdots & \vdots & \ddots
  \end{array}
\right]
\longmapsto
V= \left[\,
  \setlength\arraycolsep{0.4em}
  \begin{array}{c}
    \cellcolor{primary!20}E_{1}
  \\\cellcolor{primary!20}E_{2}
  \\\cellcolor{primary!20}E_{3}
  \\ \cellcolor{primary!20}\vdots
  \end{array}
\right]
\end{equation*}
```

Let us now rephrase our derivation of the evolution of system $\mathcal{B}$ using isometries.
Note that the isometry $V$ in Figure \@ref(fig:unitary-isometry) acts by
$$
  \proj{\psi}
  \longmapsto
  V\proj{\psi}V^\dagger
  = \sum_{ij} \ket{i}\bra{j} \otimes E_i\proj{\psi} E_j^\dagger.
$$$
We trace out $\mathcal{A}$, recall that $\tr\ket{i}\bra{j} = \braket{i}{j}=\delta_{ij}$, and express the evolution of system $\mathcal{B}$ as
$$
  \rho
  \longmapsto
  \rho' = \tr_\mathcal{A} V\rho V^\dagger =\sum_i E_i\rho E_i^\dagger,
$$
where $\sum_iE_i^\dagger E_i=\id$, and we allowed the input states $\rho$ of $\mathcal{B}$ to be mixed (since they can always be expressed as statistical mixtures of pure states $\ket{\psi}$).
This expression shows two different ways of looking at quantum evolutions, and both even have names associated with them.

::: {.idea latex=""}
- **Stinespring**^[[William Forrest "Woody" Stinespring](https://en.wikipedia.org/wiki/W.%5FForrest%5FStinespring) (1929--2012) was an American mathematician specialising in operator theory.] **dilation.**
    Any quantum channel $\mathcal{E}$ can be thought of as arising from a *unitary* evolution on a *dilated* system.
    When we combine tensoring and the unitary evolution into an isometry $V$, we can express the action of the channel $\mathcal{E}$ as
    $$
      \rho \longmapsto \rho'= \tr_\mathcal{A} V\rho V^\dagger,
    $$
    where we trace out a suitably chosen ancilla $\mathcal{A}$.
    In quantum information science we often refer to this approach as *"the Church of the Larger Hilbert Space"*.
<!--  -->

- **Kraus**^[[Karl Kraus](https://en.wikipedia.org/wiki/Karl%5FKraus%5F(physicist)) (1938--1988) was a German physicist known for his contributions to the mathematical foundations of quantum theory. His book *States, effects, and operations* (Lecture Notes in Physics, Vol. **190**, Springer-Verlag, Berlin 1983) is an early account of the notion of complete positivity in physics.] **representation** (a.k.a. **operator-sum decomposition**).
    It is often more convenient to not deal with a larger Hilbert space, but to instead work with operators between the input and output Hilbert spaces
    $$
      \rho \longmapsto \rho'= \sum_i E_i\rho E_i^\dagger.
    $$
    Here we avoid dragging in the ancilla, which can be a good thing, since ancillas typically represent environments that can be very large and complex.
    This operator–sum decomposition is not unique, since the operators $E_i$ (known as the **Kraus operators** or **effects**) depend on the choice of basis in the ancilla.
    The Kraus operators must satisfy the normalisation condition $\sum_i E^\dagger_iE_i=\id$, also known as the **completeness relation**.
:::

We can easily switch between these two equivalent representations:

- We have already seen how to go from a unitary evolution $U$ on a larger system, to an isometry $V$, and then to a map on density operators represented by a set of Kraus operators $E_i$ (as in Figure \@ref(fig:unitary-isometry)).
- Conversely, once we have an operator-sum representation of the channel with a set of Kraus operators $E_i$, we can introduce an ancilla of dimension equal to the number of Kraus operators, and use the orthonormal basis $\ket{i}$ to form the isometry $V=\sum_i\ket{i}\otimes E_i$.
    In terms of matrices, this corresponds to simply "stacking up" the matrices $E_i$ to form the block column (as shown in Figure \@ref(fig:unitary-isometry)), which gives us the matrix representation of $V$.
    If we want to go further, from an isometry $V$ to a unitary $U$, then the next step is somewhat arbitrary: we can choose all the remaining block columns of $U$ however we please, *as long as* we end up with a unitary matrix $U$.

In summary:

::: {.idea latex=""}
All linear transformations of density operators that can be written in the Stinespring (or, equivalently, Kraus) form represent *physically realisable operations*, and we call them **quantum channels**.^[Quantum channels are also known as **superoperators** --- this way physicists remind themselves that these transformations take operators to operators.]
:::

We note again that the Kraus decomposition is *not unique*: the operators $V_i$ in Equation \@ref(eq:isometry-definition) depend on the choice of the ancilla basis.
Indeed, let $\ket{e_i}$ and $\ket{f_j}$ be two orthonormal bases in the Hilbert space associated with the ancilla.
Then $V$ can be expressed as
$$
  \begin{aligned}
    V
    &= \sum_i\ket{e_i}\otimes E_i
  \\&= \sum _{ij} \ket{f_j}\braket{f_j}{e_i}\otimes E_i
  \\&= \sum_{j} \ket{f_j} \otimes \sum_i \underbrace{\braket{f_j}{e_i}}_{R_{ji}} E_i
  \\&= \sum_{j} \ket{f_j} \otimes F_j
  \end{aligned}
$$
where we have used the fact that $\sum_j \proj{f_j}=\id$, and where $R_{ji}=\braket{f_j}{e_i}$ is a unitary matrix connecting the two orthonormal bases (and also the two sets of the Kraus operators) via $F_j=\sum_i R_{ji} E_i$.
So we have a set of Kraus operators $E_i$ associated with basis $\ket{e_i}$ and another, unitarily related, set of Kraus operators associated with basis $\ket{f_j}$, and the two sets describe the same isometry, and hence the same quantum channel.
This correspondence goes both ways: if two channels $\mathcal{E}$ and $\mathcal{F}$ have their Kraus operators related by some unitary $R_{ji}$, then the two channels are identical:
$$
  \begin{aligned}
    \mathcal{F}(\rho)
    &= \sum_j F_j\rho F^\dagger_j
  \\&= \sum_{ijk} R_{ji}E_i \rho E^\dagger_k R^\star_{jk}
  \\&=\sum_{ik} \underbrace{\left(\sum_j R_{jk}^\star R_{ji}\right)}_{\delta_{ki}} E_i\rho E^\dagger_k
  \\&= \sum_i E_i\rho E^\dagger_i
  \\&= \mathcal{E}(\rho).
  \end{aligned}
$$

In summary:

::: {.idea latex=""}
Suppose $E_1,\ldots,E_n$ and $F_1,\ldots,F_m$ are Kraus operators associated with quantum channels $\mathcal{E}$ and $\mathcal{F}$, respectively.
We can append zero operators to the shorter list^[If you wish, instead of appending zeros, you may view $R_{ji}$ as an isometry from the the smaller to the larger set of Kraus operators.] to ensure that $n=m$.
Then *$\mathcal{E}$ and $\mathcal{F}$ describe the same channel if and only if $F_j=\sum_i R_{ji} E_i$ for some unitary $R$*.
:::

In particular, this unitary equivalence of the Kraus operators implies that the identity channel $\rho\mapsto\rho'=\id\rho\id$ can only have Kraus operators that are proportional to the identity.


## Single qubit channels

The best way to familiarise ourselves with the concept of a quantum channel is to study a few examples, and we will start with the simplest case: **single qubit channels**.
The single qubit case is special since we can visualise the action of the channel by looking at the corresponding deformation of the Bloch sphere.
Recall that an arbitrary density matrix for a single qubit can be written in the form
$$
  \begin{aligned}
    \rho
    &= \frac{1}{2}\left(\id +\vec{s}\cdot \vec\sigma\right)
  \\&= \frac{1}{2}\left(\id  +s_x X+ s_y Y + s_z Z\right)
  \end{aligned}
$$
where $\vec{s}$ is the Bloch vector of the qubit with components $(s_x, s_y, s_z)$, and $X$, $Y$, and $Z$ are the Pauli operators.
Recall that unitary operations rotate the Bloch sphere.
In particular the $X$, $Y$, and $Z$ --- viewed as unitary transformations --- rotate the Bloch sphere by $180^\circ$ around the $x$, $y$, and $z$ axes, respectively.
General quantum channels, however, may deform it further, into spheroids with a displaced centre, as the following examples show.

- *A bit-flip with probability $p$:*
    $$
      \rho \longmapsto (1-p)\rho+pX\rho X.
    $$
    The Kraus operators are $\sqrt{1-p}\id$ and $\sqrt{p}X$;
    the original Bloch sphere shrinks into a prolate spheroid aligned with the $x$-axis;
    for the specific case of $p=\frac{1}{2}$, the Bloch sphere degenerates to the $[-1,1]$ interval on the $x$-axis.

- *A phase-flip with probability $p$:*
    $$
      \rho \longmapsto (1-p)\rho+pZ\rho Z.
    $$
    The Kraus operators are $\sqrt{1-p}\id$ and $\sqrt{p}Z$;
    the original Bloch sphere shrinks into a prolate spheroid aligned with the $z$-axis;
    for the specific case of $p=\frac{1}{2}$, the Bloch sphere degenerates to the $[-1,1]$ interval on the $z$-axis.

- *The depolarising channel:*
    $$
      \rho\longmapsto (1-p)\rho + \frac{p}{3}\left(X\rho X+Y\rho Y+Z\rho Z\right).
    $$
    Here the qubit remains intact with probability $1-p$, while a quantum error occurs with probability $p$.
    The error can be of any one of three types: bit-flip $X$, phase-flip $Z$, or and both bit- and phase-flip $Y$; each type of error is equally likely.
    For $p<\frac{3}{4}$, the original Bloch sphere contracts uniformly under the action of the channel, and the Bloch vector shrinks by the factor $1-\frac{4}{3}p$;
    for the specific case of $p=\frac{3}{4}$, the Bloch sphere degenerates to the point at the centre of the sphere;
    for $p>\frac{3}{4}$, the Bloch sphere is flipped, and the Bloch vector starts pointing in the opposite direction increasing the magnitude up to $\frac{1}{3}$ (which occurs for $p=1$).

There are two interesting points that must be mentioned here.
The first one is about the interpretation of the action of the channel in terms of Kraus operators: our narrative may change when we switch to a different set of effects.
For example, take the phase-flip channel with $p=\frac{1}{2}$ and switch from the effects
$$
  \begin{aligned}
    E_1 &= \frac{1}{\sqrt{2}}\id
  \\E_2 &= \frac{1}{\sqrt{2}}Z
  \end{aligned}
$$
to
$$
  \begin{aligned}
    F_1 &= \frac{1}{\sqrt{2}}(E_1+E_2)=\proj{0}
  \\F_2 &= \frac{1}{\sqrt{2}}(E_1-E_2)=\proj{1}.
  \end{aligned}
$$
These two sets of Kraus operators $\{E_1,E_2\}$ and $\{F_1,F_2\}$ describe the same channel, but the *narrative* is different.
The first set of effects tells us that the channel chooses randomly, with the same probability, between the two options: let the qubit pass undisturbed or apply the phase-flip $Z$;
the second set tells us that channel essentially performs the measurement in the standard basis, but the outcome of the measurement is not revealed.
In general:

::: {.idea latex=""}
Describing actions of quantum channels purely in terms of their effects (i.e. Kraus operators) can be ambiguous.
:::

The second interesting point is that not *all* transformations of the Bloch sphere into spheroids are possible.
For example, we cannot deform the Bloch sphere into a pancake-like oblate spheroid.
This is due to *complete* positivity (instead of mere positivity) of quantum channels, which we will explain shortly.


## Composition of quantum channels

We mentioned that quantum channels are combinations of

1. adding a physical system in a fixed state (via tensoring),
2. discarding a physical system (taking a partial trace),
3. and unitary transformations.

For consistency let us note that each of these operations admits an operator sum decomposition. This is obvious for unitary evolution ($\rho\mapsto U\rho U^\dagger$), but perhaps less so for the other two operations.

- **Adding a system.**
    Any quantum system can be expanded by bringing in an auxiliary system in a fixed state $\ket{a}$.
    This transformation takes vectors in the Hilbert space associated with the original system and tensors them with a fixed vector $\ket{a}$ in the Hilbert space associated with the auxiliary system:
    $$
      \ket{\psi}
      \longmapsto \ket{a}\otimes\ket{\psi}
      = (\ket{a}\otimes\id) \ket{\psi}.
    $$
    In terms of density operators, we write this "expansion" transformation as
    $$
      \begin{aligned}
        \rho
        \longmapsto \rho'
        &= \proj{a}\otimes\rho
      \\&= (\ket{a}\otimes\id)\rho (\bra{a}\otimes\id)
      \\&= V\rho V^\dagger
      \end{aligned}
    $$
    where $V=\id\otimes\ket{a}$.
    We note that $V^\dagger V = \id\otimes\braket{a|a} =\id$ is the identity in the Hilbert space associated with the system, and so $V$ is an isometry.
    Indeed, this transformation is an *isometric embedding*.

- **Discarding a system.**
    Conversely, given a composite system in state $\rho$, we can discard one of its subsystems.
    The partial trace over an auxiliary system can be written in the Kraus representation as
    $$
      \begin{aligned}
        \rho
        \longmapsto \rho'
        &= \tr_\mathcal{A}\rho
      \\&= (\tr\otimes\id)\rho
      \\&= \sum_i (\bra{i}\otimes\id)\rho(\ket{i}\otimes\id)
      \\&= \sum_i E_i\rho E^\dagger_i
      \end{aligned}
    $$
    where the vectors $\ket{i}$ form an orthonormal basis in the Hilbert space associated with the auxiliary system.
    Again, we can check that the Kraus operators $E_i=\bra{i}\otimes\id$ satisfy the completeness relation $\sum_i E^\dagger_i E_i =\id\otimes\id$ (using the fact that $\sum_i\proj{i}=\id$).

Any *sequential* composition of two quantum channels $\mathcal{E}$ and $\mathcal{F}$ with Kraus operators $\{A_i\}_{i\in I}$ and $\{B_j\}_{j\in J}$ (respectively) is another quantum channel^[Here we have tacitly assumed that the dimensions agree, i.e. that the output of $\mathcal{E}$ and the input of $\mathcal{F}$ are of the same dimension, so that the composition makes sense.] described by the Kraus operators $\{B_jA_i\}_{i\in I,j\in J}$.
Showing this is rather straightforward, at least in the operator sum representation: let
$$
  \begin{aligned}
    \mathcal{E} &= \sum_i A_i\cdot A^\dagger_i
  \\\mathcal{F} &= \sum_j B_j\cdot B^\dagger_j
  \end{aligned}
$$
where $\sum_i A^\dagger_i A_i=\sum_j B^\dagger_j B_j=\id$;
then the sequential composition of $\mathcal{E}$ followed by $\mathcal{F}$ can be written as
$$
  \mathcal{F} \circ\mathcal{E}
  = \sum_{ij} (B_jA_i) \cdot (B_jA_i)^\dagger
$$
so that the $B_jA_i$ are the Kraus operators associated with the new channel $\mathcal{F}\circ\mathcal{E}$, where the normalisation condition (or completeness relation) follows from
$$
  \begin{aligned}
    \sum_{ij} (B_jA_i)^\dagger (B_jA_i)
    &= \sum_i A_i^\dagger\left(\sum_j B_j^\dagger B_j\right)A_i
  \\&= \sum_i A_i^\dagger A_i
  \\&= \id.
  \end{aligned}
$$

You might wonder why we explicitly called the above composition "sequential" --- isn't this how we always compose functions?
In actual fact, since we have access to tensor products, there is another sort of composition, namely **parallel** composition: if we have systems $\mathcal{A}$ and $\mathcal{B}$ with channels $\mathcal{E}_\mathcal{A}$ acting on $\mathcal{A}$ and $\mathcal{E}_\mathcal{B}$ acting on $\mathcal{B}$, then the parallel composition is denoted by $\mathcal{E}_\mathcal{A}\otimes\mathcal{E}_\mathcal{B}$, acting on the joint system $\mathcal{A}\otimes\mathcal{B}$, and with Kraus operators given by the $A_i\otimes B_j$.
The normalisation condition again follows from a simple calculation:
$$
  \begin{aligned}
    \sum_{ij} (A_i\otimes B_j)^\dagger (A_i\otimes B_j)
    &= \sum_{ij} A_i^\dagger A_i \otimes B_j^\dagger B_j
  \\&= \id_A\otimes\id_B.
  \end{aligned}
$$

Now that we know how to compose quantum channels in terms of Kraus operators, we can see that the Stinespring representation is perfectly consistent with the Kraus representation: the three basic operations that we are allowed to use to build channels in the Stinespring representation (i.e. adding a system, unitary evolution, and discarding a system) are all themselves quantum channels, in that they admit a Kraus decomposition.

Before moving on, we make a small (but important) remark:

::: {.idea latex=""}
When we compose quantum channels, each channel needs its own independent ancilla;
*do not share ancillas between different channels*.
:::

For example, say we have three channels, $\mathcal{E}_1$, $\mathcal{E}_2$, and $\mathcal{E}_3$, with $\mathcal{E}_i$ defined by the unitary $U_i$ and the state $\ket{a_i}$ of its ancilla.
Then the (sequential) composition $\mathcal{E}_3\circ\mathcal{E}_2\circ\mathcal{E}_1$ is given by

```{r,engine='tikz',engine.opts=list(template="tikz2pdf.tex"),fig.width=5}
\begin{quantikz}
  \lstick{$\ket{a_1}$}
  & \gate[2]{U_1}
  & \qw
  & & & \lstick{$\ket{a_2}$}
  & \gate[2]{U_2}
  & \qw
  & & & \lstick{$\ket{a_3}$}
  & \gate[2]{U_3}
  &\qw
\\\lstick{$\rho$}
  & &\qw
  & \qw \rstick{$\rho'_1$}
  & & \qw
  & & \qw
  & \qw \rstick{$\rho'_2$}
  & & \qw
  & & \rstick{$\rho'_3$} \qw
\end{quantikz}
```

For more on this, see [the appendix on Markov approximation](#markov-approximation).



## Completely positive trace-preserving maps

It is easy to verify that quantum channels preserve positivity and trace, but the converse is not true!
You may find it surprising, but there are linear maps that preserve positivity and the trace, but which are *not* quantum channels.
The matrix transpose operation $\rho\mapsto\rho'=\rho^T$ is a good example of such an unphysical operation: it preserves both trace and positivity, and if $\rho$ is a density matrix then so too is $\rho'=\rho^T$, but the transpose *cannot* be written in the Stinespring (or the Kraus) form;
it is not induced by a unitary operation on some larger Hilbert space, and it cannot be implemented.
So, we then ask, *what is* the class of physically admissible maps?

Mathematically speaking, a quantum channel $\mathcal{E}$ is represented by a map
^[Recall that, given a pair of Hilbert spaces $\mathcal{H}$ and $\mathcal{H}'$, we denote the set of (bounded) linear operators from $\mathcal{H}$ to $\mathcal{H}'$ by $\mathcal{B}(\mathcal{H},\mathcal{H}')$. We write $\mathcal{B}(\mathcal{H})$ as shorthand for $\mathcal{B(H,H)}$]
$$
  \mathcal{E}\colon \mathcal{B}(\mathcal{H}) \to \mathcal{B}(\mathcal{H}')
$$
mapping states (i.e. density operators) on some Hilbert space $\mathcal{H}$ to states on some, possibly different, Hilbert space $\mathcal{H}'$.
But we are not interested in just any such maps, of course --- the statistical interpretation of quantum theory imposes certain properties on the subset of maps in which we are interested.

- Firstly, for such a map $\mathcal{E}$ to be a channel it must *respect the mixing of states*.
    Consider an ensemble of systems, with a fraction $p_1$ of them in the state $\rho_1$, and the remaining $p_2$ of them in the state $\rho_2$.
    The overall ensemble is described by $\rho=p_1\rho_1+p_2\rho_2$.
    If we apply $\mathcal{E}$ to each member of the ensemble individually, then the overall ensemble will be described by the density operator $\rho'=\mathcal{E}(\rho)$, which is given by $\rho'=p_1\mathcal{E}(\rho_1)+p_2\mathcal{E}(\rho_2)$.
    We conclude that $\mathcal{E}$ must be a *linear map*.

- Next, since $\mathcal{E}$ must *map density operators to density operators* it must be both *positive* ($\mathcal{E}(\rho)\geq0$ whenever $\rho\geq0$) and *trace preserving* ($\tr\mathcal{E}(\rho)=\tr\rho$ for all $\rho$).

- Finally comes a subtle point.
    It turns out that being positive is not good enough;
    we must further require that the map $\mathcal{E}$ *remains positive even when extended to act on a part of a larger system*.
    Suppose that Alice and Bob share a bipartite system $\mathcal{AB}$ in an entangled state $\rho_\mathcal{AB}$, and, whilst Alice does nothing, Bob applies the local operation $\mathcal{E}$ to his subsystems, and his subsystems only.
    Then the resulting map on the whole bipartite system is given by $\id\otimes\mathcal{E}$, and this must give a proper density operator $\rho'_\mathcal{AB}$ of the composed system.
    It turns out that this is a strictly stronger property than mere positivity;
    we are asking for something called **complete positivity**.
    Needless to say, complete positivity of $\mathcal{E}$ implies positivity, but the converse does not hold: there are maps which are positive but not completely positive.
    The matrix transpose operation $\rho\rightarrow \rho'=\rho^T$ is a classic example of such a map.

In fact, we can study the matrix transpose a bit further.
Consider the transpose operation on a single qubit: $T\colon(\ket{i}\bra{j})\mapsto\ket{j}\bra{i}$ (for $i,j\in\{0,1\}$).
It preserves both trace and positivity, and if $\rho$ is a density matrix then so too is $\rho'=\rho^T$.
However, if the input qubit is part of a two qubit system, initially in the entangled state $\ket{\Omega}=\frac{1}{\sqrt{2}}(\ket{0}\ket{0}+\ket{1}\ket{1})$, and the transpose is applied to *only one* of the two qubits (say, the second one), then the density matrix of the two qubits evolves under the action of the partial transpose $\id\otimes T$ as
$$
  \begin{aligned}
    \proj{\Omega}
    = \frac{1}{2}\sum_{ij} \ket{i}\bra{j} \otimes \ket{i}\bra{j}
    &\xmapsto{\id\otimes T}
    \frac{1}{2}\sum_{ij} \ket{i}\bra{j} \otimes T( \ket{i}\bra{j})
  \\&= \frac{1}{2}\sum_{ij} \ket{i}\bra{j} \otimes \ket{j}\bra{i}.
  \end{aligned}
$$
The output is the $\texttt{SWAP}$ matrix, since it describes the $\texttt{SWAP}$ operation: $\ket{j}\ket{i}\mapsto\ket{i}\ket{j}$.
Since this operation squares to the identity, we know that its eigenvalues must be either $\pm1$: states which are symmetric under interchange of the two qubits have eigenvalue $1$, while antisymmetric states have eigenvalue $-1$.
So the $\texttt{SWAP}$ matrix has negative eigenvalues, which means that $\id\otimes T$ does *not* preserve positivity, and therefore $T$ is *not* a completely positive map.
If you prefer to see this more explicitly, then you can use the matrix representation of $\proj{\Omega}$, apply the partial transpose $\id\otimes T$, and then inspect the resulting matrix:
$$
  \frac12\left[
  \begin{array}{cc|cc}
    1 & 0 & 0 & 1
  \\0 & 0 & 0 & 0
  \\\hline
    0 & 0 & 0 & 0
  \\1 & 0 & 0 & 1
  \end{array}\right]
  \xmapsto{\id\otimes T}
  \frac12\left[
  \begin{array}{cc|cc}
    1 & 0 & 0 & 0
  \\0 & 0 & 1 & 0
  \\\hline
    0 & 1 & 0 & 0
  \\0 & 0 & 0 & 1
  \end{array}\right].
$$
That is, the partial transpose $\id\otimes T$ maps the density matrix of a maximally entangled state $\proj{\Omega}$ to the $\texttt{SWAP}$ matrix, which has one negative eigenvalue ($-1$) and thus is not a density matrix.

So we have seen that, at the very least, we want to be considering *completely positive trace-preserving* maps, but how do we know whether or not there are any restrictions left to impose?
Needless to say, here is where mathematics alone cannot guide us, since we are trying to characterise maps which are *physically admissible*, and mathematics knows nothing about the reality of our universe!
However, one thing that we can do is compare our abstract approach with the derivations of quantum channels defined in terms of the Stinespring (or the Kraus) representation.
As it happens, we can show that a map is completely positive and trace preserving if and only if it can be written in the Stinespring (or the Kraus) form.
In other words:

::: {.idea latex=""}
Quantum channels are exactly the completely positive trace-preserving (CPTP) maps.
:::

One direction of this claim is much simpler than the other.
Any channel $\mathcal{E}$ must be completely positive, since the Kraus decomposition guarantees positivity of both $\mathcal{E}$ *and* the extended map $\id\otimes\mathcal{E}$: if $\mathcal{E}$ has the Kraus decomposition $\sum_i E_i\cdot E_i^\dagger$, then the extended channel $\id\otimes\mathcal{E}$ has the Kraus decomposition $\sum_i(\id\otimes E_i)\cdot(\id\otimes E_i^\dagger)$, which means that $\id\otimes\mathcal{E}$ is also a positive map, and so $\mathcal{E}$ is completely positive.
Showing that CPTP maps are quantum channels is less obvious, and, in order to prove this, we will introduce a very convenient tool called the **Choi matrix**^[Man-Duen Choi was brought up in Hong Kong. He received his Ph.D. degree under the guidance of Chandler Davis at Toronto. He taught at the University of California, Berkeley, from 1973 to 1976, and has worked since then at the University of Toronto. His research has been mainly in operator algebras, operator theory, and polynomial rings. He is particularly interested in examples/counterexamples and two-by-two matrix manipulations.], which is yet another way to characterise linear maps between operators.

::: {.tim}
- **!!to-do: tim footnote: here we work only with finite dimensional spaces, and if $X$ is f.d. then every linear operator $f\colon X\to Y$ between normed vector spaces is continuous (and thus bounded)!!**
- talk about [unbounded operators](https://en.wikipedia.org/wiki/Hilbert_space#Unbounded_operators)
:::



## State-channel duality

Suppose that $\mathcal{H}$ is of dimension $d$ and $\mathcal{H}'$ is of dimension $d'$, and pick a basis for each space.
Then any linear map $\mathcal{E}\colon\mathcal{B}(\mathcal{H})\to\mathcal{B}(\mathcal{H'})$ can be completely characterised by its action on the $d^2$-many basis matrices $\ket{i}\bra{j}$ of $\mathcal{B}(\mathcal{H})$, where $i,j\in\{1,2\ldots,d\}$, i.e. for any density operator $\rho$ on $\mathcal{H}$ we have
**!!to-do: fix label!!**
$$
\begin{equation}
  \mathcal{E}(\rho)
  = \mathcal{E}\left(\sum_{ij}\rho_{ij} \ket{i}\bra{j}\right)
  = \sum_i\rho_{ij}\mathcal{E}(\ket{i}\bra{j}).
\end{equation}
(\#eq:subconditions)
$$
We can now tabulate all the $(d'\times d')$ matrices $\mathcal{E}(\ket{i}\bra{j})$ in $\mathcal{H}'$ by forming a bigger $(dd'\times dd')$ block matrix in $\mathcal{H}\otimes\mathcal{H}'$:

```{r,engine='tikz',engine.opts=list(template="tikz2pdf.tex"),fig.width=7}
\definecolor{primary}{RGB}{177,98,78}
\definecolor{secondary}{RGB}{91,132,177}
\begin{equation*}
  \widetilde{\mathcal{E}} =
  \left[\,
  \setlength\arraycolsep{0.4em}
  \def\arraystretch{1.5}
    \begin{array}{cccc}
      \cellcolor{secondary!20}\mathcal{E}(\ket{0}\bra{0})
      & \mathcal{E}(\ket{0}\bra{1})
      & \cellcolor{secondary!20}\mathcal{E}(\ket{0}\bra{2})
      & \cdots
    \\\mathcal{E}(\ket{1}\bra{0})
      & \cellcolor{secondary!20}\mathcal{E}(\ket{1}\bra{1})
      & \mathcal{E}(\ket{1}\bra{0})
      & \cdots
    \\\cellcolor{secondary!20} \mathcal{E}(\ket{2}\bra{0})
      & \mathcal{E}(\ket{2}\bra{1})
      & \cellcolor{secondary!20}\mathcal{E}(\ket{2}\bra{2})
      & \cdots
    \\\vdots
      & \vdots
      & \vdots
      & \ddots
    \end{array}
  \,\right].
\end{equation*}
```

We call this block matrix $\widetilde{\mathcal{E}}\in\mathcal{B}(\mathcal{H}\otimes\mathcal{H}')$ the **Choi matrix** of $\mathcal{E}$.

The Choi matrix is essentially another way of representing a linear map $\mathcal{E}\colon\mathcal{B}(\mathcal{H})\to\mathcal{B}(\mathcal{H'})$: if you are given the Choi matrix $\widetilde{\mathcal{E}}$ of $\mathcal{E}$ and you want to evaluate $\mathcal{E}(\rho)$, then you simply follow Equation \@ref(eq:rhodecomp), taking the values of $\mathcal{E}(\ket{i}\bra{j})$ from the Choi matrix.
This can be formally written as

::: {.idea latex=""}
If $\mathcal{E}\colon\mathcal{B}(\mathcal{H})\to\mathcal{B}(\mathcal{H'})$, then
$$
  \mathcal{E}(\rho)
  = d(\tr\otimes\id)\left[(\rho^T\otimes\id)\widetilde{\cal{E}}\right]
$$
where $d=\dim\mathcal{H}.
:::

The expression above may look baffling to an untrained eye, but this is often the case when we turn something conceptually obvious into a precise and compact mathematical notation.
In order to gain some intuition here, recall that, for matrices $A$ and $B$,
$$
  \tr A^T B = \sum_{ij} A_{ij}B_{ij}.
$$
If we take $A$ and $B$ to be the block matrices $\rho\otimes\id$ and $\widetilde{\mathcal{E}}$, respectively, then we can use this to show that
$$
  (\tr\otimes\id)\left[(\rho^T\otimes\id)\widetilde{\mathcal{E}}\right]
  = \frac{1}{d}\sum_i\rho_{ij}\mathcal{E}(\ket{i}\bra{j}).
$$

This state-channel duality thus gives us a one-to-one correspondence between linear maps $\mathcal{E}\colon\mathcal{B}(\mathcal{H})\to\mathcal{B}(\mathcal{H}')$ and matrices $\widetilde{\mathcal{E}}$ acting on the tensor product $\mathcal{H}\otimes\mathcal{H}'$.
This correspondence is sometimes called the **Choi--Jamiołkowski isomorphism**, and we discuss it further in [the appendix of the same name](#choi-jamiolkowski).

Mathematically, it is not too surprising that the matrix elements of an operator on a tensor product can be reorganised and reinterpreted as the matrix elements of an operator between operator spaces.
What is interesting, and perhaps not so obvious, however, is that the positivity conditions for maps correspond exactly to conditions on their Choi matrices under this correspondence.
In order to see this, let us express the Choi matrix as the result of $\id\otimes\mathcal{E}$ acting on the maximally entangled state in $\mathcal{H}\otimes\mathcal{H}$:

::: {.idea latex=""}
The Choi matrix $\widetilde{\mathcal{E}}$ of a linear map $\mathcal{E}\colon\mathcal{B}(\mathcal{H})\to\mathcal{B}(\mathcal{H'})$ is given by
$$
  \widetilde{\mathcal{E}}
  = (\id\otimes\mathcal{E})\proj{\Omega}
  = \frac{1}{d} \sum_{ij} \ket{i}\bra{j}\otimes\mathcal{E}(\ket{i}\bra{j})
$$
where $\ket{\Omega}=\frac{1}{\sqrt d}\sum_{i=1}^d\ket{i}\ket{i}$ is the maximally entangled state in $\mathcal{H}\otimes\mathcal{H}$, and where $d=\dim\mathcal{H}$.
:::

```{r,engine='tikz',engine.opts=list(template="tikz2pdf.tex"),fig.width=8}
\begin{equation*}
  \begin{quantikz}
    \lstick{$\dim\mathcal{H}=d$}&&\qw &\gate{\mathcal{I}} &\qw &\qw\rstick{$\dim\mathcal{H}=d$}
  \\\lstick{$\Omega$} \ar[dr,dash,thickness] \ar[ur,dash,thickness]
  \\\lstick{$\dim\mathcal{H}=d$}&&\qw &\gate{\mathcal{E}} &\qw &\qw\rstick{$\dim\mathcal{H}'=d'$}
  \end{quantikz}
\end{equation*}
```

In this form, the Choi--Jamiołkowski isomorphism gives us a simple necessary and sufficient condition for a linear map to be a quantum channel:

::: {.idea latex=""}
**State-channel duality**: $\mathcal{E}$ is a quantum channel if and only if $\widetilde{\mathcal{E}}$ is a density matrix.
:::

One direction of this claim is immediate: we already know that any quantum channel $\mathcal{E}$ is, in particular, a completely positive map, and so $\id\otimes\mathcal{E}$ maps density matrices to density matrices, whence $\widetilde{\mathcal{E}}=(\id\otimes\mathcal{E})\ket{\Omega}\bra{\Omega}$ is a density matrix, since $\ket{\Omega}\bra{\Omega}$ is a density matrix.
The other direction is less obvious.
If $\widetilde{\mathcal{E}}$ is a density matrix, then it can be written as a mixture of pure states $\proj{\psi_k}$ with probabilities $p_k$:
$$
  \widetilde{\mathcal{E}}
  = \sum_k\proj{\widetilde{\psi}_k},
$$
where $\ket{\widetilde{ \psi}_k}=\sqrt{p_k}\ket{\psi_k}$ are (non-normalised) vectors, and any such vector can be written as
$$
  \ket{\widetilde{ \psi}_k} = (\id\otimes E_k)\ket{\Omega}
$$
for some operator $E_k$.

Now, any vector $\ket{\psi}$ in $\mathcal{H}\otimes\mathcal{H}'$ can be written as^[**Exercise.** Prove this!]
$$
  \ket{\psi}=\id\otimes V \ket{\Omega}
$$
where $V=\sum_{ij}V_{ij}\ket{j}\bra{i}$ is an operator from $\mathcal{H}$ to $\mathcal{H}'$, and $\ket{\Omega}=\frac{1}{d}\sum_i\ket{i}\otimes\ket{i}$ is a maximally entangled state in $\mathcal{H}\otimes\mathcal{H}$.
(Here, the vectors $\ket{i}$ and $\ket{j}$ form orthonormal bases in $\mathcal{H}$ and $\mathcal{H}'$, respectively.)

Using the above way of writing such vectors, we see that
$$
  \begin{aligned}
    \widetilde{\mathcal{E}}
    &= \sum_k\proj{\widetilde{\psi}_k}
  \\&= \sum_k  (\id\otimes E_k)\proj{\Omega} (\id\otimes E^\dagger_k)
  \\&= \frac{1}{d} \sum_{ij} \ket{i}\bra{j}\otimes\underbrace{\sum_k E_k(\ket{i}\bra{j}) E^\dagger_k}_{\mathcal{E}(\ket{i}\bra{j})}.
  \end{aligned}
$$
Comparing the last expression on the right-hand size with the definition of $\widetilde{\mathcal{E}}$, or using the Choi--Jamiołkowski isomorphism, we conclude that $\mathcal{E}$ is of the form
$$
  \mathcal{E}(\rho)
  = \sum_k E_k \rho E^\dagger_k.
$$
Moreover, $\tr\widetilde{\mathcal{E}}=1$ implies that^[**Exercise.** Prove this!] $\sum_k E^\dagger_kE_k=\id$.
So if $\widetilde{\mathcal{E}}$ is a density operator, then the map $\mathcal{E}$ can be expressed in the Kraus form.
Thus $\mathcal{E}$ is a quantum channel, and, therefore, also a CPTP map.
We have now established the desired isomorphism between *states* and *channels*.

The equations
$$
  \mathcal{E}(\rho)
  = d(\tr\otimes\id)\left[(\rho^T\otimes\id)\widetilde{\cal{E}}\right].
$$
and
$$
  \widetilde{\mathcal{E}}
  = (\id\otimes\mathcal{E})\proj{\Omega}
  = \frac{1}{d} \sum_{ij} \ket{i}\bra{j}\otimes\mathcal{E}(\ket{i}\bra{j})
$$
tell us how to obtain the state $\widetilde{\mathcal{E}}$ from the channel $\mathcal{E}$, and vice versa.
We have also shown that quantum channels are exactly the completely positive trace-preserving maps.

We summarise the flow of implications in the following diagram:
$$
\begin{CD}
  \mathcal{E} @>{\widetilde{E}=(\id\otimes\mathcal{E})\ket{\Omega}\bra{\Omega}}>> \widetilde{\mathcal{E}}
\\@VVV @VVV
\\E_k\cdot E_k^\dagger @<<{\ket{\widetilde{\psi}_k}=(\id\otimes E_k)\ket{\Omega}}< \ket{\widetilde{\psi}_k}\bra{\widetilde{\psi}_k}
\end{CD}
$$
We start in the top left corner with a quantum channel $\mathcal{E}$.
This channel is a CPTP map, which means that $\id\otimes\mathcal{E}$ takes a maximally entangled state $\ket{\Omega}$ to a density matrix $\widetilde{\mathcal{E}}$.
This is our first implication: *if $\mathcal{E}$ is a quantum channel, then its Choi matrix $\widetilde{\mathcal{E}}$ is a density matrix*.
The reverse implication goes as follows.
The density matrix $\widetilde{\mathcal{E}}$ can be expressed as a mixture of pure states, $\proj{\tilde\psi_k}$ (and this takes us to the bottom right corner in the diagram).
We use this mixture decomposition when we construct map the $\mathcal{E}$ from the Choi matrix $\widetilde{\mathcal{E}}$, via the Choi-Jamiolkowski isomorphism.
We notice that $\mathcal{E}$ admits the operator-sum representation, and that each of the pure states in the mixture is associated with a Kraus operator, with $\ket{\widetilde{\psi}_k} = (\id\otimes E_k)\ket{\Omega}$.
All together this gives us the reverse implication: *if the Choi matrix $\widetilde{\mathcal{E}}$ is a density matrix, then $\mathcal{E}$ is a quantum channel.*



## The mathematics of "can" and "cannot"

So what is state-channel duality good for?
To start with, it can be used to asses whether or not a given map $\mathcal{B}(\mathcal{H})\to\mathcal{B}(\mathcal{H}')$ can actually be implemented, i.e. if it is a physically realisable CPTP map.
Indeed, all we have to do is to check if the corresponding Choi matrix is a density matrix.
Let's look at a simple example.

Consider the map
$$
  \mathcal{E}\colon \ket{i}\bra{j}
  \longmapsto p\ket{j}\bra{i}+(1-p)\delta_{ij} \frac{1}{2}\ket{i}\bra{j}
$$
where $0\leq p\leq1$ is some fixed parameter.
This map acts on a density operator $\rho$ via
$$
  \rho
  \longmapsto \rho'
  = p\rho^T +(1-p) \frac{1}{2}\id
$$
where $\rho^T$ is the transpose of $\rho$.

But is this map a quantum channel?
That is, *does it represent a physical process that can be implemented in a lab*?

The expression for $\mathcal{E}$, i.e. the convex sum on the right-hand side, can be interpreted as follows: take the input state $\rho$ and either (i) apply the transpose, or (ii) replace it with the maximally mixed state (with probabilities $p$ and $1-p$, respectively).
This is fine, except that the transpose operation is not completely positive, and, as such, *is not physically admissible* --- it cannot be implemented.
But does it mean that the map $\mathcal{E}$ itself cannot be implemented?
Not necessarily!

In fact, the answer depends on the value of $p$.
The case $p=0$ corresponds to just replacing the input with the maximally mixed state, which is something that can be easily implemented.
However, as $p$ increases from $0$ to $1$, at some critical point the map switches from *completely positive* to merely *positive*.
In order to find this critical value of $p$, we first calculate the $\mathcal{E} (\ket{i}\bra{j})$, as follows:
$$
  \begin{aligned}
    \ket{0}\bra{0}
    &= \begin{bmatrix}1&0\\0&0\end{bmatrix}
    \longmapsto
    \begin{bmatrix}\frac{1+p}{2}&0\\0&\frac{1-p}{2}\end{bmatrix}
  \\\ket{0}\bra{1}
    &= \begin{bmatrix}0&1\\0&0\end{bmatrix}
    \longmapsto
    \begin{bmatrix}0&0\\p&0\end{bmatrix},
  \\\ket{1}\bra{0}
    &= \begin{bmatrix}0&0\\1&0\end{bmatrix}
    \longmapsto
    \begin{bmatrix}0&p\\0&0\end{bmatrix}
  \\\ket{1}\bra{1}
    &= \begin{bmatrix}0&0\\0&1\end{bmatrix}
    \longmapsto
    \begin{bmatrix}\frac{1-p}{2}&0\\0&\frac{1+p}{2}\end{bmatrix},
  \end{aligned}
$$
We can then write down the Choi matrix:
$$
  \widetilde{\mathcal{E}}
  = \frac12
  \begin{bmatrix}
    \mathcal{E}(\ket{0}\bra{0})
    & \mathcal{E}(\ket{0}\bra{1})
  \\\mathcal{E}(\ket{1}\bra{0})
    & \mathcal{E}(\ket{1}\bra{1}) 
  \end{bmatrix}
  = \frac{1}{2}
  \left[
    \begin{array}{cc|cc}
    \frac{1+p}{2} & 0 & 0 & 0
  \\0 & \frac{1-p}{2} & p & 0
  \\\hline
    0 & p & \frac{1-p}{2} & 0
  \\0 & 0 & 0 & \frac{1+p}{2}
   \end{array}
  \right]
$$
which lets us apply state-channel duality: *$\mathcal{E}$ is completely positive (and hence physically realisable) if and only if $\widetilde{\mathcal{E}}\geq0$*;
the latter is true only when $p\leq\frac13$ (note that the eigenvalues of $\widetilde{\mathcal{E}}$ are $\frac{1}{4}(1+p)$ and $\frac{1}{4}(1-3p)$).



## Kraus operators, revisited

**!!to-do!!**



## Correctable channels

**!!to-do!!**
































## *Appendices*

### Isometries {#isometries}

**!!to-do!!**



### The Markov approximation {#markov-approximation}

**!!to-do!!**
















### What use are positive maps?

Positive maps that are not completely positive are not completely useless.
True, they cannot describe any quantum dynamics, but still they have useful applications --- for example, they can help us to determine if a given state is entangled or not.

Recall: a quantum state of a bipartite system $\mathcal{AB}$ described by the density matrix $\varrho^{\mathcal{AB}}$ is said to be **separable** if $\varrho^{\mathcal{AB}}$ is of the form
$$
  \varrho^{\mathcal{AB}}
  = \sum_k p_k \rho^{\mathcal{A}}_k \otimes\rho^{\mathcal{B}}_k
$$
where $p_k \geq 0$ and $\sum_{k=1} p_k=1$; otherwise $\varrho^{\mathcal{AB}}$ is said to be **entangled**.
If we apply the partial transpose $\id\otimes T$ to this state, then it remains separable, since, as we have seen, the transpose $\rho^B$ is a legal density matrix.

::: {.idea data-latex=""}
Positive maps, such as the transpose, can be quite deceptive: you have to include other systems in order to detect their unphysical character.
:::

In separable states, one subsystem does not really know about the existence of the other, and so applying a positive map to one part produces a proper density operator, and thus does _not_ reveal the unphysical character of the map.
So, for _any separable state_ $\rho$, we have $(\id\otimes T)\rho\geq 0$.

As an example, consider a quantum state of two qubits which is a mixture of the maximally entangled state $\ket{\psi} = \frac{1}{\sqrt 2}(\ket{00} + \ket{11})$ and the maximally mixed state described by the density matrix
$$
  \rho_p
  = p\proj{\psi} + \frac{(1-p)}{4}\id\otimes\id,
$$
where $p\in [0,1]$.
If we apply the partial transpose $\id\otimes T$ to this state, and check for which values of $p$ the resulting matrix is a density matrix, we see that, for all $p\in[\frac{1}{3},1]$, the density operator $\rho$ describes an entangled state.

Note that the implication "if separable then the partial transpose is positive" does not imply the converse: there exist entangled states for which the partial transpose is positive, and they are known as the **entangled PPT states**^["PPT" stands for _positive partial transpose_.]
However, for _two_ qubits, the PPT states are exactly the separable states.

```{r,engine='tikz',fig.width=2}
\begin{tikzpicture}
  \node at (0,0) {{\small\textsf{SEP}}};
  \node at (0,0.7) {{\small\textsf{PPT}}};
  \node at (0,1.3) {{\small\textsf{all other states}}};
  \draw (0,0) circle (0.5cm);
  \draw (0,0) circle (1cm);
  \draw (0,0) circle (1.8cm);
\end{tikzpicture}
```



### The Choi--Jamiołkowski isomorphism {#choi-jamiolkowski}

The correspondence between linear maps $\mathscr{B}(\mathcal{H})\to\mathscr{B}(\mathcal{H'})$ and operators in $\mathscr{B}(\mathcal{H}\otimes\mathcal{H'})$, known as the **Choi--Jamiołkowski isomorphism** or **channel--state duality**, is another example of a well known correspondence between vectors in $\mathcal{H}_{\mathcal{A}}\otimes\mathcal{H}_{\mathcal{B}}$ and operators $\mathscr{B}(\mathcal{H}_{\mathcal{A}}^\star,\mathcal{H}_{\mathcal{B}})$ or $\mathscr{B}(\mathcal{H}_{\mathcal{B}}^\star,\mathcal{H}_{\mathcal{A}})$.

::: {.tim}
It is slightly confusing at first, but the **Choi isomorphism**, the **Jamiołkowski isomorphism**, and the **Choi--Jamiołkowski** isomorphism are really three distinct things:

1. [the first](https://en.wikipedia.org/wiki/Choi%27s_theorem_on_completely_positive_maps) is very nice, but non-canonical (i.e. is dependent on the choice of basis);
2. the second (for which I have no nice citation, but is basically given by considering $\sum\ket{j}\bra{i}\otimes\mathcal{E}(\ket{i}\bra{j})$ instead of $\sum\ket{i}\bra{j}\otimes\mathcal{E}(\ket{i}\bra{j})$) is canonical, but doesn't always map CP maps to positive semidefinite matrices;
3. [the third](https://en.wikipedia.org/wiki/Choi%E2%80%93Jamio%C5%82kowski_isomorphism) brings together the two similar, but distinct, results by the respective authors. However, people often say "Choi--Jamiołkowski" to mean any one of the three. Such is life.
:::

Take a tensor product vector in $\ket{a}\otimes\ket{b}\in \mathcal{H}_{\mathcal{A}}\otimes\mathcal{H}_{\mathcal{B}}$.
Then it defines natural maps in $\mathscr{B}(\mathcal{H}_{\mathcal{A}}^\star,\mathcal{H}_{\mathcal{B}})$ and $\mathscr{B}(\mathcal{H}_{\mathcal{B}}^\star,\mathcal{H}_{\mathcal{A}})$, via
$$
  \begin{aligned}
    \bra{x}
    &\longmapsto \braket{x}{a}\ket{b}
  \\\bra{y}
    &\longmapsto \ket{a}\braket{y}{b}
  \end{aligned}
$$
for any linear forms $\bra{x}\in\mathcal{H}^\star_A$ and $\bra{y}\in\mathcal{H}^\star_B$.
We then extend this construction (by linearity) to any vector in $\mathcal{H}_{\mathcal{A}}\otimes\mathcal{H}_{\mathcal{B}}$.
These isomorphisms are **canonical**: they do not depend on the choice of any bases in the vectors spaces involved.

However, some care must be taken when we want to define correspondence between vectors in $\mathcal{H}_{\mathcal{A}}\otimes\mathcal{H}_{\mathcal{B}}$ and operators in $\mathscr{B}(\mathcal{H}_{\mathcal{A}},\mathcal{H}_{\mathcal{B}})$ or $\mathscr{B}(\mathcal{H}_{\mathcal{B}},\mathcal{H}_{\mathcal{A}})$.
For example, physicists like to "construct" $\mathscr{B}(\mathcal{H}_{\mathcal{B}},\mathcal{H}_{\mathcal{A}})$ in a deceptively simple way:
$$
  \ket{a}\ket{b} \longleftrightarrow \ket{a}\bra{b}.
$$
(where we have simply omitted the tensor product symbol).
Flipping $\ket{b}$ and switching from $\mathcal{H}_{\mathcal{B}}$ to $\mathcal{H}^\star_B$ is an _anti-linear_ operation (since it involves complex conjugation).
This is fine _when we stick to a specific basis $\ket{i}\ket{j}$ and use the ket-flipping approach only for the basis vectors_.
This means that, for $\ket{b}=\sum_j\beta_j\ket{j}$, the correspondence looks like
$$
  \ket{i}\ket{b} \longleftrightarrow \sum_j \beta_j \ket{i}\bra{j}
$$
and _not_ like
$$
  \ket{i}\ket{b} \longleftrightarrow \ket{i}\bra{b}
  = \sum_j \beta^\star_j \ket{i}\bra{j}.
$$
This isomorphism is **non-canonical**: it depends on the choice of the basis.
But it is still a pretty useful isomorphism!
The Choi--Jamiołkowski isomorphism is of this kind (i.e. non-canonical) --- it works in the basis in which you express a maximally entangled state $\ket{\Omega}=\sum_i\ket{i}\ket{i}$.


### Block matrices and partial trace

For any matrix $M$ in $\mathcal{H}_{\mathcal{A}}\otimes\mathcal{H}_{\mathcal{B}}$ _that is written in the tensor product basis_, the partial trace over the first subsystem (here $\mathcal{A}$) is the sum of the diagonal block matrices, and the partial trace over the second subsystem (here $\mathcal{B}$) is a matrix in which the block sub-matrices are replaced by their traces.
You can visualise this as in Figure \@ref(fig:visualising-partial-trace).

(ref:visualising-partial-trace-caption) Visualising the two partial traces of a matrix _written in the tensor product basis_.

```{r visualising-partial-trace,engine='tikz',engine.opts=list(template="tikz2pdf.tex"),fig.width=8,fig.cap='(ref:visualising-partial-trace-caption)'}
\definecolor{primary}{RGB}{177,98,78}
\providecommand{\mqty}[1]{\begin{matrix}#1\end{matrix}}
\providecommand{\tr}{\operatorname{tr}}
\begin{equation*}
  \begin{array}{c}
    \left[
      \,
      \setlength\arraycolsep{0.4em}
      \begin{array}{c|c|c}
        \cellcolor{primary!20}\mqty{\cdot&\cdot\\\cdot&\cdot}
        & \mqty{\cdot&\cdot\\\cdot&\cdot}
        & \mqty{\cdot&\cdot\\\cdot&\cdot}
        \\\hline
        \mqty{\cdot&\cdot\\\cdot&\cdot}
        & \cellcolor{primary!20}\mqty{\cdot&\cdot\\\cdot&\cdot}
        & \mqty{\cdot&\cdot\\\cdot&\cdot}
        \\\hline
        \mqty{\cdot&\cdot\\\cdot&\cdot}
        & \mqty{\cdot&\cdot\\\cdot&\cdot}
        & \cellcolor{primary!20}\mqty{\cdot&\cdot\\\cdot&\cdot}
      \end{array}
      \,
    \right]
    \\ \\
    \tr_{\mathcal{A}} M
  \end{array}
  \qquad
  \begin{array}{c}
    \left[
      \,
      \setlength\arraycolsep{0.4em}
      \begin{array}{c|c|c}
        \mqty{\cellcolor{primary!20}\cdot&\cdot\\\cdot&\cellcolor{primary!20}\cdot}
        & \mqty{\cellcolor{primary!20}\cdot&\cdot\\\cdot&\cellcolor{primary!20}\cdot}
        & \mqty{\cellcolor{primary!20}\cdot&\cdot\\\cdot&\cellcolor{primary!20}\cdot}
      \\\hline
        \mqty{\cellcolor{primary!20}\cdot&\cdot\\\cdot&\cellcolor{primary!20}\cdot}
        & \mqty{\cellcolor{primary!20}\cdot&\cdot\\\cdot&\cellcolor{primary!20}\cdot}
        & \mqty{\cellcolor{primary!20}\cdot&\cdot\\\cdot&\cellcolor{primary!20}\cdot}
      \\\hline
        \mqty{\cellcolor{primary!20}\cdot&\cdot\\\cdot&\cellcolor{primary!20}\cdot}
        &\mqty{\cellcolor{primary!20}\cdot&\cdot\\\cdot&\cellcolor{primary!20}\cdot}
        & \mqty{\cellcolor{primary!20}\cdot&\cdot\\\cdot&\cellcolor{primary!20}\cdot}
      \end{array}
      \,
    \right]
    \\ \\
    \tr_{\mathcal{B}} M
  \end{array}
\end{equation*}
```

For example, for any $M$ in the tensor product space associated with two qubits, written in the standard basis $\{\ket{00},\ket{01},\ket{10},\ket{11}\}$ in block form as
$$
  M =
  \left[
    \begin{array}{c|c}
      P & Q
    \\\hline
      R & S
    \end{array}
  \right]
$$
where $P$, $Q$, $R$, and $S$ are all $(2\times 2)$ sized sub-matrices, we have that
$$
  \begin{aligned}
    \tr_{\mathcal{A}} M
    &= P+S
  \\\tr_{\mathcal{B}} M
    &=
  \left[
    \begin{array}{c|c}
      \tr P & \tr Q
    \\\hline
      \tr R & \tr S
    \end{array}
  \right]
  \end{aligned}
$$

The same holds for general $M$ in any $\mathcal{H}_{\mathcal{A}}\otimes\mathcal{H}_{\mathcal{B}}$ with such a block form (i.e. $m\times m$ blocks of $(n\times n)$ sized sub-matrices, where $m=\dim\mathcal{H}_{\mathcal{A}}$ and $n=\dim\mathcal{H}_{\mathcal{B}}$).



## *Remarks and exercises*


### Partial inner product

The tensor product structure brings with it the possibility to do "partial things" beyond just the partial trace.
Given $\mathcal{H}_{\mathcal{A}}\otimes\mathcal{H}_{\mathcal{B}}$, any vector $\ket{x}\in\mathcal{H}_{\mathcal{A}}$ defines an anti-linear map $\mathcal{H}_{\mathcal{A}}\otimes\mathcal{H}_{\mathcal{B}}\to\mathcal{H}_{\mathcal{B}}$ called the **partial inner product with $\ket{x}$.**
It is first defined on the product vectors $\ket{a}\otimes\ket{b}$ by the formula
$$
  \ket{a}\otimes\ket{b}
  \longmapsto \braket{x}{a}\ket{b}
$$
and then extended to other vectors in $\mathcal{H}_{\mathcal{A}}\otimes\mathcal{H}_{\mathcal{B}}$ by linearity.
Similarly, any $\ket{y}\in\mathcal{H}_{\mathcal{B}}$ defines a map $\mathcal{H}_{\mathcal{A}}\otimes\mathcal{H}_{\mathcal{B}}\to\mathcal{H}_{\mathcal{A}}$ via
$$
  \ket{a}\otimes\ket{b}
  \longmapsto \ket{a}\braket{y}{b}
$$

For example, the partial inner product of
$$
  \ket{\psi}=c_{00}\ket{00}+c_{01}\ket{01}+c_{10}\ket{10}+c_{11}\ket{11}\in\mathcal{H}_{\mathcal{A}}\otimes\mathcal{H}_{\mathcal{B}}
$$
with of $\ket{0}\in\mathcal{H}_{\mathcal{A}}$ is
$$
  \braket{0}{\psi} = c_{00}\ket{0} + c_{01}\ket{1}
$$
and the partial inner product of the same $\ket{\psi}$ with $\ket{1}\in\mathcal{H}_{\mathcal{B}}$ is
$$
  \braket{1}{\psi} = c_{01}\ket{0} + c_{11}\ket{1}.
$$

**!!to-do!!**
